"use strict";(globalThis.webpackChunkkairos_docs=globalThis.webpackChunkkairos_docs||[]).push([[7249],{15154:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"Advanced/coco","title":"Confidential computing setup","description":"This page describes features that are still experimental in Kairos. There are a lot of things that can be improved and might be more streamlined in the future.","source":"@site/versioned_docs/version-3.5.7/Advanced/coco.md","sourceDirName":"Advanced","slug":"/Advanced/coco","permalink":"/kairos-docs/docs/3.5.7/Advanced/coco","draft":false,"unlisted":false,"editUrl":"https://github.com/kairos-io/kairos-docs/tree/main/versioned_docs/version-3.5.7/Advanced/coco.md","tags":[],"version":"3.5.7","lastUpdatedBy":"Jasper De Keukelaere (imec)","lastUpdatedAt":1765142882000,"sidebarPosition":9,"frontMatter":{"title":"Confidential computing setup","sidebar_label":"Confidential Computing","sidebar_position":9},"sidebar":"tutorialSidebar","previous":{"title":"Encrypting User Data with Kairos","permalink":"/kairos-docs/docs/3.5.7/Advanced/partition_encryption"},"next":{"title":"Revoking secure boot access","permalink":"/kairos-docs/docs/3.5.7/Advanced/revoking-secureboot-access"}}');var s=i(74848),o=i(28453);const r={title:"Confidential computing setup",sidebar_label:"Confidential Computing",sidebar_position:9},a=void 0,c={},d=[{value:"Create a Kairos cluster",id:"create-a-kairos-cluster",level:2},{value:"Additional steps",id:"additional-steps",level:2},{value:"Known limitations",id:"known-limitations",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.admonition,{title:"Warning",type:"warning",children:(0,s.jsx)(n.p,{children:"This page describes features that are still experimental in Kairos. There are a lot of things that can be improved and might be more streamlined in the future."})}),"\n",(0,s.jsx)(n.p,{children:"Confidential computing is a type of secure computing that allows users to encrypt and decrypt data on a secure, isolated computing environment.\nIt works by encrypting the data before it is sent to the cloud or other computing resources. This allows users to keep their data private and secure, even if it is accessed by unauthorized parties.\nThis makes it useful for sensitive data such as financial information, health records, and other confidential data."}),"\n",(0,s.jsxs)(n.p,{children:["One important aspect of Confidential Computing is the ability to encrypt data even in-memory. This document describes how to setup Kairos to use ",(0,s.jsx)(n.a,{href:"https://github.com/confidential-containers/enclave-cc",children:(0,s.jsx)(n.code,{children:"enclave-cc"})}),"\nin order to run confidential workloads."]}),"\n",(0,s.jsx)(n.h2,{id:"create-a-kairos-cluster",children:"Create a Kairos cluster"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.a,{href:"https://github.com/kairos-io/community-bundles/tree/main/coco",children:(0,s.jsx)(n.code,{children:"coco community bundle"})})," is supported since Kairos version ",(0,s.jsx)(n.code,{children:"v2.0.0-alpha3"}),' ("coco" stands for "',(0,s.jsx)(n.strong,{children:"Co"}),"nfidential ",(0,s.jsx)(n.strong,{children:"Co"}),'mputing").']}),"\n",(0,s.jsxs)(n.p,{children:["A configuration file like the following should be used (see the ",(0,s.jsx)(n.code,{children:"bundles"})," section):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"#cloud-config\nbundles:\n    - targets:\n        - run://quay.io/kairos/community-bundles:cert-manager_latest\n        - run://quay.io/kairos/community-bundles:kairos_latest\n        - run://quay.io/kairos/community-bundles:coco_latest\n\ninstall:\n    auto: true\n    device: auto\n    reboot: true\n\nk3s:\n    enabled: true\n\nusers:\n    - name: kairos\n      passwd: kairos\n      groups:\n          - admin\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The bundle is making some changes on the host's filesystem (installs a customized containerd binary among other things) and a restart of the node is needed in order for the changes to be applied fully.\nWhen this file appears, reboot the node: ",(0,s.jsx)(n.code,{children:"/etc/containerd/.sentinel"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"additional-steps",children:"Additional steps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/confidential-containers/documentation/blob/main/quickstart#prerequisites",children:"Label our node"}),":"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"  kubectl label --overwrite node $(kubectl get nodes -o jsonpath='{.items[].metadata.name}') node-role.kubernetes.io/worker=\"\"\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/confidential-containers/documentation/blob/main/quickstart#deploy-the-the-operator",children:"Deploy the operator"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"  kubectl apply -k github.com/confidential-containers/operator/config/release?ref=v0.4.0\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["[Deploy the ",(0,s.jsx)(n.code,{children:"ccruntime"})," resource]"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"  kubectl apply -k github.com/confidential-containers/operator/config/samples/ccruntime/ssh-demo?ref=v0.4.0\n"})}),"\n",(0,s.jsxs)(n.p,{children:["(wait until they are all running: ",(0,s.jsx)(n.code,{children:"kubectl get pods -n confidential-containers-system --watch"}),")"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/confidential-containers/documentation/blob/main/quickstart#test-creating-a-workload-from-the-sample-encrypted-image",children:"Deploy a workload"})}),"\n",(0,s.jsx)(n.p,{children:"The last part with the verification will only work from within a Pod because the IP address is internal:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:'ssh -i ccv0-ssh root@$(kubectl get service ccv0-ssh -o jsonpath="{.spec.clusterIP}")'})}),"\n",(0,s.jsx)(n.p,{children:"You can create a Pod like this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'apiVersion: v1\nkind: Pod\nmetadata:\n  name: kubectl\nspec:\n  containers:\n  - name: kubectl\n    image: opensuse/leap\n    command: ["/bin/sh", "-ec", "trap : TERM INT; sleep infinity & wait"]\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Get a shell to it and run the verification commands (You will need to install ",(0,s.jsx)(n.code,{children:"ssh"})," in the Pod first)."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"known-limitations",children:"Known limitations"}),"\n",(0,s.jsx)(n.p,{children:"The above solution has some known limitations that might be addressed in future releases of Kairos. Namely:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["After a Kairos upgrade, the above process has to be repeated in order to install the customized ",(0,s.jsx)(n.code,{children:"containerd"})," and the relevant configuration."]}),"\n",(0,s.jsxs)(n.li,{children:["There is no simple way to upgrade to newer versions of the bundle (",(0,s.jsx)(n.a,{href:"https://github.com/kairos-io/kairos/issues/974",children:"this is a general bundles limitation"}),")."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var t=i(96540);const s={},o=t.createContext(s);function r(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);