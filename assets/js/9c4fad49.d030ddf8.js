"use strict";(globalThis.webpackChunkkairos_docs=globalThis.webpackChunkkairos_docs||[]).push([[2027],{25927:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"Examples/metallb","title":"MetalLB","description":"This section describe examples on how to deploy Kairos with k3s and MetalLB","source":"@site/docs/Examples/metallb.md","sourceDirName":"Examples","slug":"/Examples/metallb","permalink":"/docs/next/Examples/metallb","draft":false,"unlisted":false,"editUrl":"https://github.com/kairos-io/kairos-docs/tree/main/docs/Examples/metallb.md","tags":[],"version":"current","lastUpdatedBy":"Jasper De Keukelaere (imec)","lastUpdatedAt":1765043763000,"frontMatter":{"title":"MetalLB","sidebar_label":"MetalLB","description":"This section describe examples on how to deploy Kairos with k3s and MetalLB"},"sidebar":"tutorialSidebar","previous":{"title":"LocalAI","permalink":"/docs/next/Examples/localai"},"next":{"title":"Self-coordinating P2P multi-node cluster HA with KubeVIP","permalink":"/docs/next/Examples/multi-node-p2p-ha-kubevip"}}');var a=n(74848),i=n(28453);const l={title:"MetalLB",sidebar_label:"MetalLB",description:"This section describe examples on how to deploy Kairos with k3s and MetalLB"},o=void 0,r={},d=[{value:"Resources",id:"resources",level:2}];function c(e){const t={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"Welcome to the guide on using MetalLB with Kairos and K3s on a bare metal host!"}),"\n",(0,a.jsxs)(t.p,{children:["In this tutorial, we'll walk through the steps of setting up a Kairos node on your local network using the ",(0,a.jsx)(t.code,{children:"192.168.1.10-192.168.1.20"})," IP range, with MetalLB and K3s."]}),"\n",(0,a.jsxs)(t.p,{children:["But first, let's talk a little bit about what ",(0,a.jsx)(t.a,{href:"https://metallb.universe.tf/",children:"MetalLB"})," and ",(0,a.jsx)(t.a,{href:"https://k3s.io/",children:"K3s"})," are. MetalLB is a load balancer implementation for bare metal Kubernetes clusters that uses standard routing protocols. It's particularly useful when used with K3s in Kairos, as it provides load balancing for bare metal clusters and helps manage IP addresses within the cluster. K3s is a lightweight Kubernetes distribution that is easy to install and maintain."]}),"\n",(0,a.jsx)(t.p,{children:"Now that you have an understanding of what we'll be working with, let's dive into the installation process."}),"\n",(0,a.jsxs)(t.p,{children:["Check out the ",(0,a.jsx)(t.a,{href:"../../examples/bundles",children:"bundle"})," example to configure ",(0,a.jsx)(t.code,{children:"MetalLB"})," with bundles. Bundles provides a streamlined way to publish and re-use configuration between nodes."]}),"\n",(0,a.jsxs)(t.p,{children:["To get started, you'll need to use the standard images, which include k3s. We'll be using the ",(0,a.jsx)(t.a,{href:"../../reference/configuration#kubernetes-manifests",children:"k3s manifest method"})," to deploy MetalLB."]}),"\n",(0,a.jsxs)(t.p,{children:["Follow the ",(0,a.jsx)(t.a,{href:"../../installation",children:"Installation"})," documentation, and use the following cloud config file with Kairos:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:'#cloud-config\n\nhostname: metal-{{ trunc 4 .MachineID }}\nusers:\n- name: kairos\n  # Change to your pass here\n  passwd: kairos\n  groups:\n  - admin\n  ssh_authorized_keys:\n  # Add your github user here!\n  - github:mudler\n\nk3s:\n  enabled: true\n  args:\n  - --disable=traefik,servicelb\n\n# Additional manifests that are applied by k3s on boot\nwrite_files:\n- path: /var/lib/rancher/k3s/server/manifests/metallb.yaml\n  permissions: "0644"\n  content: |\n        apiVersion: v1\n        kind: Namespace\n        metadata:\n          name: metallb-system\n        ---\n        apiVersion: helm.cattle.io/v1\n        kind: HelmChart\n        metadata:\n          name: metallb\n          namespace: metallb-system\n        spec:\n          chart: https://github.com/metallb/metallb/releases/download/metallb-chart-0.13.7/metallb-0.13.7.tgz\n- path: /var/lib/rancher/k3s/server/manifests/addresspool.yaml\n  permissions: "0644"\n  content: |\n        apiVersion: metallb.io/v1beta1\n        kind: IPAddressPool\n        metadata:\n          name: default\n          namespace: metallb-system\n        spec:\n          addresses:\n          - 192.168.1.10-192.168.1.20\n        ---\n        apiVersion: metallb.io/v1beta1\n        kind: L2Advertisement\n        metadata:\n          name: default\n          namespace: metallb-system\n        spec:\n          ipAddressPools:\n          - default\n'})}),"\n",(0,a.jsx)(t.p,{children:"There are a few things to note in this configuration file:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["In the ",(0,a.jsx)(t.code,{children:"k3s"})," block, we use the ",(0,a.jsx)(t.code,{children:"--disable"})," flag to disable ",(0,a.jsx)(t.code,{children:"traefik"})," and ",(0,a.jsx)(t.code,{children:"servicelb"}),", which are the default load balancers for k3s."]}),"\n",(0,a.jsxs)(t.li,{children:["In the ",(0,a.jsx)(t.code,{children:"write_files"})," block, we write manifests (in ",(0,a.jsx)(t.code,{children:"/var/lib/rancher/k3s/server/manifests/"})," see ",(0,a.jsx)(t.a,{href:"../../reference/configuration#kubernetes-manifests",children:"docs"}),") to deploy MetalLB and configure it to use the ",(0,a.jsx)(t.code,{children:"192.168.1.10-192.168.1.20"})," IP range. Make sure to choose an IP range that doesn't interfere with your local DHCP network."]}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"And that's it! You should now have MetalLB and K3s set up on your Kairos node."}),"\n",(0,a.jsx)(t.h2,{id:"resources",children:"Resources"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.a,{href:"https://thenewstack.io/livin-kubernetes-on-the-immutable-edge-with-kairos-project/",children:"TNS blog post"})}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>o});var s=n(96540);const a={},i=s.createContext(a);function l(e){const t=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);