"use strict";(globalThis.webpackChunkkairos_docs=globalThis.webpackChunkkairos_docs||[]).push([[6456],{11470:(e,n,t)=>{t.d(n,{A:()=>y});var s=t(96540),o=t(34164),r=t(17559),a=t(23104),i=t(56347),l=t(205),d=t(57485),c=t(31682),h=t(70679);function u(e){return s.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function p(e){const{values:n,children:t}=e;return(0,s.useMemo)(()=>{const e=n??function(e){return u(e).map(({props:{value:e,label:n,attributes:t,default:s}})=>({value:e,label:n,attributes:t,default:s}))}(t);return function(e){const n=(0,c.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}function f({value:e,tabValues:n}){return n.some(n=>n.value===e)}function m({queryString:e=!1,groupId:n}){const t=(0,i.W6)(),o=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,d.aZ)(o),(0,s.useCallback)(e=>{if(!o)return;const n=new URLSearchParams(t.location.search);n.set(o,e),t.replace({...t.location,search:n.toString()})},[o,t])]}function b(e){const{defaultValue:n,queryString:t=!1,groupId:o}=e,r=p(e),[a,i]=(0,s.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!f({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find(e=>e.default)??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:r})),[d,c]=m({queryString:t,groupId:o}),[u,b]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,o]=(0,h.Dv)(n);return[t,(0,s.useCallback)(e=>{n&&o.set(e)},[n,o])]}({groupId:o}),x=(()=>{const e=d??u;return f({value:e,tabValues:r})?e:null})();(0,l.A)(()=>{x&&i(x)},[x]);return{selectedValue:a,selectValue:(0,s.useCallback)(e=>{if(!f({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);i(e),c(e),b(e)},[c,b,r]),tabValues:r}}var x=t(92303);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var g=t(74848);function k({className:e,block:n,selectedValue:t,selectValue:s,tabValues:r}){const i=[],{blockElementScrollPositionUntilNextRender:l}=(0,a.a_)(),d=e=>{const n=e.currentTarget,o=i.indexOf(n),a=r[o].value;a!==t&&(l(n),s(a))},c=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=i.indexOf(e.currentTarget)+1;n=i[t]??i[0];break}case"ArrowLeft":{const t=i.indexOf(e.currentTarget)-1;n=i[t]??i[i.length-1];break}}n?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":n},e),children:r.map(({value:e,label:n,attributes:s})=>(0,g.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{i.push(e)},onKeyDown:c,onClick:d,...s,className:(0,o.A)("tabs__item",j.tabItem,s?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function w({lazy:e,children:n,selectedValue:t}){const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=r.find(e=>e.props.value===t);return e?(0,s.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:r.map((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function v(e){const n=b(e);return(0,g.jsxs)("div",{className:(0,o.A)(r.G.tabs.container,"tabs-container",j.tabList),children:[(0,g.jsx)(k,{...n,...e}),(0,g.jsx)(w,{...n,...e})]})}function y(e){const n=(0,x.A)();return(0,g.jsx)(v,{...e,children:u(e.children)},String(n))}},19365:(e,n,t)=>{t.d(n,{A:()=>a});t(96540);var s=t(34164);const o={tabItem:"tabItem_Ymn6"};var r=t(74848);function a({children:e,hidden:n,className:t}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,s.A)(o.tabItem,t),hidden:n,children:e})}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var s=t(96540);const o={},r=s.createContext(o);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(r.Provider,{value:n},e.children)}},47311:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"Installation/p2p","title":"P2P support","description":"Install Kairos with p2p support","source":"@site/versioned_docs/version-3.6.0/Installation/p2p.md","sourceDirName":"Installation","slug":"/Installation/p2p","permalink":"/kairos-docs/docs/3.6.0/Installation/p2p","draft":false,"unlisted":false,"editUrl":"https://github.com/kairos-io/kairos-docs/tree/main/versioned_docs/version-3.6.0/Installation/p2p.md","tags":[],"version":"3.6.0","lastUpdatedBy":"Jasper De Keukelaere (imec)","lastUpdatedAt":1765142882000,"sidebarPosition":6,"frontMatter":{"title":"P2P support","sidebar_label":"P2P support","sidebar_position":6,"date":"2022-11-13T00:00:00.000Z","description":"Install Kairos with p2p support"},"sidebar":"tutorialSidebar","previous":{"title":"Network booting","permalink":"/kairos-docs/docs/3.6.0/Installation/netboot"},"next":{"title":"Trusted Boot","permalink":"/kairos-docs/docs/3.6.0/Installation/trustedboot"}}');var o=t(74848),r=t(28453),a=t(11470),i=t(19365);const l={title:"P2P support",sidebar_label:"P2P support",sidebar_position:6,date:new Date("2022-11-13T00:00:00.000Z"),description:"Install Kairos with p2p support"},d=void 0,c={},h=[{value:"Configuration",id:"configuration",level:2},{value:"DNS",id:"dns",level:2},{value:"Elastic IP",id:"elastic-ip",level:2},{value:"<code>network_token</code>",id:"network_token",level:2},{value:"Join new nodes",id:"join-new-nodes",level:2},{value:"Connect to the nodes",id:"connect-to-the-nodes",level:2},{value:"Get kubeconfig",id:"get-kubeconfig",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.admonition,{title:"Network",type:"warning",children:(0,o.jsx)(n.p,{children:"This feature is experimental and has only been tested on local setups. Run in production servers at your own risk.\nFeedback and bug reports are welcome, as we are improving the p2p aspects of Kairos."})}),"\n",(0,o.jsx)(n.p,{children:"Deploying Kubernetes at the Edge can be a complex and time-consuming process, especially when it comes to setting up and managing multiple clusters. To make this process easier, Kairos leverages peer-to-peer technology to automatically coordinate and create Kubernetes clusters without the need of a control management interface."}),"\n",(0,o.jsx)(n.p,{children:"With this feature, users don't need to specify any network settings. They can just set the desired number of master nodes (in the case of an HA cluster) and the necessary configuration details, and Kairos will take care of the rest. The peer-to-peer technology allows the nodes in the cluster to communicate and coordinate with each other, ensuring that the clusters are set up correctly and efficiently with K3s."}),"\n",(0,o.jsxs)(n.p,{children:["This makes it easier to deploy and manage Kubernetes clusters at the Edge, saving user's time and effort, allowing them to focus on running and scaling their applications. For more information about how does it work behind the scenes, ",(0,o.jsx)(n.a,{href:"../../architecture/network",children:"check out the architecture section"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["You can find full examples in our ",(0,o.jsx)(n.a,{href:"../../examples",children:"examples section"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"../../examples/p2p_e2e",children:"Full end to end example to bootstrap a self-coordinated cluster with Kairos and AuroraBoot"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"../../examples/multi-node-p2p-ha-kubevip",children:"Self-coordinated K3s HA cluster with KubeVIP"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"../../examples/multi-node-p2p",children:"Multi-node, single master setup"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"../../examples/multi-node-p2p-ha",children:"Multi-node, HA setup"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"../../examples/single-node-p2p",children:"Single-node setup"})}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["This feature is currently experimental and can be optionally enabled by adding the following configuration to the node deployment file. If you are not familiar with the installation process, it is suggested to follow the ",(0,o.jsx)(n.a,{href:"/getting-started/",children:"quickstart"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'p2p:\n # Disabling DHT makes co-ordination to discover nodes only in the local network\n disable_dht: true #Enabled by default\n # Automatic cluster deployment configuration\n auto:\n   ha:\n     # Enables HA control-plane\n     enable: true\n     # number of HA master node (beside the one used for init) for the control-plane\n     master_nodes: 2\n # network_token is the shared secret used by the nodes to co-ordinate with p2p.\n # Setting a network token implies auto.enable = true.\n # To disable, just set auto.enable = false\n network_token: "YOUR_TOKEN_GOES_HERE"\n\n\n'})}),"\n",(0,o.jsxs)(n.p,{children:["The token ",(0,o.jsx)(n.code,{children:"p2p.network_token"})," is a base64 encoded string which\ncontains an ",(0,o.jsxs)(n.a,{href:"https://github.com/mudler/edgevpn/blob/master/docs/content/en/docs/Concepts/Token/_index",children:[(0,o.jsx)(n.code,{children:"edgevpn"})," token"]}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["To enable the automatic cluster deployment with peer-to-peer technology, specify a ",(0,o.jsx)(n.code,{children:"p2p.network_token"}),". To enable HA, set ",(0,o.jsx)(n.code,{children:"p2p.auto.ha.master_nodes"})," to the number of wanted HA/master nodes. Additionally, the p2p block can be used to configure the VPN and other settings as needed."]}),"\n",(0,o.jsx)(n.p,{children:"With these settings used to deploy all the nodes, those will automatically communicate and coordinate with each other to deploy and manage the Kubernetes cluster without the need for a control management interface and user intervention."}),"\n",(0,o.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsx)(n.p,{children:"A minimum configuration file, that bootstraps a cluster with a simple single-master topology, can look like the following:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'#cloud-config\nhostname: "kubevip-{{ trunc 4 .MachineID }}"\n\nusers:\n- name: "kairos"\n  passwd: "kairos"\n  ssh_authorized_keys:\n  - github:mudler\np2p:\n network_token: "YOUR_TOKEN_GOES_HERE"\n'})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"p2p"})," block is used to configure settings related to the mesh functionalities. The minimum required argument is the ",(0,o.jsx)(n.code,{children:"network_token"})," and there is no need to configure ",(0,o.jsx)(n.code,{children:"k3s"})," manually with the ",(0,o.jsx)(n.code,{children:"k3s"})," block as it is already implied."]}),"\n",(0,o.jsx)(n.admonition,{title:"Note",type:"note",children:(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"k3s"})," block can still be used to override other ",(0,o.jsx)(n.code,{children:"k3s"})," settings, e.g. ",(0,o.jsx)(n.code,{children:"args"}),"."]})}),"\n",(0,o.jsxs)(n.p,{children:["The network token is a shared secret available to all the nodes of the cluster. It allows the node to co-ordinate and automatically assign roles. To generate a network token, see ",(0,o.jsx)(n.a,{href:"../../installation/p2p#network_token",children:"documentation"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"Simply applying the same configuration file to all the nodes should eventually bring one master and all the other nodes as workers. Adding nodes can be done also in a later step, which will automatically setup the node without any further configuration."}),"\n",(0,o.jsx)(n.p,{children:"Full example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'#cloud-config\n\ninstall:\n  auto: true\n  device: "auto"\n  reboot: true\n\nhostname: "kubevip-{{ trunc 4 .MachineID }}"\nusers:\n- name: "kairos"\n  passwd: "kairos"\n  ssh_authorized_keys:\n  - github:mudler\n\n## Sets the Elastic IP used in KubeVIP\nkubevip:\n  eip: "192.168.1.110"\n  # Specify a manifest URL for KubeVIP. Empty uses default\n  manifest_url: ""\n  # Enables KubeVIP\n  enable: true\n  # Specifies a KubeVIP Interface\n  interface: "ens18"\n\np2p:\n role: "" # Set an hardcoded role, optional\n  # Disabling DHT makes co-ordination to discover nodes only in the local network\n disable_dht: true #Enabled by default\n # Configures a VPN for the cluster nodes\n vpn:\n   create: false # defaults to true\n   use: false # defaults to true\n   env:\n      .....\n # Automatic cluster deployment configuration\n auto:\n   # Enables Automatic node configuration (self-coordination)\n   # for role assignment\n   enable: true\n   # HA enables automatic HA roles assignment.\n   # A master cluster init is always required,\n   # Any additional master_node is configured as part of the \n   # HA control plane.\n   # If auto is disabled, HA has no effect.\n   ha:\n     # Enables HA control-plane\n     enable: true\n     # Number of HA additional master nodes.\n     # A master node is always required for creating the cluster and is implied.\n     # The setting below adds 2 additional master nodes, for a total of 3.\n     master_nodes: 2\n     # Use an External database for the HA control plane\n     external_db: "external-db-string"\n # network_token is the shared secret used by the nodes to co-ordinate with p2p\n network_token: "YOUR_TOKEN_GOES_HERE"\n'})}),"\n",(0,o.jsx)(n.p,{children:"In the YAML configuration example, there are several important keywords that control the behavior of the automatic cluster deployment:"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Keyword"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"p2p"})}),(0,o.jsx)(n.td,{children:"Configures the peer to peer networking of the cluster"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"p2p.disable_dht"})}),(0,o.jsx)(n.td,{children:"Disables the distributed hash table for cluster discovery"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"p2p.network_token"})}),(0,o.jsx)(n.td,{children:"The shared secret used by the nodes to coordinate with p2p"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"p2p.network_id"})}),(0,o.jsx)(n.td,{children:"Optional, unique identifier for the kubernetes cluster. It allows bootstrapping of multiple cluster using the same network token"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"p2p.role"})}),(0,o.jsx)(n.td,{children:"Force a specific role for the node of the cluster"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"p2p.vpn"})}),(0,o.jsx)(n.td,{children:"Configures a VPN for the cluster nodes"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"p2p.vpn.create"})}),(0,o.jsx)(n.td,{children:"Enables the creation of the VPN"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"p2p.vpn.use"})}),(0,o.jsx)(n.td,{children:"Enables the use of the VPN for routing Kubernetes traffic of the cluster"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"p2p.vpn.env"})}),(0,o.jsx)(n.td,{children:"Configures the environment variables used to start for the VPN"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"p2p.vpn.auto"})}),(0,o.jsx)(n.td,{children:"Configures the automatic deployment of the cluster"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"p2p.auto.enable"})}),(0,o.jsx)(n.td,{children:"Enables automatic node configuration for role assignment"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"p2p.auto.ha"})}),(0,o.jsx)(n.td,{children:"Configures the high availability settings for the cluster"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"p2p.auto.ha.enable"})}),(0,o.jsx)(n.td,{children:"Enables the high availability settings"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"p2p.auto.ha.master_nodes"})}),(0,o.jsx)(n.td,{children:"The number of additional HA master nodes expected in the cluster."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"p2p.auto.ha.external_db"})}),(0,o.jsx)(n.td,{children:"The external database used for high availability"})]})]})]}),"\n",(0,o.jsx)(n.h2,{id:"dns",children:"DNS"}),"\n",(0,o.jsxs)(n.p,{children:["When the ",(0,o.jsx)(n.code,{children:"p2p.dns"})," is set to ",(0,o.jsx)(n.code,{children:"true"})," the embedded DNS is configured on the node. This allows to propagate custom records to the nodes by using the blockchain DNS server. For example, this is assuming ",(0,o.jsx)(n.code,{children:"kairosctl bridge"})," is running in a separate terminal:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/api/dns --header "Content-Type: application/json" -d \'{ "Regex": "foo.bar", "Records": { "A": "2.2.2.2" } }\'\n'})}),"\n",(0,o.jsxs)(n.p,{children:["It will add the ",(0,o.jsx)(n.code,{children:"foo.bar"})," domain with ",(0,o.jsx)(n.code,{children:"2.2.2.2"})," as ",(0,o.jsx)(n.code,{children:"A"})," response.\nEvery node with DNS enabled will be able to resolve the domain after the domain is correctly announced."]}),"\n",(0,o.jsxs)(n.p,{children:["You can check out the DNS in the ",(0,o.jsx)(n.a,{href:"http://localhost:8080/dns.html",children:"DNS page in the API"}),", see also the ",(0,o.jsx)(n.a,{href:"https://mudler.github.io/edgevpn/docs/concepts/overview/dns/",children:"EdgeVPN docs"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"Furthermore, it is possible to tweak the DNS server which are used to forward requests for domain listed outside, and as well, it's possible to lock down resolving only to nodes in the blockchain, by customizing the configuration file:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'#cloud-config\n\np2p:\n  network_token: "...."\n  # Enable embedded DNS See also: https://mudler.github.io/edgevpn/docs/concepts/overview/dns/\n  dns: true\n  vpn:\n    env:\n      # Disable DNS forwarding\n      DNSFORWARD: "false"\n      # Set cache size\n      DNSCACHESIZE: "200"\n      # Set DNS forward server\n      DNSFORWARDSERVER: "8.8.8.8:53"\n'})}),"\n",(0,o.jsx)(n.h2,{id:"elastic-ip",children:"Elastic IP"}),"\n",(0,o.jsx)(n.p,{children:"If deploying a cluster in a Local network, it might be preferable to disable the VPN functionalities."}),"\n",(0,o.jsx)(n.p,{children:"We use KubeVIP to provide an elastic ip for the control plane that can be configured via a specific block:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'\np2p:\n network_token: ".."\n vpn:\n   # Disable VPN, so traffic is not configured with a VPN\n   create: false\n   use: false\n\n## Sets the Elastic IP used in KubeVIP\nkubevip:\n  eip: "192.168.1.110"\n  # Specify a manifest URL for KubeVIP. Empty uses default\n  manifest_url: ""\n  # Enables KubeVIP\n  enable: true\n  # Specifies a KubeVIP Interface\n  interface: "ens18"\n'})}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Keyword"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"kubevip"})}),(0,o.jsx)(n.td,{children:"Block to configure KubeVIP for the cluster"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"kubevip.eip"})}),(0,o.jsx)(n.td,{children:"The Elastic IP used for KubeVIP. Specifying one automatically enables KubeVIP. Choose a free IP that is not in a DHCP range of your network."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"kubevip.manifest_url"})}),(0,o.jsx)(n.td,{children:"The URL for the KubeVIP manifest"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"kubevip.enable"})}),(0,o.jsx)(n.td,{children:"Enables KubeVIP for the cluster"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"kubevip.interface"})}),(0,o.jsx)(n.td,{children:"The interface used for KubeVIP"})]})]})]}),"\n",(0,o.jsx)(n.p,{children:"A full example, with KubeVIP and HA:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'\n#cloud-config\n\ninstall:\n  auto: true\n  device: "auto"\n  reboot: true\n\nhostname: "kubevip-{{ trunc 4 .MachineID }}"\nusers:\n- name: "kairos"\n  passwd: "kairos"\n  ssh_authorized_keys:\n  - github:mudler\n\np2p:\n network_token: "..."\n ha:\n   master_nodes: 2\n vpn:\n   # Disable VPN, so traffic is not configured with a VPN\n   create: false\n   use: false\n\nkubevip:\n  eip: "192.168.1.110"\n'})}),"\n",(0,o.jsx)(n.h2,{id:"network_token",children:(0,o.jsx)(n.code,{children:"network_token"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"network_token"})," is a unique code that is shared among nodes and can be created with the Kairos CLI or ",(0,o.jsx)(n.code,{children:"edgevpn"}),". This allows nodes to automatically connect to the same network and generates private/public key pairs for secure communication using end-to-end encryption."]}),"\n",(0,o.jsx)(n.p,{children:"To generate a new token, run:"}),"\n","\n",(0,o.jsxs)(a.A,{children:[(0,o.jsx)(i.A,{value:"docker",label:"docker",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker run -ti --rm quay.io/mudler/edgevpn -b -g\n"})})}),(0,o.jsx)(i.A,{value:"cli",label:"CLI",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kairos generate-token\n"})})})]}),"\n",(0,o.jsx)(n.h2,{id:"join-new-nodes",children:"Join new nodes"}),"\n",(0,o.jsx)(n.p,{children:"To add new nodes to the network, follow the same process as before and use the same configuration file for all machines. Unless you have specified roles for each node, no further changes to the configuration are necessary. The machines will automatically connect to each other, whether they are on a local or remote network."}),"\n",(0,o.jsx)(n.h2,{id:"connect-to-the-nodes",children:"Connect to the nodes"}),"\n",(0,o.jsxs)(n.p,{children:["To connect to the nodes, you can use ",(0,o.jsx)(n.code,{children:"kairosctl"})," and provide the network_token to establish a tunnel to the nodes network."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo kairosctl bridge --network-token <TOKEN>\n"})}),"\n",(0,o.jsx)(n.p,{children:"This command creates a TUN device on your machine and allows you to communicate with each node in the cluster."}),"\n",(0,o.jsx)(n.admonition,{title:"Note",type:"info",children:(0,o.jsx)(n.p,{children:"The command requires root permissions in order to create a TUN/TAP device on the host."})}),"\n",(0,o.jsxs)(n.p,{children:["An API will be also available at ",(0,o.jsx)(n.a,{href:"http://localhost:8080",children:"localhost:8080"})," for inspecting the network status."]}),"\n",(0,o.jsx)(n.h2,{id:"get-kubeconfig",children:"Get kubeconfig"}),"\n",(0,o.jsxs)(n.p,{children:["To get the cluster ",(0,o.jsx)(n.code,{children:"kubeconfig"}),", you can log in to the master node and retrieve it from the engine (e.g., it is located at ",(0,o.jsx)(n.code,{children:"/etc/rancher/k3s/k3s.yaml"})," for K3s) or use the Kairos CLI. If using the CLI, you must be connected to the bridge or logged in from one of the nodes and run the following command in the console:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kairosctl get-kubeconfig > kubeconfig\n"})}),"\n",(0,o.jsx)(n.admonition,{title:"Note",type:"info",children:(0,o.jsxs)(n.p,{children:["Note that you must run kairos bridge in a separate window as act like ",(0,o.jsx)(n.code,{children:"kubectl proxy"})," and access the Kubernetes cluster VPN. Keep the kairos bridge command running to operate the cluster."]})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}}}]);