"use strict";(globalThis.webpackChunkkairos_docs=globalThis.webpackChunkkairos_docs||[]).push([[4756],{11470:(e,o,r)=>{r.d(o,{A:()=>w});var n=r(96540),i=r(34164),t=r(17559),s=r(23104),a=r(56347),l=r(205),d=r(57485),c=r(31682),h=r(70679);function u(e){return n.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:o}=e;return!!o&&"object"==typeof o&&"value"in o}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function m(e){const{values:o,children:r}=e;return(0,n.useMemo)(()=>{const e=o??function(e){return u(e).map(({props:{value:e,label:o,attributes:r,default:n}})=>({value:e,label:o,attributes:r,default:n}))}(r);return function(e){const o=(0,c.XI)(e,(e,o)=>e.value===o.value);if(o.length>0)throw new Error(`Docusaurus error: Duplicate values "${o.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[o,r])}function f({value:e,tabValues:o}){return o.some(o=>o.value===e)}function g({queryString:e=!1,groupId:o}){const r=(0,a.W6)(),i=function({queryString:e=!1,groupId:o}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!o)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return o??null}({queryString:e,groupId:o});return[(0,d.aZ)(i),(0,n.useCallback)(e=>{if(!i)return;const o=new URLSearchParams(r.location.search);o.set(i,e),r.replace({...r.location,search:o.toString()})},[i,r])]}function p(e){const{defaultValue:o,queryString:r=!1,groupId:i}=e,t=m(e),[s,a]=(0,n.useState)(()=>function({defaultValue:e,tabValues:o}){if(0===o.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!f({value:e,tabValues:o}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${o.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const r=o.find(e=>e.default)??o[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:o,tabValues:t})),[d,c]=g({queryString:r,groupId:i}),[u,p]=function({groupId:e}){const o=function(e){return e?`docusaurus.tab.${e}`:null}(e),[r,i]=(0,h.Dv)(o);return[r,(0,n.useCallback)(e=>{o&&i.set(e)},[o,i])]}({groupId:i}),b=(()=>{const e=d??u;return f({value:e,tabValues:t})?e:null})();(0,l.A)(()=>{b&&a(b)},[b]);return{selectedValue:s,selectValue:(0,n.useCallback)(e=>{if(!f({value:e,tabValues:t}))throw new Error(`Can't select invalid tab value=${e}`);a(e),c(e),p(e)},[c,p,t]),tabValues:t}}var b=r(92303);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=r(74848);function v({className:e,block:o,selectedValue:r,selectValue:n,tabValues:t}){const a=[],{blockElementScrollPositionUntilNextRender:l}=(0,s.a_)(),d=e=>{const o=e.currentTarget,i=a.indexOf(o),s=t[i].value;s!==r&&(l(o),n(s))},c=e=>{let o=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const r=a.indexOf(e.currentTarget)+1;o=a[r]??a[0];break}case"ArrowLeft":{const r=a.indexOf(e.currentTarget)-1;o=a[r]??a[a.length-1];break}}o?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":o},e),children:t.map(({value:e,label:o,attributes:n})=>(0,j.jsx)("li",{role:"tab",tabIndex:r===e?0:-1,"aria-selected":r===e,ref:e=>{a.push(e)},onKeyDown:c,onClick:d,...n,className:(0,i.A)("tabs__item",x.tabItem,n?.className,{"tabs__item--active":r===e}),children:o??e},e))})}function k({lazy:e,children:o,selectedValue:r}){const t=(Array.isArray(o)?o:[o]).filter(Boolean);if(e){const e=t.find(e=>e.props.value===r);return e?(0,n.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:t.map((e,o)=>(0,n.cloneElement)(e,{key:o,hidden:e.props.value!==r}))})}function y(e){const o=p(e);return(0,j.jsxs)("div",{className:(0,i.A)(t.G.tabs.container,"tabs-container",x.tabList),children:[(0,j.jsx)(v,{...o,...e}),(0,j.jsx)(k,{...o,...e})]})}function w(e){const o=(0,b.A)();return(0,j.jsx)(y,{...e,children:u(e.children)},String(o))}},19365:(e,o,r)=>{r.d(o,{A:()=>s});r(96540);var n=r(34164);const i={tabItem:"tabItem_Ymn6"};var t=r(74848);function s({children:e,hidden:o,className:r}){return(0,t.jsx)("div",{role:"tabpanel",className:(0,n.A)(i.tabItem,r),hidden:o,children:e})}},24583:(e,o,r)=>{r.r(o),r.d(o,{assets:()=>c,contentTitle:()=>d,default:()=>m,frontMatter:()=>l,metadata:()=>n,toc:()=>h});const n=JSON.parse('{"id":"Reference/auroraboot","title":"AuroraBoot","description":"Reference documentation for AuroraBoot, a tool for generating bootable images","source":"@site/docs/Reference/auroraboot.md","sourceDirName":"Reference","slug":"/Reference/auroraboot","permalink":"/docs/next/Reference/auroraboot","draft":false,"unlisted":false,"editUrl":"https://github.com/kairos-io/kairos-docs/tree/main/docs/Reference/auroraboot.md","tags":[],"version":"current","lastUpdatedBy":"Jasper De Keukelaere (imec)","lastUpdatedAt":1765146647000,"sidebarPosition":1,"frontMatter":{"title":"AuroraBoot","sidebar_label":"AuroraBoot","sidebar_position":1,"description":"Reference documentation for AuroraBoot, a tool for generating bootable images"},"sidebar":"tutorialSidebar","previous":{"title":"Artifact Naming Convention","permalink":"/docs/next/Reference/artifacts"},"next":{"title":"Configuration","permalink":"/docs/next/Reference/configuration"}}');var i=r(74848),t=r(28453),s=r(11470),a=r(19365);const l={title:"AuroraBoot",sidebar_label:"AuroraBoot",sidebar_position:1,description:"Reference documentation for AuroraBoot, a tool for generating bootable images"},d=void 0,c={},h=[{value:"Scope",id:"scope",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"MacOS",id:"macos",level:2},{value:"Windows",id:"windows",level:2},{value:"Overview",id:"overview",level:2},{value:"Network-based bootstrapping",id:"network-based-bootstrapping",level:3},{value:"1. Selecting a release",id:"1-selecting-a-release",level:4},{value:"2. Run AuroraBoot",id:"2-run-auroraboot",level:4},{value:"3. Start nodes",id:"3-start-nodes",level:4},{value:"USB-based bootstrapping",id:"usb-based-bootstrapping",level:3},{value:"1. Node configuration",id:"1-node-configuration",level:4},{value:"2. Create an offline ISO",id:"2-create-an-offline-iso",level:4},{value:"2. Run the image",id:"2-run-the-image",level:4},{value:"Configuration",id:"configuration",level:2},{value:"Cloud config",id:"cloud-config",level:3},{value:"Examples",id:"examples",level:2},{value:"Offline ISO build from local container image",id:"offline-iso-build-from-local-container-image",level:3},{value:"Offline ISO build from container images",id:"offline-iso-build-from-container-images",level:3},{value:"Override GRUB config file",id:"override-grub-config-file",level:3},{value:"Prepare ISO for Airgap installations",id:"prepare-iso-for-airgap-installations",level:3},{value:"Netboot with core images from Github releases",id:"netboot-with-core-images-from-github-releases",level:3},{value:"Netboot with k3s images from Github releases",id:"netboot-with-k3s-images-from-github-releases",level:3},{value:"Netboot from container images",id:"netboot-from-container-images",level:3},{value:"Generate RAW disk images",id:"generate-raw-disk-images",level:3},{value:"Use the config file",id:"use-the-config-file",level:3},{value:"Booting with UKI and Secure Boot via HTTP Boot",id:"booting-with-uki-and-secure-boot-via-http-boot",level:2},{value:"How it Works",id:"how-it-works",level:2},{value:"Preparing the Boot Environment",id:"preparing-the-boot-environment",level:2},{value:"Resources",id:"resources",level:2}];function u(e){const o={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.admonition,{title:"Note",type:"info",children:(0,i.jsxs)(o.p,{children:["This is the reference documentation for AuroraBoot. For a complete guide on creating custom cloud images, including how to use AuroraBoot in the context of a full workflow, see ",(0,i.jsx)(o.a,{href:"./creating_custom_cloud_images",children:"Creating Custom Cloud Images"}),"."]})}),"\n",(0,i.jsxs)(o.p,{children:[(0,i.jsx)(o.strong,{children:"AuroraBoot"})," is a tool designed to make the process of bootstrapping Kairos machines quick, simple and efficient. It is specifically designed for the Kairos operating system and provides a comprehensive solution for downloading required artifacts and provisioning a machine, both from network or manually via flashing to USB stick."]}),"\n",(0,i.jsx)(o.p,{children:"With AuroraBoot, you can prepare the environment for network-based bootstrapping, download the necessary release assets, and also customize the installation media for USB-based mass-installations. Whether you're looking to install Kairos on a single machine or multiple machines, AuroraBoot makes it easy and efficient."}),"\n",(0,i.jsx)(o.p,{children:"AuroraBoot can be useful to:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"prepare multiple-nodes in a lab before shipment"}),"\n",(0,i.jsx)(o.li,{children:"offer a simple, intuitive and streamlined way to deploy Kairos automatically and manually"}),"\n",(0,i.jsx)(o.li,{children:"deploy Kairos nodes in a network segment where we can already send workload to (running AuroraBoot in an already-existing downstream cluster)"}),"\n",(0,i.jsx)(o.li,{children:"build artifacts of any type (isos, Trusted Boot, container upgrades, raw images, cloud images)"}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsx)(o.img,{src:"https://user-images.githubusercontent.com/2420543/217617696-f993a8e3-55ac-4d3e-98f0-c2317cb54cb9.png",alt:"AuroraBoot"})}),"\n",(0,i.jsx)(o.h2,{id:"scope",children:"Scope"}),"\n",(0,i.jsxs)(o.p,{children:[(0,i.jsx)(o.strong,{children:"AuroraBoot"})," has the following scope:"]}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Download"})," release assets in order to provision one or more machines"]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Prepare"})," automatically the environment to boot from network"]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Provision"})," machines from network with a version of Kairos and cloud config"]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Customize"})," The installation media for installations from USB"]}),"\n"]}),"\n",(0,i.jsx)(o.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"docker"})," or a container engine of your choice"]}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:"For netbooting:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["Port ",(0,i.jsx)(o.code,{children:"8090"}),", ",(0,i.jsx)(o.code,{children:"8080"})," and ",(0,i.jsx)(o.code,{children:"67"})," free on the host running AuroraBoot"]}),"\n",(0,i.jsx)(o.li,{children:"The machine running AuroraBoot have to be on the same network segment of the nodes to be bootstrapped"}),"\n",(0,i.jsx)(o.li,{children:"The nodes need to be configured to boot over network, or be capable of booting via USB for offline mode"}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"ProxyDHCP"})," supported by the ",(0,i.jsx)(o.code,{children:"DHCP"})," network attempting to netboot (see also ",(0,i.jsx)(o.a,{href:"https://github.com/danderson/netboot/blob/master/pixiecore/README.booting#step-1-dhcpproxydhcp",children:"pixiecore architecture"}),").\nThere should be an already running ",(0,i.jsx)(o.code,{children:"DHCP"})," server on your network. AuroraBoot doesn't take over the ",(0,i.jsx)(o.code,{children:"DHCP"})," server, neither require you to do any specific configuration, however a ",(0,i.jsx)(o.code,{children:"DHCP"})," server which is compliant to ",(0,i.jsx)(o.code,{children:"ProxyDHCP"})," requests should be present in the same network running ",(0,i.jsx)(o.strong,{children:"AuroraBoot"})," and the machines to boot."]}),"\n"]}),"\n",(0,i.jsx)(o.h2,{id:"macos",children:"MacOS"}),"\n",(0,i.jsxs)(o.p,{children:["Unfortunately for macOS systems we cannot run the netboot through docker as it's run inside a VM, as it can't see the host network.\nBuilding ISOs still works as long as you mount the container ",(0,i.jsx)(o.code,{children:"/tmp"})," disk to a local dir so its exported there like so:"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run --rm -ti -v "$PWD"/config.yaml:/config.yaml -v ${PWD}:/tmp quay.io/kairos/auroraboot \\\n                    --set "artifact_version=latest" \\\n                    --set "release_version=latest" \\\n                    --set "flavor=@flavor" \\\n                    --set "flavor_release=@flavorRelease" \\\n                    --set "repository=kairos-io/kairos" \\\n                    --set "disable_http_server=true" \\\n                    --set "disable_netboot=true" \\\n                    --cloud-config /config.yaml\n'})}),"\n",(0,i.jsxs)(o.p,{children:["This will build the ISO and put the generated artifacts in the current dir under the ",(0,i.jsx)(o.code,{children:"${PWD}/iso"})," dir."]}),"\n",(0,i.jsxs)(o.p,{children:["For netboot, we recommend that you run the AuroraBoot binary directly by grabbing it from the ",(0,i.jsx)(o.a,{href:"https://github.com/kairos-io/AuroraBoot/releases",children:"releases page"}),".\nThis requires just one dependency that you can install via ",(0,i.jsx)(o.a,{href:"https://brew.sh/",children:"brew"})," with ",(0,i.jsx)(o.code,{children:"brew install xorriso"})]}),"\n",(0,i.jsx)(o.h2,{id:"windows",children:"Windows"}),"\n",(0,i.jsx)(o.p,{children:"Netboot in windows is not supported, only iso creation via the docker image."}),"\n",(0,i.jsx)(o.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(o.p,{children:["To run AuroraBoot, simply use ",(0,i.jsx)(o.code,{children:"docker"})," or the container engine of your choice (such as ",(0,i.jsx)(o.code,{children:"podman"}),", ...). AuroraBoot images are published in ",(0,i.jsx)(o.a,{href:"https://quay.io/repository/kairos/auroraboot",children:"quay"})," and the source code is available ",(0,i.jsx)(o.a,{href:"https://github.com/kairos-io/AuroraBoot",children:"in GitHub"}),"."]}),"\n",(0,i.jsx)(o.p,{children:"The basic usage of AuroraBoot involves passing it several parameters that define the installation environment, such as the version of Kairos you want to install, the cloud config you want to use, and other customizations you may need. You can pass these parameters either as command-line arguments, or as a full YAML configuration file."}),"\n",(0,i.jsx)(o.p,{children:"AuroraBoot will download the artifacts required for bootstrapping the nodes, and prepare the environment required for a zero-touch deployment."}),"\n",(0,i.jsx)(o.p,{children:"For example, to netboot a machine with the latest version of Kairos and  using a cloud config, you would run the following command:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run --rm -ti --net host quay.io/kairos/auroraboot \\\n                    --set "artifact_version=latest" \\\n                    --set "release_version=latest" \\\n                    --set "flavor=@flavor" \\\n                    --set repository="kairos-io/kairos" \\\n                    --cloud-config https://...\n'})}),"\n",(0,i.jsx)(o.p,{children:"This command will download the necessary artifacts and start the provisioning process. The machine will attempt to boot from network, and will be configured with the specified version of Kairos."}),"\n",(0,i.jsx)(o.h3,{id:"network-based-bootstrapping",children:"Network-based bootstrapping"}),"\n",(0,i.jsx)(o.p,{children:"By default AuroraBoot will automatically attempt to bootstrap other machines, which are configured to boot from network, within the same network. No further configuration or settings necessary."}),"\n",(0,i.jsx)(o.p,{children:"There are only 3 steps involved in the process:"}),"\n",(0,i.jsxs)(o.ol,{children:["\n",(0,i.jsxs)(o.li,{children:["Select the release of Kairos that you want to deploy and optionally a cloud config (see also our ",(0,i.jsx)(o.a,{href:"../../examples",children:"examples"}),")"]}),"\n",(0,i.jsx)(o.li,{children:"Run AuroraBoot in your workstation with the appropriate CLI args"}),"\n",(0,i.jsx)(o.li,{children:"Boot up other nodes, already configured to boot from network"}),"\n"]}),"\n",(0,i.jsx)(o.h4,{id:"1-selecting-a-release",children:"1. Selecting a release"}),"\n",(0,i.jsx)(o.p,{children:"AuroraBoot can bootstrap container images or released assets from our GitHub release process."}),"\n",(0,i.jsxs)(o.p,{children:["To use GitHub releases set a release version with ",(0,i.jsx)(o.code,{children:"--set release_version"})," (the GitHub release), an artifact version with ",(0,i.jsx)(o.code,{children:"--set artifact_version"})," (the artifact version) a flavor with ",(0,i.jsx)(o.code,{children:"--set flavor"})," and a repository with ",(0,i.jsx)(o.code,{children:"--set repository"}),".\nKairos has releases with (standard) and without (core) k3s both can be downloaded in the ",(0,i.jsx)(o.a,{href:"https://github.com/kairos-io/kairos/releases",children:"release page at kairos"}),"."]}),"\n",(0,i.jsxs)(o.p,{children:["To use a container image, you can use ",(0,i.jsx)(o.a,{href:"../../reference/image_matrix",children:"the Kairos released images"})," or ",(0,i.jsx)(o.a,{href:"../../advanced/customizing",children:"customized"})," by specifying ",(0,i.jsx)(o.code,{children:"--set container_image"})," instead with the container image of choice."]}),"\n",(0,i.jsx)(o.h4,{id:"2-run-auroraboot",children:"2. Run AuroraBoot"}),"\n",(0,i.jsx)(o.p,{children:"Now we can run AuroraBoot with the version we selected, either from GitHub releases or directly from a container image."}),"\n",(0,i.jsxs)(o.p,{children:["In the example below we selected ",(0,i.jsx)(o.code,{children:"latest-\x3c!-- Hugo shortcode: k3sVersion  --\x3e"}),",  flavor, so we would run either one of the following:"]}),"\n","\n",(0,i.jsxs)(s.A,{children:[(0,i.jsxs)(a.A,{value:"container-image",label:"Container image",children:[(0,i.jsxs)(o.p,{children:["By indicating a ",(0,i.jsx)(o.code,{children:"container_image"}),", AuroraBoot will pull the image locally and start to serve it for network booting."]}),(0,i.jsxs)(o.p,{children:["You can use ",(0,i.jsx)(o.a,{href:"../../reference/image_matrix",children:"the Kairos released images"})," or ",(0,i.jsx)(o.a,{href:"../../advanced/customizing",children:"your own"}),"."]}),(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run --rm -ti --net host quay.io/kairos/auroraboot \\\n                    --set "container_image=quay.io/kairos/kairos-standard:latest"\n'})})]}),(0,i.jsxs)(a.A,{value:"container-image,-with-dockerd",label:"Container Image, with dockerd",children:[(0,i.jsxs)(o.p,{children:["By indicating a ",(0,i.jsx)(o.code,{children:"container_image"})," prefixed with ",(0,i.jsx)(o.code,{children:"docker://"}),", AuroraBoot will pull the image from the local daemon and start to serve it for network booting."]}),(0,i.jsxs)(o.p,{children:["This implies that the host has a docker daemon, and we have to give access to its socket with ",(0,i.jsx)(o.code,{children:"-v /var/run/docker.sock:/var/run/docker.sock"}),"."]}),(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker pull quay.io/kairos/kairos-standard:latest\n# This will use the container image from the host\'s docker daemon\ndocker run --rm -ti -v /var/run/docker.sock:/var/run/docker.sock --net host quay.io/kairos/auroraboot \\\n                    --set "container_image=docker://quay.io/kairos/kairos-standard:latest"\n'})})]}),(0,i.jsxs)(a.A,{value:"github-releases",label:"Github releases",children:[(0,i.jsxs)(o.p,{children:["By indicating a ",(0,i.jsx)(o.code,{children:"artifact_version"}),", a ",(0,i.jsx)(o.code,{children:"release_version"}),", a ",(0,i.jsx)(o.code,{children:"flavor"})," and a ",(0,i.jsx)(o.code,{children:"repository"}),", AuroraBoot will use GitHub released assets."]}),(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run --rm -ti --net host quay.io/kairos/auroraboot \\\n                    --set "artifact_version=latest-latest" \\\n                    --set "release_version=latest" \\\n                    --set "flavor=@flavor" \\\n                    --set "flavor_release=@flavorRelease" \\\n                    --set "repository=kairos-io/provider-kairos"\n'})})]})]}),"\n",(0,i.jsxs)(o.p,{children:["To specify a cloud config, you can set it with ",(0,i.jsx)(o.code,{children:"--cloud-config"}),". See the sections below for further examples."]}),"\n",(0,i.jsx)(o.h4,{id:"3-start-nodes",children:"3. Start nodes"}),"\n",(0,i.jsx)(o.p,{children:"Generic hardware based netbooting is out of scope for this document."}),"\n",(0,i.jsx)(o.p,{children:"Nodes need to be configured to boot over network, and after AuroraBoot is started should be ready to accept a connection, a typical output of a successfull run is:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'2023/02/08 14:27:30 DHCP: Offering to boot 08:00:27:54:1a:d1\n2023/02/08 14:27:30 TFTP: Sent "08:00:27:54:1a:d1/4" to 192.168.68.113:6489\n2023/02/08 14:27:36 DHCP: Offering to boot 08:00:27:54:1a:d1\n2023/02/08 14:27:36 HTTP: Sending ipxe boot script to 192.168.68.113:45435\n2023/02/08 14:27:36 HTTP: Sent file "kernel" to 192.168.68.113:45435\n2023/02/08 14:27:36 HTTP: Sent file "initrd-0" to 192.168.68.113:45435\n2023/02/08 14:27:49 HTTP: Sent file "other-0" to 192.168.68.113:43044\n'})}),"\n",(0,i.jsx)(o.p,{children:"If trying on a VM, for instance on VirtualBox or QEMU, a typical setup might be:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"Set Netboot as first boot in the boot process order"}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsx)(o.img,{src:"https://user-images.githubusercontent.com/2420543/217587463-cd293842-575e-4484-aee5-de46c4f053fb.png",alt:"Screenshot from 2023-02-08 10-37-59"})}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"Use bridge networking with the host (if running AuroraBoot and the VM in the same host)"}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsx)(o.img,{src:"https://user-images.githubusercontent.com/2420543/217587465-35486742-26a1-4971-bee0-3049d9ec329a.png",alt:"Screenshot from 2023-02-08 10-38-05"})}),"\n",(0,i.jsx)(o.h3,{id:"usb-based-bootstrapping",children:"USB-based bootstrapping"}),"\n",(0,i.jsxs)(o.p,{children:["AuroraBoot by default prepares an ISO with the custom cloud init prepared for being flashed to an USB stick either with ",(0,i.jsx)(o.code,{children:"dd"})," or with ",(0,i.jsx)(o.a,{href:"https://www.balena.io/etcher",children:"BalenaEtcher"}),"."]}),"\n",(0,i.jsxs)(o.p,{children:["To disable netboot and provide only offline artifacts, run ",(0,i.jsx)(o.code,{children:"auroraboot"})," with ",(0,i.jsx)(o.code,{children:"--set disable_netboot=true"}),"."]}),"\n",(0,i.jsx)(o.h4,{id:"1-node-configuration",children:"1. Node configuration"}),"\n",(0,i.jsxs)(o.p,{children:["Create a cloud config file, see ",(0,i.jsx)(o.a,{href:"../../examples",children:"our documentation"})," for ready-to use examples, but a minimal configuration that automatically installs, and allows us to login afterward can be the following:"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-yaml",children:'#cloud-config\n\ninstall:\n  auto: true\n  device: "auto"\n  reboot: true\n\n# Define the user accounts on the node.\nusers:\n- name: kairos                       # The username for the user.\n  passwd: kairos                      # The password for the user.\n  groups:\n  - admin\n  ssh_authorized_keys:                  # A list of SSH keys to add to the user\'s authorized keys.\n  # - github:mudler                       # A key from the user\'s GitHub account.\n  # - "ssh-rsa AAA..."                    # A raw SSH key.\n'})}),"\n",(0,i.jsxs)(o.p,{children:["Save the file locally or remotely, you can pass it by in the arguments with ",(0,i.jsx)(o.code,{children:"--cloud-config"})," to AuroraBoot. Note that can also be a remote http(s) path."]}),"\n",(0,i.jsx)(o.h4,{id:"2-create-an-offline-iso",children:"2. Create an offline ISO"}),"\n",(0,i.jsx)(o.p,{children:"Run AuroraBoot with a cloud-config to create an ISO with the embedded configuration:"}),"\n",(0,i.jsxs)(s.A,{children:[(0,i.jsxs)(a.A,{value:"container-image",label:"Container image",children:[(0,i.jsx)(o.p,{children:"Check we have the cloud config file:"}),(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:"ls\n# config.yaml\n"})}),(0,i.jsx)(o.p,{children:"Build the ISO:"}),(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run -v "$PWD"/config.yaml:/config.yaml \\\n                    -v "$PWD"/build:/tmp/auroraboot \\\n                    --rm -ti quay.io/kairos/auroraboot \\\n                    --set container_image=quay.io/kairos/kairos-core:latest \\\n                    --set "disable_http_server=true" \\\n                    --set "disable_netboot=true" \\\n                    --cloud-config /config.yaml \\\n                    --set "state_dir=/tmp/auroraboot"\n'})}),(0,i.jsxs)(o.p,{children:["Results should be available under ",(0,i.jsx)(o.code,{children:"build/"})," in the current directory:"]}),(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:"sudo ls -liah build/iso\n#\n# total 778M\n# 34648528 drwx------ 2 root root 4.0K Feb  8 16:39 .\n# 34648526 drwxr-xr-x 5 root root 4.0K Feb  8 16:38 ..\n# 34648529 -rw-r--r-- 1 root root  253 Feb  8 16:38 config.yaml\n# 34649370 -rw-r--r-- 1 root root 389M Feb  8 16:38 kairos.iso\n# 34649372 -rw-r--r-- 1 root root 389M Feb  8 16:39 kairos.iso.custom.iso\n# 34649371 -rw-r--r-- 1 root root   76 Feb  8 16:39 kairos.iso.sha256\n"})})]}),(0,i.jsxs)(a.A,{value:"github-releases",label:"Github releases",children:[(0,i.jsx)(o.p,{children:"Check we have the cloud config file:"}),(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:"ls\n# config.yaml\n"})}),(0,i.jsx)(o.p,{children:"Build the ISO:"}),(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run -v "$PWD"/build:/tmp/auroraboot -v /var/run/docker.sock:/var/run/docker.sock --rm -ti quay.io/kairos/auroraboot \\\n                    --set "artifact_version=latest-latest" \\\n                    --set "release_version=latest" \\\n                    --set "flavor=@flavor" \\\n                    --set "flavor_release=@flavorRelease" \\\n                    --set "repository=kairos-io/provider-kairos" \\\n                    --set "disable_http_server=true" \\\n                    --set "disable_netboot=true" \\\n                    --cloud-config /config.yaml \\\n                    --set "state_dir=/tmp/auroraboot"\n'})}),(0,i.jsxs)(o.p,{children:["Results should be available under ",(0,i.jsx)(o.code,{children:"build/"})," in the current directory:"]}),(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:"sudo ls -liah build/iso\n#\n# total 778M\n# 34648528 drwx------ 2 root root 4.0K Feb  8 16:39 .\n# 34648526 drwxr-xr-x 5 root root 4.0K Feb  8 16:38 ..\n# 34648529 -rw-r--r-- 1 root root  253 Feb  8 16:38 config.yaml\n# 34649370 -rw-r--r-- 1 root root 389M Feb  8 16:38 kairos.iso\n# 34649372 -rw-r--r-- 1 root root 389M Feb  8 16:39 kairos.iso.custom.iso\n# 34649371 -rw-r--r-- 1 root root   76 Feb  8 16:39 kairos.iso.sha256\n"})})]})]}),"\n",(0,i.jsxs)(o.p,{children:["The result process will write an iso ",(0,i.jsx)(o.code,{children:"kairos.iso.custom.iso"})," under ",(0,i.jsx)(o.code,{children:"build/iso"}),". That is the iso with our embedded cloud-config."]}),"\n",(0,i.jsx)(o.h4,{id:"2-run-the-image",children:"2. Run the image"}),"\n",(0,i.jsxs)(o.p,{children:["The iso now is ready to be written to USB stick with either ",(0,i.jsx)(o.code,{children:"dd"})," or with ",(0,i.jsx)(o.a,{href:"https://www.balena.io/etcher",children:"BalenaEtcher"}),", or attached to a VM."]}),"\n",(0,i.jsxs)(s.A,{children:[(0,i.jsxs)(a.A,{value:"bare-metal",label:"Bare-Metal",children:[(0,i.jsx)(o.p,{children:"When deploying on a bare metal server, directly flash the image into a USB stick. There are multiple ways to do this:"}),(0,i.jsx)(o.p,{children:(0,i.jsxs)(o.strong,{children:["From the command line using the ",(0,i.jsx)(o.code,{children:"dd"})," command"]})}),(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:"dd if=build/kairos.iso.custom.iso of=/path/to/dev bs=4MB\n"})}),(0,i.jsxs)(o.p,{children:["or with ",(0,i.jsx)(o.a,{href:"https://www.balena.io/etcher",children:"BalenaEtcher"}),"."]})]}),(0,i.jsxs)(a.A,{value:"qemu",label:"QEMU",children:[(0,i.jsx)(o.admonition,{title:"Warning",type:"warning",children:(0,i.jsx)(o.p,{children:"Make sure you have KVM enabled, this will improve the performance of your VM significantly!"})}),(0,i.jsx)(o.p,{children:"This would be the way to start it via the command line, but you can also use the GUI"}),(0,i.jsxs)(o.p,{children:["virt-install --name my-first-kairos-vm ",(0,i.jsx)(o.br,{}),"\n","--vcpus 1 ",(0,i.jsx)(o.br,{}),"\n","--memory 1024 ",(0,i.jsx)(o.br,{}),"\n","--cdrom build/kairos.iso.custom.iso ",(0,i.jsx)(o.br,{}),"\n","--disk size=30 ",(0,i.jsx)(o.br,{}),"\n","--os-variant opensuse-factory ",(0,i.jsx)(o.br,{}),"\n","--virt-type kvm"]}),(0,i.jsx)(o.p,{children:"Immediately after open a viewer so you can interact with the boot menu:"}),(0,i.jsx)(o.p,{children:"virt-viewer my-first-kairos-vm"})]})]}),"\n",(0,i.jsx)(o.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(o.p,{children:"The AuroraBoot configuration file reference is the following:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-yaml",children:'# Corresponding artifact versions from the kairos release page (e.g. kubernetes version included)\nartifact_version: "v..."\n# Version of the release in github\nrelease_version: "latest"\n\n# Flavor\nflavor: "@flavor"\n\n# Github repository\nrepository: "kairos-io/kairos"\n\n# Container image (takes over)\ncontainer_image: "..."\n\n# Disable netboot\ndisable_netboot: true\n\n# Disable http server for serving offline generated ISOs\ndisable_http_server: true\n\n# Specify a directory that will be used by auroraboot to download artifacts\n# Reuse the same to cache artifacts.\nstate_dir: "/tmp/auroraboot"\n\n# Default http binding port for offline ISO generation\nlisten_addr: ":8080"\n\n# Cloud config to use when booting the machine.\ncloud_config: |\n'})}),"\n",(0,i.jsxs)(o.table,{children:[(0,i.jsx)(o.thead,{children:(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.th,{children:"Option"}),(0,i.jsx)(o.th,{children:"Description"})]})}),(0,i.jsxs)(o.tbody,{children:[(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"artifact_version"})}),(0,i.jsx)(o.td,{children:"Corresponding artifact versions from the Kairos release page (e.g. Kubernetes version included)."})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"release_version"})}),(0,i.jsx)(o.td,{children:"Version of the release in GitHub."})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"flavor"})}),(0,i.jsxs)(o.td,{children:["The Kairos flavor to use. See ",(0,i.jsx)(o.a,{href:"../../reference/image_matrix",children:"the Kairos support matrix"})," for a list."]})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"repository"})}),(0,i.jsxs)(o.td,{children:["Github repository to use. This can either be ",(0,i.jsx)(o.code,{children:"kairos-io/kairos"})," or ",(0,i.jsx)(o.code,{children:"kairos-io/provider-kairos"})," for images with ",(0,i.jsx)(o.code,{children:"k3s"})," prior to v2.4.0."]})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"container_image"})}),(0,i.jsxs)(o.td,{children:["Container image. If prefixed with ",(0,i.jsx)(o.code,{children:"docker://"})," it will try to pull from the local docker daemon. If a ",(0,i.jsx)(o.code,{children:"container_image"})," is specified, ",(0,i.jsx)(o.code,{children:"artifact_version"}),", ",(0,i.jsx)(o.code,{children:"flavor"})," and ",(0,i.jsx)(o.code,{children:"release_version"})," are ignored."]})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"disable_netboot"})}),(0,i.jsx)(o.td,{children:"Disable netboot."})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"disable_http_server"})}),(0,i.jsx)(o.td,{children:"Disable http server for serving offline generated ISOs."})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"netboot_http_port"})}),(0,i.jsxs)(o.td,{children:["Specify a netboot HTTP port (defaults to ",(0,i.jsx)(o.code,{children:"8090"}),")."]})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"state_dir"})}),(0,i.jsx)(o.td,{children:"Specify a directory that will be used by auroraboot to download artifacts and reuse the same to cache artifacts."})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"listen_addr"})}),(0,i.jsx)(o.td,{children:"Default http binding port for offline ISO generation."})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"cloud_config"})}),(0,i.jsxs)(o.td,{children:["Cloud config path to use for the machines. A URL can be specified, use ",(0,i.jsx)(o.code,{children:"-"})," to pass-by the cloud-config from ",(0,i.jsx)(o.em,{children:"STDIN"})]})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"iso.data"})}),(0,i.jsxs)(o.td,{children:["Defines a path to be embedded into the resulting iso. When booting, the files will be accessible at ",(0,i.jsx)(o.code,{children:"/run/initramfs/live"})]})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"netboot.cmdline"})}),(0,i.jsxs)(o.td,{children:["Override the automatically generated cmdline with a custom one to use during netboot. ",(0,i.jsx)(o.code,{children:"config_url"})," and ",(0,i.jsx)(o.code,{children:"rootfs"}),"  are automatically constructed. A reasonable value can be ",(0,i.jsx)(o.code,{children:"netboot.cmdline=rd.neednet=1 ip=dhcp rd.cos.disable netboot install-mode console=tty0"})]})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"disk.state_size"})}),(0,i.jsx)(o.td,{children:"Set the minimum size (in MB) for the state partition in raw disk images. By default, the state partition is sized to 3 times the size of the current image plus some additional space for system files. Use this option to override the default size if you need to accommodate larger future images."})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"disk.efi"})}),(0,i.jsxs)(o.td,{children:["Generate an EFI-compatible raw disk image (suitable for AWS and QEMU). When set to ",(0,i.jsx)(o.code,{children:"true"}),", the image will be created with EFI boot support."]})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"disk.size"})}),(0,i.jsxs)(o.td,{children:["Set the final size (in MB) of the generated disk image. By default, the image size is calculated based on the actual data size. Use this option to create a larger disk image (e.g. ",(0,i.jsx)(o.code,{children:"disk.size=16000"})," will create a 16GB image)."]})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"disk.bios"})}),(0,i.jsxs)(o.td,{children:["Generate a BIOS-compatible raw disk image. When set to ",(0,i.jsx)(o.code,{children:"true"}),", the image will be created with legacy BIOS boot support instead of EFI."]})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"disk.vhd"})}),(0,i.jsxs)(o.td,{children:["Generate an Azure-compatible VHD image. When set to ",(0,i.jsx)(o.code,{children:"true"}),", the image will be created in VHD format suitable for Azure cloud platform."]})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:(0,i.jsx)(o.code,{children:"disk.gce"})}),(0,i.jsxs)(o.td,{children:["Generate a Google Cloud Engine (GCE) compatible image. When set to ",(0,i.jsx)(o.code,{children:"true"}),", the image will be created in a format suitable for Google Cloud Platform."]})]}),(0,i.jsxs)(o.tr,{children:[(0,i.jsx)(o.td,{children:"To use the configuration file with AuroraBoot, run AuroraBoot specifying the file or URL of the config as first argument:"}),(0,i.jsx)(o.td,{})]})]})]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run --rm -ti -v "$PWD"/config.yaml:/config.yaml --net host quay.io/kairos/auroraboot /config.yaml\n'})}),"\n",(0,i.jsxs)(o.p,{children:["The CLI options can be used in place of specifying a file, and to set fields of it. Any field of the YAML file, excluding ",(0,i.jsx)(o.code,{children:"cloud_config"})," can be configured with the ",(0,i.jsx)(o.code,{children:"--set"})," for instance, to disable netboot we can run AuroraBoot with:"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run --rm -ti --net host quay.io/kairos/auroraboot ....  --set "disable_netboot=true"\n'})}),"\n",(0,i.jsxs)(o.p,{children:["To specify a cloud config file instead, use ",(0,i.jsx)(o.code,{children:"--cloud-config"})," (can be also url):"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run --rm -ti -v "$PWD"/config.yaml:/config.yaml --net host quay.io/kairos/auroraboot .... --cloud-config /config.yaml\n'})}),"\n",(0,i.jsx)(o.p,{children:"Both the config file and the cloud-config file can be a URL."}),"\n",(0,i.jsx)(o.h3,{id:"cloud-config",children:"Cloud config"}),"\n",(0,i.jsxs)(o.p,{children:["A custom cloud configuration file can be passed either with the ",(0,i.jsx)(o.code,{children:"--cloud-config"})," flag, or in the AuroraBoot configuration file under the ",(0,i.jsx)(o.code,{children:"cloud_config"})," key."]}),"\n",(0,i.jsxs)(o.p,{children:["It is possible to apply templating to a cloud config. Indeed any value passed to ",(0,i.jsx)(o.code,{children:"--set"})," is accessible as a template in the cloud config file with the ",(0,i.jsx)(o.code,{children:"[["})," and ",(0,i.jsx)(o.code,{children:"]]"})," delimiter, for instance consider the following cloud config file, which allows to set a password for the ",(0,i.jsx)(o.code,{children:"kairos"})," user and a GitHub handle allowed to login to the machine:"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-yaml",children:'#cloud-config\n\ninstall:\n  auto: true\n  device: "auto"\n  reboot: true\n\n# Define the user accounts on the node.\nusers:\n- name: "kairos"                       # The username for the user.\n  passwd: "[[.kairos.password]]"                      # The password for the user.\n  groups:\n  - admin\n  ssh_authorized_keys:                  # A list of SSH keys to add to the user\'s authorized keys.\n  - github:[[.github.user]]\n'})}),"\n",(0,i.jsxs)(o.p,{children:["We would then set the user to ",(0,i.jsx)(o.code,{children:"mudler"})," and the password to ",(0,i.jsx)(o.code,{children:"foobar"})," when running AuroraBoot like the following:"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run --rm -ti -v "$PWD"/config.yaml:/config.yaml --net host \\\n                                quay.io/kairos/auroraboot \\\n                                --cloud-config /config.yaml \\\n                                --set "github.user=mudler" \\\n                                --set "kairos.password=foobar"\n'})}),"\n",(0,i.jsx)(o.p,{children:"Config files can be also hosted remotely, and given as URLs to AuroraBoot."}),"\n",(0,i.jsx)(o.p,{children:"We can indeed use the template in the example folder with the command above:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run --rm -ti --net host \\\n                        quay.io/kairos/auroraboot \\\n                        --cloud-config https://raw.githubusercontent.com/kairos-io/kairos/master/examples/auroraboot/master-template.yaml \\\n                        --set "github.user=mudler" \\\n                        --set "kairos.password=foobar"\n'})}),"\n",(0,i.jsxs)(o.p,{children:["To pass-by a cloud-config via pipes, set ",(0,i.jsx)(o.code,{children:"--cloud-config -"}),", for example:"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-yaml",children:'cat <<EOF | docker run --rm -i --net host quay.io/kairos/auroraboot \\\n                    --cloud-config - \\\n                    --set "container_image=quay.io/kairos/kairos-standard:latest"\n#cloud-config\n\ninstall:\n device: "auto"\n auto: true\n reboot: true\n\nhostname: metal-bundle-test-{{ trunc 4 .MachineID }}\n\nusers:\n- name: kairos\n  # Change to your pass here\n  passwd: kairos\n  groups:\n  - admin\n  ssh_authorized_keys:\n  # Replace with your github user and un-comment the line below:\n  - github:mudler\n\nk3s:\n  enabled: true\n\n# Specify the bundle to use\nbundles:\n- targets:\n  - run://quay.io/kairos/community-bundles:cert-manager_latest\n  - run://quay.io/kairos/community-bundles:kairos_latest\n\nkairos:\n  entangle:\n    enable: true\nEOF\n'})}),"\n",(0,i.jsx)(o.h2,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(o.admonition,{title:"Note",type:"note",children:(0,i.jsxs)(o.p,{children:["The example below are implying a ",(0,i.jsx)(o.code,{children:"config.yaml"})," cloud config file to be present in the current directory."]})}),"\n",(0,i.jsx)(o.h3,{id:"offline-iso-build-from-local-container-image",children:"Offline ISO build from local container image"}),"\n",(0,i.jsx)(o.p,{children:"First make sure we have the image locally with:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:"docker pull <IMAGE>\n"})}),"\n",(0,i.jsx)(o.p,{children:"Build the custom ISO with the cloud config:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run -v "$PWD"/config.yaml:/config.yaml \\\n             -v "$PWD"/build:/tmp/auroraboot \\\n             -v /var/run/docker.sock:/var/run/docker.sock \\\n             --rm -ti quay.io/kairos/auroraboot \\\n             --set container_image=docker://<IMAGE> \\\n             --set "disable_http_server=true" \\\n             --set "disable_netboot=true" \\\n             --cloud-config /config.yaml \\\n             --set "state_dir=/tmp/auroraboot"\n'})}),"\n",(0,i.jsx)(o.h3,{id:"offline-iso-build-from-container-images",children:"Offline ISO build from container images"}),"\n",(0,i.jsx)(o.p,{children:"Build the custom ISO with the cloud config:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run -v "$PWD"/config.yaml:/config.yaml \\\n             -v "$PWD"/build:/tmp/auroraboot \\\n             --rm -ti quay.io/kairos/auroraboot \\\n             --set container_image=quay.io/kairos/kairos-core:latest \\\n             --set "disable_http_server=true" \\\n             --set "disable_netboot=true" \\\n             --cloud-config /config.yaml \\\n             --set "state_dir=/tmp/auroraboot"\n'})}),"\n",(0,i.jsx)(o.h3,{id:"override-grub-config-file",children:"Override GRUB config file"}),"\n",(0,i.jsx)(o.p,{children:"It is possible to override the default GRUB config file of the ISO by creating a directory that\ncontains the files that we want to add or replace in it."}),"\n",(0,i.jsx)(o.p,{children:"For example, to override the GRUB config file:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'mkdir -p data/boot/grub2\n# You can replace this step with your own grub config. This GRUB configuration is the boot menu of the ISO\nwget https://raw.githubusercontent.com/kairos-io/packages/main/packages/livecd/grub2/config/grub_live_bios.cfg -O data/boot/grub2/grub.cfg\n\ndocker run -v "$PWD"/config.yaml:/config.yaml \\\n             -v "$PWD"/data:/tmp/data \\\n             -v "$PWD"/build:/tmp/auroraboot \\\n             --rm -ti quay.io/kairos/auroraboot \\\n             --set container_image=quay.io/kairos/kairos-core:latest \\\n             --set "disable_http_server=true" \\\n             --set "disable_netboot=true" \\\n             --cloud-config /config.yaml \\\n             --set "state_dir=/tmp/auroraboot" \\\n             --set "iso.data=/tmp/data"\n'})}),"\n",(0,i.jsx)(o.h3,{id:"prepare-iso-for-airgap-installations",children:"Prepare ISO for Airgap installations"}),"\n",(0,i.jsxs)(o.p,{children:["See the ",(0,i.jsx)(o.a,{href:"../../examples/airgap",children:"Airgap example"})," in the ",(0,i.jsx)(o.a,{href:"../../examples",children:"examples section"}),"."]}),"\n",(0,i.jsx)(o.h3,{id:"netboot-with-core-images-from-github-releases",children:"Netboot with core images from Github releases"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run -v "$PWD"/config.yaml:/config.yaml --rm -ti --net host quay.io/kairos/auroraboot \\\n        --set "artifact_version=latest" \\\n        --set "release_version=latest" \\\n        --set "flavor=@flavor" \\\n        --set repository="kairos-io/kairos" \\\n        --cloud-config /config.yaml\n'})}),"\n",(0,i.jsx)(o.h3,{id:"netboot-with-k3s-images-from-github-releases",children:"Netboot with k3s images from Github releases"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run -v "$PWD"/config.yaml:/config.yaml --rm -ti --net host quay.io/kairos/auroraboot \\\n        --set "artifact_version=latest-latest" \\\n        --set "release_version=latest" \\\n        --set "flavor=@flavor" \\\n        --set "flavor_release=@flavorRelease" \\\n        --set "repository=kairos-io/provider-kairos" \\\n        --cloud-config /config.yaml\n'})}),"\n",(0,i.jsx)(o.h3,{id:"netboot-from-container-images",children:"Netboot from container images"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run -v "$PWD"/config.yaml:/config.yaml --rm -ti --net host quay.io/kairos/auroraboot \\\n        --set container_image=quay.io/kairos/kairos-core:latest\n        --cloud-config /config.yaml\n'})}),"\n",(0,i.jsx)(o.h3,{id:"generate-raw-disk-images",children:"Generate RAW disk images"}),"\n",(0,i.jsx)(o.admonition,{title:"Note",type:"note",children:(0,i.jsxs)(o.p,{children:["This method differs from the ones documented in the ",(0,i.jsx)(o.a,{href:"./build_raw_images_with_qemu",children:"Build raw images with QEMU"})," section: this method is suitable if you need to create appliances that have to run a full-installation. AuroraBoot will create instead images pre-installed which will skip the usual Kairos installation process in runtime"]})}),"\n",(0,i.jsx)(o.p,{children:"Consider the following example:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run --privileged -v /var/run/docker.sock:/var/run/docker.sock \\\n  -v $PWD:/aurora --rm -ti quay.io/kairos/auroraboot \\\n  --debug \\\n  --set "disable_http_server=true" \\\n  --set "disable_netboot=true" \\\n  --set "disk.efi=true" \\\n  --set "container_image=quay.io/kairos/kairos-standard:latest" \\\n  --set "state_dir=/aurora"\n'})}),"\n",(0,i.jsxs)(o.p,{children:["The raw disk image will be available in the current directory with the ",(0,i.jsx)(o.code,{children:".raw"})," image extension. By default, the state partition will be sized to 3 times the size of the current image plus some additional space for system files."]}),"\n",(0,i.jsxs)(o.p,{children:["If you need to ensure the state partition can accommodate larger future images, you can override the default size with ",(0,i.jsx)(o.code,{children:"disk.state_size"}),":"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run --privileged -v /var/run/docker.sock:/var/run/docker.sock \\\n  -v $PWD:/aurora --rm -ti quay.io/kairos/auroraboot \\\n  --debug \\\n  --set "disable_http_server=true" \\\n  --set "disable_netboot=true" \\\n  --set "disk.efi=true" \\\n  --set "disk.state_size=6000" \\\n  --set "container_image=quay.io/kairos/kairos-standard:latest" \\\n  --set "state_dir=/aurora"\n'})}),"\n",(0,i.jsxs)(o.p,{children:["To generate a BIOS raw image just change ",(0,i.jsx)(o.code,{children:"disk.efi=true"})," for ",(0,i.jsx)(o.code,{children:"disk.bios=true"})]}),"\n",(0,i.jsxs)(o.p,{children:["To generate GCE and VHD images set ",(0,i.jsx)(o.code,{children:"disk.gce=true"})," or ",(0,i.jsx)(o.code,{children:"disk.vhd=true"})," respectively in the AuroraBoot command. For example:"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'# Build a GCE-compatible image\ndocker run --privileged -v /var/run/docker.sock:/var/run/docker.sock \\\n  -v $PWD:/aurora --rm -ti quay.io/kairos/auroraboot \\\n  --debug \\\n  --set "disable_http_server=true" \\\n  --set "container_image=quay.io/kairos/kairos-standard:latest" \\\n  --set "disable_netboot=true" \\\n  --cloud-config /aurora/config.yaml \\\n  --set "disk.gce=true" \\\n  --set "state_dir=/aurora"\n'})}),"\n",(0,i.jsx)(o.p,{children:"or for VHD images:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'# Build a VHD image compatible with Azure\ndocker run --privileged -v /var/run/docker.sock:/var/run/docker.sock \\\n  -v $PWD:/aurora --rm -ti quay.io/kairos/auroraboot \\\n  --debug \\\n  --set "disable_http_server=true" \\\n  --set "container_image=quay.io/kairos/kairos-standard:latest" \\\n  --set "disable_netboot=true" \\\n  --cloud-config /aurora/config.yaml \\\n  --set "disk.vhd=true" \\\n  --set "state_dir=/aurora"\n'})}),"\n",(0,i.jsx)(o.admonition,{title:"Note",type:"warning",children:(0,i.jsxs)(o.p,{children:["Note that for creating raw images, the ",(0,i.jsx)(o.code,{children:"--privileged"})," flag is used as the process creates loop devices, which\nrequires elevated privileges. This is not needed for the other methods of using AuroraBoot."]})}),"\n",(0,i.jsx)(o.h3,{id:"use-the-config-file",children:"Use the config file"}),"\n",(0,i.jsxs)(o.p,{children:["Write down an aurora config file as ",(0,i.jsx)(o.code,{children:"aurora.yaml"}),":"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-yaml",children:'container_image: "quay.io/kairos/kairos-core:latest"\n\ncloud_config: |\n    #cloud-config\n\n    install:\n    auto: true\n    device: "auto"\n    reboot: true\n\n    # Define the user accounts on the node.\n    users:\n    - name: kairos                       # The username for the user.\n      passwd: kairos                      # The password for the user.\n      groups:\n      - admin\n    ssh_authorized_keys:                  # A list of SSH keys to add to the user\'s authorized keys.\n    # - github:mudler                       # A key from the user\'s GitHub account.\n    # - "ssh-rsa AAA..."                    # A raw SSH key.\n'})}),"\n",(0,i.jsx)(o.p,{children:"And then run:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'docker run -v "$PWD"/aurora.yaml:/aurora.yaml --rm -ti --net host quay.io/kairos/auroraboot /aurora.yaml\n'})}),"\n",(0,i.jsx)(o.h2,{id:"booting-with-uki-and-secure-boot-via-http-boot",children:"Booting with UKI and Secure Boot via HTTP Boot"}),"\n",(0,i.jsx)(o.admonition,{title:"Version support",type:"warning",children:(0,i.jsx)(o.p,{children:"This feature is available on AuroraBoot v0.8.1 and later, and requires Kairos version 3.5.x or higher.\nCurrently, only HTTP boot has been tested and validated for this setup. PXE booting with UKI and Secure Boot is not yet supported and probably wont be."})}),"\n",(0,i.jsxs)(o.p,{children:["AuroraBoot supports netbooting ",(0,i.jsx)(o.strong,{children:"Trusted Boot Images (UKI)"}),". This process relies on using HTTP Boot to enroll the necessary keys and boot the UKI ISO directly as a virtual CDROM which is a UEFI 2.5 feature."]}),"\n",(0,i.jsx)(o.h2,{id:"how-it-works",children:"How it Works"}),"\n",(0,i.jsx)(o.admonition,{title:"Info",type:"info",children:(0,i.jsx)(o.p,{children:'To use this feature, the machine needs to start in "setup" mode, which means secure boot is disabled and there are no keys enrolled in the firmware. Otherwise the machine won\'t boot the UKI ISO, as it will not be able to enroll the keys.'})}),"\n",(0,i.jsxs)(o.ol,{children:["\n",(0,i.jsx)(o.li,{children:"The machine boots HTTP Boot and loads the ISO."}),"\n",(0,i.jsx)(o.li,{children:"The ISO is loaded on memory and booted and systemd-boot enrolls the keys from the ISO into the firmware, allowing the UKI to boot and enabling Secure Boot."}),"\n",(0,i.jsx)(o.li,{children:"The machine reboots and HTTP boots the UKI ISO again, this time with Secure Boot enabled."}),"\n",(0,i.jsx)(o.li,{children:"The system boots fully from the UKI ISO into memory."}),"\n",(0,i.jsx)(o.li,{children:"The Kernel maps the ISO from the memory and presents it to the OS like any other media, allowing the OS to use it as an install source like if we booted from a USB stick or a CD-ROM."}),"\n"]}),"\n",(0,i.jsx)(o.hr,{}),"\n",(0,i.jsx)(o.h2,{id:"preparing-the-boot-environment",children:"Preparing the Boot Environment"}),"\n",(0,i.jsx)(o.p,{children:"You must provide:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["A ",(0,i.jsx)(o.strong,{children:"Trusted Boot Kairos ISO"})]}),"\n"]}),"\n",(0,i.jsxs)(o.p,{children:["For example if your ISO is at ",(0,i.jsx)(o.code,{children:"/opt/images/kairos-uki.iso"}),", start AuroraBoot with:"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:"docker run --privileged -v /opt/images/:/aurora --rm -ti quay.io/kairos/auroraboot uki-pxe /aurora/kairos-uki.iso\n"})}),"\n",(0,i.jsx)(o.hr,{}),"\n",(0,i.jsx)(o.h2,{id:"resources",children:"Resources"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:(0,i.jsx)(o.a,{href:"https://github.com/kairos-io/kairos-agent/pull/791",children:"kairos-agent PR #791"})}),"\n",(0,i.jsx)(o.li,{children:(0,i.jsx)(o.a,{href:"https://github.com/kairos-io/AuroraBoot/pull/276",children:"AuroraBoot PR #276"})}),"\n",(0,i.jsx)(o.li,{children:(0,i.jsx)(o.a,{href:"https://github.com/kairos-io/efi-key-enroller",children:"efi-key-enroller repo"})}),"\n"]})]})}function m(e={}){const{wrapper:o}={...(0,t.R)(),...e.components};return o?(0,i.jsx)(o,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},28453:(e,o,r)=>{r.d(o,{R:()=>s,x:()=>a});var n=r(96540);const i={},t=n.createContext(i);function s(e){const o=n.useContext(t);return n.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function a(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),n.createElement(t.Provider,{value:o},e.children)}}}]);