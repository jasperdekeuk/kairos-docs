"use strict";(globalThis.webpackChunkkairos_docs=globalThis.webpackChunkkairos_docs||[]).push([[1065],{28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var o=t(96540);const i={},s=o.createContext(i);function r(e){const n=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(s.Provider,{value:n},e.children)}},85628:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"Examples/multi-node-p2p","title":"Self-coordinating P2P multi-node cluster","description":"Install Kairos with p2p support, on a multi-node cluster","source":"@site/versioned_docs/version-3.5.7/Examples/multi-node-p2p.md","sourceDirName":"Examples","slug":"/Examples/multi-node-p2p","permalink":"/docs/3.5.7/Examples/multi-node-p2p","draft":false,"unlisted":false,"editUrl":"https://github.com/kairos-io/kairos-docs/tree/main/versioned_docs/version-3.5.7/Examples/multi-node-p2p.md","tags":[],"version":"3.5.7","lastUpdatedBy":"Jasper De Keukelaere (imec)","lastUpdatedAt":1765142882000,"frontMatter":{"title":"Self-coordinating P2P multi-node cluster","sidebar_label":"Self-coordinating P2P multi-node cluster","description":"Install Kairos with p2p support, on a multi-node cluster"},"sidebar":"tutorialSidebar","previous":{"title":"Self-coordinating P2P multi-node cluster HA","permalink":"/docs/3.5.7/Examples/multi-node-p2p-ha"},"next":{"title":"Manual multi-node cluster","permalink":"/docs/3.5.7/Examples/multi-node"}}');var i=t(74848),s=t(28453);const r={title:"Self-coordinating P2P multi-node cluster",sidebar_label:"Self-coordinating P2P multi-node cluster",description:"Install Kairos with p2p support, on a multi-node cluster"},a=void 0,l={},d=[];function c(e){const n={a:"a",admonition:"admonition",code:"code",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.admonition,{title:"Network",type:"warning",children:(0,i.jsx)(n.p,{children:"This feature is experimental and has only been tested on local setups. Run in production servers at your own risk.\nFeedback and bug reports are welcome, as we are improving the p2p aspects of Kairos."})}),"\n",(0,i.jsxs)(n.p,{children:["A multi-node scenario with non-HA is the default peer-to-peer (P2P) configuration in Kairos. To set this up, you will need to configure the ",(0,i.jsx)(n.code,{children:"network_token"})," under the ",(0,i.jsx)(n.code,{children:"p2p"})," configuration in your cloud-config file. Once you have set this, Kairos will handle the configuration of each node."]}),"\n",(0,i.jsx)(n.p,{children:"Consider the following example, which uses cloud-config to automatically configure the cluster:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'#cloud-config\n\nhostname: kairoslab-{{ trunc 4 .MachineID }}\nusers:\n- name: kairos\n  passwd: kairos\n  groups:\n    - admin\n  ssh_authorized_keys:\n  # Replace with your github user and un-comment the line below:\n  # - github:mudler\n\np2p:\n # Disabling DHT makes co-ordination to discover nodes only in the local network\n disable_dht: true #Enabled by default\n\n # network_token is the shared secret used by the nodes to co-ordinate with p2p.\n # Setting a network token implies auto.enable = true.\n # To disable, just set auto.enable = false\n network_token: ""\n\n'})}),"\n",(0,i.jsxs)(n.p,{children:["To set up a multi-node P2P scenario with non-HA in Kairos, start by adding your desired ",(0,i.jsx)(n.code,{children:"network_token"})," under the p2p configuration in the cloud-config file. To generate a network token, see ",(0,i.jsx)(n.a,{href:"../../installation/p2p#network_token",children:"documentation"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Be sure to set ",(0,i.jsx)(n.code,{children:"disable_dht"})," to true. This will ensure that coordination to discover nodes only happens on the local network."]}),"\n",(0,i.jsxs)(n.p,{children:["Once you done with the above step, you can also customize the hostname to your liking by modifying the ",(0,i.jsx)(n.code,{children:"hostname"})," field, adding your github user to the ",(0,i.jsx)(n.code,{children:"ssh_authorized_keys"})," field, and adding any other necessary configurations."]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);