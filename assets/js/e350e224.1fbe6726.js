"use strict";(globalThis.webpackChunkkairos_docs=globalThis.webpackChunkkairos_docs||[]).push([[3591],{27781:e=>{e.exports=JSON.parse('{"permalink":"/blog/kairos-init-announcement","editUrl":"https://github.com/kairos-io/kairos/tree/main/packages/create-kairos/templates/shared/blog/2025-03-26-kairos-init-announcement.md","source":"@site/blog/2025-03-26-kairos-init-announcement.md","title":"How We Rebuilt Kairos building From the Ground Up","description":"\ud83e\uddf1 Introduction","date":"2025-03-26T00:00:00.000Z","tags":[{"inline":false,"label":"Kairos","permalink":"/blog/tags/kairos","description":"Posts about Kairos, an open-source, cloud-native, and immutable Linux distribution"}],"readingTime":6.15,"hasTruncateMarker":true,"authors":[{"name":"Itxaka Serrano","socials":{"github":"https://github.com/itxaka"},"url":"https://github.com/itxaka","imageURL":"https://github.com/itxaka.png","key":"itxaka-serrano","page":null}],"frontMatter":{"authors":["itxaka-serrano"],"slug":"kairos-init-announcement","tags":["kairos"],"title":"How We Rebuilt Kairos building From the Ground Up"},"unlisted":false,"prevItem":{"title":"Kairos Meets k0s: A Meta-Distribution for Kubernetes is Born","permalink":"/blog/kairos-meets-k0s"},"nextItem":{"title":"How I Automated My Doorbell with Kairos (and You Can Too)","permalink":"/blog/kairos-doorbell"}}')},28453:(e,i,n)=>{n.d(i,{R:()=>o,x:()=>a});var r=n(96540);const s={},t=r.createContext(s);function o(e){const i=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(t.Provider,{value:i},e.children)}},47849:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var r=n(27781),s=n(74848),t=n(28453);const o={authors:["itxaka-serrano"],slug:"kairos-init-announcement",tags:["kairos"],title:"How We Rebuilt Kairos building From the Ground Up"},a=void 0,l={authorsImageUrls:[void 0]},d=[{value:"\ud83e\uddf1 Introduction",id:"-introduction",level:2},{value:"\ud83d\udc33 The Early Days: Building with Dockerfiles",id:"-the-early-days-building-with-dockerfiles",level:2},{value:"\ud83c\udf0d Scaling Painfully: Enter Earthly",id:"-scaling-painfully-enter-earthly",level:2},{value:"\ud83e\udde8 Reaching the Breaking Point",id:"-reaching-the-breaking-point",level:2},{value:"\ud83d\udee0\ufe0f We Tried Other Tools First",id:"\ufe0f-we-tried-other-tools-first",level:2},{value:"\u2728 The Breakthrough: <code>kairos-init</code> and Yip",id:"-the-breakthrough-kairos-init-and-yip",level:2},{value:"\ud83c\udf24 A Cleaner Future",id:"-a-cleaner-future",level:2},{value:"\ud83d\udd2d What\u2019s Next",id:"-whats-next",level:2},{value:"\ud83e\udded Conclusion",id:"-conclusion",level:2}];function c(e){const i={a:"a",code:"code",em:"em",h2:"h2",li:"li",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.h2,{id:"-introduction",children:"\ud83e\uddf1 Introduction"}),"\n",(0,s.jsx)(i.p,{children:"Building Kairos has always been about more than assembling images \u2014 it's about shaping a flexible, powerful OS tailored for the edge. Over the past couple of years, we've learned a lot while navigating how to build and maintain Kairos across a growing list of base distributions, architectures, and board-specific targets."}),"\n",(0,s.jsxs)(i.p,{children:["Today, we\u2019re excited to introduce something that marks a turning point in how Kairos is built: ",(0,s.jsx)(i.strong,{children:(0,s.jsx)(i.code,{children:"kairos-init"})}),"."]}),"\n",(0,s.jsx)(i.p,{children:"This post isn't just about a new tool. It\u2019s about simplifying complexity, rediscovering clarity, and embedding hard-earned lessons into something lean and extensible. If you've followed our journey, you'll know that we've gone from Dockerfiles to Earthly, and now to a new approach centered on declarative simplicity with Yip."}),"\n",(0,s.jsx)(i.p,{children:"In this post, we\u2019ll take you behind the scenes:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Why the old ways worked (until they didn\u2019t)"}),"\n",(0,s.jsx)(i.li,{children:"How we outgrew our tooling"}),"\n",(0,s.jsxs)(i.li,{children:["What ",(0,s.jsx)(i.code,{children:"kairos-init"})," changes \u2014 and why it matters"]}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"This is the story of how we rebuilt the foundation of Kairos, one layer at a time."}),"\n",(0,s.jsx)(i.h2,{id:"-the-early-days-building-with-dockerfiles",children:"\ud83d\udc33 The Early Days: Building with Dockerfiles"}),"\n",(0,s.jsxs)(i.p,{children:["When Kairos first took shape, our needs were simple. We wanted a predictable, repeatable way to turn a base Linux distribution into a fully working Kairos image. And at the time, the most straightforward path was through a set of handcrafted ",(0,s.jsx)(i.strong,{children:"Dockerfiles"})," \u2014 one for each supported base."]}),"\n",(0,s.jsx)(i.p,{children:"Need Kairos on Ubuntu? There was a Dockerfile for that. OpenSUSE? Another one. Want to tweak something for a Raspberry Pi or test an Alpine variant? Copy, paste, modify."}),"\n",(0,s.jsx)(i.p,{children:"This worked \u2014 until it didn\u2019t."}),"\n",(0,s.jsx)(i.p,{children:"At first, it was empowering. We could iterate quickly, test changes, and get a Kairos image up and running in no time. Each Dockerfile acted like a scriptable recipe for image creation. But as we started expanding support for more:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["\ud83e\uddf1 ",(0,s.jsx)(i.strong,{children:"Distributions"})," (Ubuntu 24.04, 22.04, 20.04, OpenSUSE, Alpine, Rocky, Fedora\u2026)"]}),"\n",(0,s.jsxs)(i.li,{children:["\ud83d\udce6 ",(0,s.jsx)(i.strong,{children:"Releases"})," (LTS, rolling, and experimental flavors across versions)"]}),"\n",(0,s.jsxs)(i.li,{children:["\u2699\ufe0f ",(0,s.jsx)(i.strong,{children:"Architectures"})," (x86_64, ARM64)"]}),"\n",(0,s.jsxs)(i.li,{children:["\ud83d\udce6 ",(0,s.jsx)(i.strong,{children:"Boards and platforms"})," (Raspberry Pi, NVIDIA Jetson, cloud providers\u2026)"]}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"\u2026 the number of Dockerfiles exploded."}),"\n",(0,s.jsxs)("p",{align:"center",children:[(0,s.jsx)("img",{src:"/img/init-1.png",alt:"Kairos Dockerfiles in the wild (Version 2.3.0)"}),(0,s.jsx)("br",{}),(0,s.jsx)("em",{children:"Kairos Dockerfiles in the wild (Version 2.3.0)"})]}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.em,{children:"Kairos Dockerfiles in the wild (Version 2.3.0)"})}),"\n",(0,s.jsx)(i.p,{children:"Maintaining them became a slow grind. Every distro had its quirks. Every version bump required tweaks. Repeating common steps across files introduced subtle bugs. And worst of all, it was hard to scale \u2014 we were reinventing the same process in N different places, each slightly different, each easy to break."}),"\n",(0,s.jsx)(i.p,{children:"We needed a better way."}),"\n",(0,s.jsx)(i.h2,{id:"-scaling-painfully-enter-earthly",children:"\ud83c\udf0d Scaling Painfully: Enter Earthly"}),"\n",(0,s.jsx)(i.p,{children:"As the number of supported distros, architectures, and boards grew, so did the pain of managing our Dockerfiles. It wasn\u2019t just about duplication anymore \u2014 it was about orchestration, coordination, and staying sane across a forest of moving parts."}),"\n",(0,s.jsxs)(i.p,{children:["So we took the next step and adopted ",(0,s.jsx)(i.strong,{children:(0,s.jsx)(i.a,{href:"https://earthly.dev/",children:"Earthly"})}),"."]}),"\n",(0,s.jsx)(i.p,{children:"Earthly gave us a powerful framework to unify and modularize our builds. Instead of one Dockerfile per case, we could define reusable steps, build pipelines, and cache logic across flavors and platforms. It brought real structure to our chaos."}),"\n",(0,s.jsx)(i.p,{children:"With Earthly, we gained:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["\ud83d\udd01 ",(0,s.jsx)(i.strong,{children:"Reusable modules"})," for common build logic"]}),"\n",(0,s.jsxs)(i.li,{children:["\ud83e\udde9 ",(0,s.jsx)(i.strong,{children:"Parameterized builds"})," across distros and versions"]}),"\n",(0,s.jsxs)(i.li,{children:["\ud83e\udde0 ",(0,s.jsx)(i.strong,{children:"Smarter caching"}),", which cut build times drastically"]}),"\n",(0,s.jsxs)(i.li,{children:["\ud83e\udd16 ",(0,s.jsx)(i.strong,{children:"Better CI integration"}),", especially in GitHub Actions"]}),"\n",(0,s.jsxs)(i.li,{children:["\ud83c\udfd7\ufe0f ",(0,s.jsx)(i.strong,{children:"Cross-architecture support"})," (building ARM images from x86 machines)"]}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"It was a massive improvement. Kairos became easier to scale, easier to extend, and more robust in CI/CD pipelines. We could merge several Dockerfiles into a single one for that given Flavor and make earthly trigger the right steps based on the target architecture or version."}),"\n",(0,s.jsxs)("p",{align:"center",children:[(0,s.jsx)("img",{src:"/img/init-2.png",alt:"Less lines is always better, right? (Version 3.3.1)"}),(0,s.jsx)("br",{}),(0,s.jsx)("em",{children:"Less lines is always better, right? (Version 3.3.1)"})]}),"\n",(0,s.jsx)(i.p,{children:"But the cost of complexity caught up with us."}),"\n",(0,s.jsx)(i.p,{children:"Earthly was powerful, but also heavy. Setting up the environment required more tooling and context. Onboarding new contributors meant explaining layers of build abstraction. And eventually, even Earthly couldn\u2019t fully hide the fact that we were fighting the complexity we had slowly built up."}),"\n",(0,s.jsx)(i.p,{children:"As our use cases expanded \u2014 with more devices, more customization, more flavors \u2014 our build logic became a tangled web of conditionals and overrides."}),"\n",(0,s.jsxs)("p",{align:"center",children:[(0,s.jsx)("img",{src:"/img/init-3.png",alt:"The Earthly pipeline grows instead (Version 3.3.1)"}),(0,s.jsx)("br",{}),(0,s.jsx)("em",{children:"The Earthly pipeline grows instead (Version 3.3.1)"})]}),"\n",(0,s.jsx)(i.p,{children:"We needed a reset. A system built from the start for clarity and adaptability."}),"\n",(0,s.jsx)(i.h2,{id:"-reaching-the-breaking-point",children:"\ud83e\udde8 Reaching the Breaking Point"}),"\n",(0,s.jsx)(i.p,{children:"By this stage, we had all the signs of a powerful yet brittle system."}),"\n",(0,s.jsx)(i.p,{children:"Every new board support request \u2014 whether for a Jetson device, RPi variant, or some obscure industrial box \u2014 meant another round of \u201chow do we fit this into the Earthly pipeline without breaking 10 other things?\u201d Even small changes to the build logic carried unintended ripple effects. Maintenance became a game of regression whack-a-mole."}),"\n",(0,s.jsx)(i.p,{children:"Our internal complexity had quietly outpaced the benefits of our tooling."}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["We were juggling ",(0,s.jsx)(i.strong,{children:"multiple abstraction layers"})]}),"\n",(0,s.jsxs)(i.li,{children:["Supporting a new architecture meant rewriting or extending ",(0,s.jsx)(i.strong,{children:"multiple Earthfiles"})]}),"\n",(0,s.jsx)(i.li,{children:"Troubleshooting builds required context-switching between tools and environments"}),"\n",(0,s.jsxs)(i.li,{children:["Most importantly, it became ",(0,s.jsx)(i.strong,{children:"hard for contributors to participate"})]}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:["That\u2019s when we stopped and asked: ",(0,s.jsx)(i.em,{children:"What if we could start fresh?"})]}),"\n",(0,s.jsxs)(i.p,{children:["The answer was ",(0,s.jsx)(i.code,{children:"kairos-init"}),"."]}),"\n",(0,s.jsx)(i.h2,{id:"\ufe0f-we-tried-other-tools-first",children:"\ud83d\udee0\ufe0f We Tried Other Tools First"}),"\n",(0,s.jsxs)(i.p,{children:["Before diving into ",(0,s.jsx)(i.code,{children:"kairos-init"}),", we explored other tools and frameworks hoping to find a better fit. But none of them quite matched the specific constraints of our ecosystem \u2014 building across multiple distros, versions, and architectures in a consistent, maintainable way."]}),"\n",(0,s.jsx)(i.p,{children:"So, we did what every developer dreams of: we built our own."}),"\n",(0,s.jsxs)(i.h2,{id:"-the-breakthrough-kairos-init-and-yip",children:["\u2728 The Breakthrough: ",(0,s.jsx)(i.code,{children:"kairos-init"})," and Yip"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.code,{children:"kairos-init"})," is a CLI tool that encapsulates everything needed to transform ",(0,s.jsx)(i.strong,{children:"any base Linux image"})," into a fully Kairos system \u2014 with nothing more than a standard ",(0,s.jsx)(i.code,{children:"Dockerfile"}),"."]}),"\n",(0,s.jsxs)(i.p,{children:["By running ",(0,s.jsx)(i.code,{children:"kairos-init BUILD"})," in a Dockerfile, it:"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Inspects the base image"}),"\n",(0,s.jsx)(i.li,{children:"Generates a Yip configuration"}),"\n",(0,s.jsxs)(i.li,{children:["Executes that config to:","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Install necessary packages"}),"\n",(0,s.jsx)(i.li,{children:"Add the Kairos framework (binaries, configs, init hooks)"}),"\n",(0,s.jsx)(i.li,{children:"Patch the initramfs"}),"\n",(0,s.jsx)(i.li,{children:"Link kernel files"}),"\n",(0,s.jsx)(i.li,{children:"Apply any workarounds or tweaks"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"The result is a container image that\u2019s Kairos-ready \u2014 no extra steps, no complex layering."}),"\n",(0,s.jsx)(i.p,{children:"You can then:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["Use it as an ",(0,s.jsx)(i.strong,{children:"upgrade image"})]}),"\n",(0,s.jsxs)(i.li,{children:["Extend it with Kubernetes runtimes like ",(0,s.jsx)(i.code,{children:"k3s"})," or ",(0,s.jsx)(i.code,{children:"k0s"})," using flags"]}),"\n",(0,s.jsxs)(i.li,{children:["Convert it into various formats with ",(0,s.jsx)(i.a,{href:"https://github.com/kairos-io/AuroraBoot",children:"AuroraBoot"}),":","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"ISO"}),"\n",(0,s.jsx)(i.li,{children:"Raw image"}),"\n",(0,s.jsx)(i.li,{children:"Cloud image"}),"\n",(0,s.jsx)(i.li,{children:"PXE bootable"}),"\n",(0,s.jsx)(i.li,{children:"EFI Unified System Image"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"And because it\u2019s just a Dockerfile, it drops right into any existing workflow:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"CI/CD pipelines"}),"\n",(0,s.jsx)(i.li,{children:"Local testing"}),"\n",(0,s.jsx)(i.li,{children:"Version-controlled infra repos"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"-a-cleaner-future",children:"\ud83c\udf24 A Cleaner Future"}),"\n",(0,s.jsxs)(i.p,{children:["With ",(0,s.jsx)(i.code,{children:"kairos-init"}),", we\u2019ve:"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Simplified builds down to one step"}),"\n",(0,s.jsx)(i.li,{children:"Removed the need for Earthly or complex pipelines"}),"\n",(0,s.jsx)(i.li,{children:"Made Kairos accessible to new contributors and integrators"}),"\n",(0,s.jsx)(i.li,{children:"Enabled future growth without growing technical debt"}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"We\u2019re no longer managing complexity \u2014 we\u2019ve replaced it with clarity."}),"\n",(0,s.jsx)(i.h2,{id:"-whats-next",children:"\ud83d\udd2d What\u2019s Next"}),"\n",(0,s.jsx)(i.p,{children:"What\u2019s ahead:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["More ",(0,s.jsx)(i.code,{children:"kairos-init"})," examples and docs"]}),"\n",(0,s.jsx)(i.li,{children:"Deep dives on Yip"}),"\n",(0,s.jsx)(i.li,{children:"Custom build guides"}),"\n",(0,s.jsx)(i.li,{children:"Community use cases"}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:["We\u2019re also eager to hear how ",(0,s.jsx)(i.strong,{children:"you"})," use it \u2014 tag us, open issues, or just say hi."]}),"\n",(0,s.jsx)(i.h2,{id:"-conclusion",children:"\ud83e\udded Conclusion"}),"\n",(0,s.jsx)(i.p,{children:"From handcrafted Dockerfiles to Earthly-powered pipelines and now to a clean, declarative build system \u2014 this journey has been about making Kairos better not just for us, but for you."}),"\n",(0,s.jsxs)(i.p,{children:["With ",(0,s.jsx)(i.code,{children:"kairos-init"}),", we\u2019ve laid the groundwork for a more open, composable, and hackable future."]}),"\n",(0,s.jsx)(i.p,{children:"Thanks for building with us. \ud83d\ude80"})]})}function h(e={}){const{wrapper:i}={...(0,t.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);