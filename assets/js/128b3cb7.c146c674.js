"use strict";(globalThis.webpackChunkkairos_docs=globalThis.webpackChunkkairos_docs||[]).push([[1735],{28453:(e,o,t)=>{t.d(o,{R:()=>r,x:()=>a});var i=t(96540);const n={},s=i.createContext(n);function r(e){const o=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function a(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),i.createElement(s.Provider,{value:o},e.children)}},85774:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"Installation/netboot","title":"Network booting","description":"Install Kairos from network","source":"@site/versioned_docs/version-3.6.0/Installation/netboot.md","sourceDirName":"Installation","slug":"/Installation/netboot","permalink":"/kairos-docs/docs/3.6.0/Installation/netboot","draft":false,"unlisted":false,"editUrl":"https://github.com/kairos-io/kairos-docs/tree/main/versioned_docs/version-3.6.0/Installation/netboot.md","tags":[],"version":"3.6.0","lastUpdatedBy":"Jasper De Keukelaere (imec)","lastUpdatedAt":1765142882000,"sidebarPosition":5,"frontMatter":{"title":"Network booting","sidebar_label":"Network booting","sidebar_position":5,"date":"2022-12-01T00:00:00.000Z","description":"Install Kairos from network"},"sidebar":"tutorialSidebar","previous":{"title":"RaspberryPi","permalink":"/kairos-docs/docs/3.6.0/Installation/raspberry"},"next":{"title":"P2P support","permalink":"/kairos-docs/docs/3.6.0/Installation/p2p"}}');var n=t(74848),s=t(28453);const r={title:"Network booting",sidebar_label:"Network booting",sidebar_position:5,date:new Date("2022-12-01T00:00:00.000Z"),description:"Install Kairos from network"},a=void 0,l={},c=[{value:"Boot with pre-built ISOs",id:"boot-with-pre-built-isos",level:2},{value:"Use AuroraBoot",id:"use-auroraboot",level:2},{value:"Notes on booting from network",id:"notes-on-booting-from-network",level:2}];function d(e){const o={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(o.p,{children:["Most hardware these days, supports booting an operating system from the network.\nThe technology behind this is called ",(0,n.jsx)(o.a,{href:"https://en.wikipedia.org/wiki/Preboot_Execution_Environment",children:"Preboot Execution Environment"}),".\nKairos releases include artifacts to allow booting from the network. In general, the following files are needed:"]}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"The initrd image: It's the system that loads first. It's responsible to load the kernel."}),"\n",(0,n.jsx)(o.li,{children:"The kernel: This is the kernel of the operating system that will boot."}),"\n",(0,n.jsx)(o.li,{children:"The squashfs: The filesystem of the operating system that will boot."}),"\n"]}),"\n",(0,n.jsx)(o.p,{children:"Booting using these files can happen in multiple ways:"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"Either with direct support from the machine BIOS plus network configuration (DHCP server etc)."}),"\n",(0,n.jsxs)(o.li,{children:["Software based network booting. This works with a special ISO, built with\n",(0,n.jsx)(o.a,{href:"https://ipxe.org/",children:"ipxe"})," project. Kairos releases include pre-built ISOs for\nnetbooting (named like ",(0,n.jsx)(o.code,{children:"*.ipxe.iso.ipxe"}),")."]}),"\n",(0,n.jsxs)(o.li,{children:["Use ",(0,n.jsx)(o.a,{href:"../../reference/auroraboot",children:"AuroraBoot"})]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:["Generic hardware based netbooting is out of scope for this document.\nBelow we give instructions on how to use the Kairos release artifacts to netboot and how to use ",(0,n.jsx)(o.a,{href:"../../reference/auroraboot",children:"AuroraBoot"})," to boot from network."]}),"\n",(0,n.jsx)(o.h2,{id:"boot-with-pre-built-isos",children:"Boot with pre-built ISOs"}),"\n",(0,n.jsxs)(o.p,{children:["The ipxe ISOs from the Kairos release artifacts, were built with a ipxe script that points directly to the\n",(0,n.jsx)(o.code,{children:"kernel"}),", ",(0,n.jsx)(o.code,{children:"initrd"})," and ",(0,n.jsx)(o.code,{children:"squashfs"})," artifacts of the same release on GitHub."]}),"\n",(0,n.jsx)(o.p,{children:"E.g.:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:'#!ipxe\nset url https://github.com/kairos-io/kairos/releases/download/latest\nset kernel \x3c!-- Hugo shortcode: image variant="standard" suffix="-kernel"  --\x3e\nset initrd \x3c!-- Hugo shortcode: image variant="standard" suffix="-initrd"  --\x3e\nset rootfs \x3c!-- Hugo shortcode: image variant="standard" suffix=".squashfs"  --\x3e\n\n# Configure interface\nifconf\n\n# set config https://example.com/machine-config\n# set cmdline extra.values=1\nkernel ${url}/${kernel} initrd=${initrd} rd.neednet=1 ip=dhcp rd.cos.disable root=live:${url}/${rootfs} netboot install-mode config_url=${config} console=tty1 console=ttyS0 ${cmdline}\ninitrd ${url}/${initrd}\nboot\n'})}),"\n",(0,n.jsx)(o.p,{children:"Booting the ISO will automatically download and boot those artifacts. E.g. using qemu:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:"#!/bin/bash\n\nqemu-img create -f qcow2 disk.img 40g\nqemu-system-x86_64 \\\n    -m 4096 \\\n    -smp cores=2 \\\n    -nographic \\\n    -drive if=virtio,media=disk,file=disk.img \\\n    -drive if=ide,media=cdrom,file=${1:-kairos.iso}\n\n"})}),"\n",(0,n.jsx)(o.h2,{id:"use-auroraboot",children:"Use AuroraBoot"}),"\n",(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.a,{href:"../../reference/auroraboot",children:"AuroraBoot"})," is a Kairos convinience tool that can be used to quickly deploy Kairos from Network with zero-touch configuration, for instance:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:'docker run --rm -ti --net host quay.io/kairos/auroraboot \\\n                    --set "container_image=quay.io/kairos/kairos-standard:latest"\n                    # Optionally:\n                    # --cloud-config ....\n'})}),"\n",(0,n.jsxs)(o.p,{children:["Will netboot the  image. You can find more details in the ",(0,n.jsx)(o.a,{href:"../../reference/auroraboot",children:"AuroraBoot documentation section"}),"."]}),"\n",(0,n.jsx)(o.h2,{id:"notes-on-booting-from-network",children:"Notes on booting from network"}),"\n",(0,n.jsxs)(o.p,{children:["Another way to boot with the release artifacts is using ",(0,n.jsx)(o.a,{href:"https://github.com/danderson/netboot/tree/master/pixiecore",children:"pixiecore"}),".\n",(0,n.jsx)(o.code,{children:"pixiecore"})," acts as a server which offers net boot files over the network and it's automatically discovered on a network where a DHCP server is running and is compatible with ",(0,n.jsx)(o.a,{href:"https://github.com/danderson/netboot/blob/master/pixiecore/README.booting",children:"the pixiecore architecture"}),"."]}),"\n",(0,n.jsxs)(o.p,{children:["Assuming the current directory has the ",(0,n.jsx)(o.code,{children:"kernel"}),", ",(0,n.jsx)(o.code,{children:"initrd"})," and ",(0,n.jsx)(o.code,{children:"squashfs"})," artifacts,\n",(0,n.jsx)(o.code,{children:"pixiecore"})," server can be started with ",(0,n.jsx)(o.code,{children:"docker"})," like this:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:'#!/bin/bash\n\nwget "https://github.com/kairos-io/kairos/releases/download/latest/\x3c!-- Hugo shortcode: image variant="standard" suffix="-kernel" --\x3e"\nwget "https://github.com/kairos-io/kairos/releases/download/latest/\x3c!-- Hugo shortcode: image variant="standard" suffix="-initrd"  --\x3e"\nwget "https://github.com/kairos-io/kairos/releases/download/latest/\x3c!-- Hugo shortcode: image variant="standard" suffix=".squashfs"  --\x3e"\n\ncat << EOF > config.yaml\n#cloud-config\n\nhostname: "hostname.domain.tld"\nusers:\n- name: "kairos"\n  passwd: "kairos"\nEOF\n\n# This will start the pixiecore server.\n# Any machine that depends on DHCP to netboot will be send the specified files and the cmd boot line.\ndocker run \\\n  -d --name pixiecore --net=host -v $PWD:/files quay.io/pixiecore/pixiecore \\\n    boot /files/\x3c!-- Hugo shortcode: image variant="standard" suffix="-kernel"  --\x3e /files/\x3c!-- Hugo shortcode: image variant="standard" suffix="-initrd"  --\x3e --cmdline="rd.neednet=1 ip=dhcp rd.cos.disable root=live:{{ ID \\"/files/\x3c!-- Hugo shortcode: image variant="standard" suffix=".squashfs"  --\x3e\\" }} netboot install-mode config_url={{ ID \\"/files/config.yaml\\" }} console=tty1 console=ttyS0 console=tty0"\n'})}),"\n",(0,n.jsxs)(o.p,{children:["If your machine doesn't support netbooting, you can use our ",(0,n.jsx)(o.a,{href:"https://github.com/kairos-io/ipxe-dhcp/releases",children:"generic image"}),", which is built using an ipxe script ",(0,n.jsx)(o.a,{href:"https://github.com/danderson/netboot/blob/master/pixiecore/boot.ipxe",children:"from the pixiecore project"}),". The ISO will wait for a DHCP proxy response from pixiecore."]}),"\n",(0,n.jsxs)(o.p,{children:["If pixiecore is successfully reached, you should see an output similar to this in the ",(0,n.jsx)(o.code,{children:"pixiecore"})," docker container:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{children:'$ docker logs pixiecore\n[DHCP] Offering to boot 08:00:27:e5:22:8c\n[DHCP] Offering to boot 08:00:27:e5:22:8c\n[HTTP] Sending ipxe boot script to 192.168.1.49:4371\n[HTTP] Sent file "kernel" to 192.168.1.49:4371\n[HTTP] Sent file "initrd-0" to 192.168.1.49:4371\n'})})]})}function h(e={}){const{wrapper:o}={...(0,s.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}}}]);