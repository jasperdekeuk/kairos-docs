"use strict";(globalThis.webpackChunkkairos_docs=globalThis.webpackChunkkairos_docs||[]).push([[495],{28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>r});var o=t(96540);const i={},a=o.createContext(i);function s(e){const n=o.useContext(a);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),o.createElement(a.Provider,{value:n},e.children)}},91659:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>c,frontMatter:()=>s,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"Examples/multi-node-p2p-ha","title":"Self-coordinating P2P Multi-Node Cluster with High Availability","description":"Kairos makes it easy to configure automatic High Availability (HA) in your cluster by using cloud-config. With just a few simple steps, you can have a fully-functioning HA setup in your cluster.","source":"@site/docs/Examples/multi-node-p2p-ha.md","sourceDirName":"Examples","slug":"/Examples/multi-node-p2p-ha","permalink":"/kairos-docs/docs/next/Examples/multi-node-p2p-ha","draft":false,"unlisted":false,"editUrl":"https://github.com/kairos-io/kairos-docs/tree/main/docs/Examples/multi-node-p2p-ha.md","tags":[],"version":"current","lastUpdatedBy":"Jasper De Keukelaere (imec)","lastUpdatedAt":1765043763000,"frontMatter":{"title":"Self-coordinating P2P Multi-Node Cluster with High Availability","sidebar_label":"Self-coordinating P2P multi-node cluster HA","description":"Kairos makes it easy to configure automatic High Availability (HA) in your cluster by using cloud-config. With just a few simple steps, you can have a fully-functioning HA setup in your cluster."},"sidebar":"tutorialSidebar","previous":{"title":"Self-coordinating P2P multi-node cluster HA with KubeVIP","permalink":"/kairos-docs/docs/next/Examples/multi-node-p2p-ha-kubevip"},"next":{"title":"Self-coordinating P2P multi-node cluster","permalink":"/kairos-docs/docs/next/Examples/multi-node-p2p"}}');var i=t(74848),a=t(28453);const s={title:"Self-coordinating P2P Multi-Node Cluster with High Availability",sidebar_label:"Self-coordinating P2P multi-node cluster HA",description:"Kairos makes it easy to configure automatic High Availability (HA) in your cluster by using cloud-config. With just a few simple steps, you can have a fully-functioning HA setup in your cluster."},r=void 0,l={},d=[];function u(e){const n={a:"a",admonition:"admonition",code:"code",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.admonition,{title:"Network",type:"warning",children:(0,i.jsx)(n.p,{children:"This feature is experimental and has only been tested on local setups. Run in production servers at your own risk.\nFeedback and bug reports are welcome, as we are improving the p2p aspects of Kairos."})}),"\n",(0,i.jsx)(n.admonition,{title:"Production Considerations",type:"info",children:(0,i.jsxs)(n.p,{children:["This example is for learning purposes. In production environments, it's recommended to use a load balancer in front of the highly available control plane nodes rather than exposing all control plane nodes directly. For a production-ready setup with a load balancer, see our ",(0,i.jsx)(n.a,{href:"../multi-node-p2p-ha-kubevip",children:"Self-coordinating P2P Multi-Node Cluster with High Availability and KubeVIP"})," example."]})}),"\n",(0,i.jsxs)(n.p,{children:["To enable automatic HA rollout, enable the ",(0,i.jsx)(n.code,{children:"p2p.auto.ha.enable"})," option in your cloud-config, and set up a number of ",(0,i.jsx)(n.code,{children:"master_nodes"}),". The number of ",(0,i.jsx)(n.code,{children:"master_nodes"})," is the number of additional masters in addition to the initial HA role. There will always be a minimum of 1 master, which is already taken into account. For example, setting up ",(0,i.jsx)(n.code,{children:"master_nodes"})," to two will result in a total of 3 master nodes in your cluster."]}),"\n",(0,i.jsxs)(n.p,{children:["To make this process even easier, Kairos automatically configures each node in the cluster from a unique cloud-config. This way, you don't have to manually configure each node, but provide instead a config file for all of the machines during ",(0,i.jsx)(n.a,{href:"../../installation/",children:"Installation"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Here is an example of what your cloud-config might look like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'#cloud-config\n\nhostname: kairoslab-{{ trunc 4 .MachineID }}\nusers:\n- name: kairos\n  ssh_authorized_keys:\n  # Replace with your github user and un-comment the line below:\n  # - github:mudler\n\np2p:\n # Disabling DHT makes co-ordination to discover nodes only in the local network\n disable_dht: true #Enabled by default\n\n # network_token is the shared secret used by the nodes to co-ordinate with p2p.\n # Setting a network token implies auto.enable = true.\n # To disable, just set auto.enable = false\n network_token: ""\n\n # Automatic cluster deployment configuration\n auto:\n   # Enables Automatic node configuration (self-coordination)\n   # for role assignment\n   enable: true\n   # HA enables automatic HA roles assignment.\n   # A master cluster init is always required,\n   # Any additional master_node is configured as part of the \n   # HA control plane.\n   # If auto is disabled, HA has no effect.\n   ha:\n     # Enables HA control-plane\n     enable: true\n     # Number of HA additional master nodes.\n     # A master node is always required for creating the cluster and is implied.\n     # The setting below adds 2 additional master nodes, for a total of 3.\n     master_nodes: 2\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Note: In order for the automatic HA rollout to work, you need to generate a network token. You can find more information on how to do this in the ",(0,i.jsx)(n.a,{href:"../../installation/p2p#network_token",children:"dedicated section"}),"."]})]})}function c(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}}}]);