"use strict";(globalThis.webpackChunkkairos_docs=globalThis.webpackChunkkairos_docs||[]).push([[3180],{11470:(e,n,t)=>{t.d(n,{A:()=>j});var a=t(96540),s=t(34164),r=t(17559),o=t(23104),i=t(56347),l=t(205),u=t(57485),c=t(31682),d=t(70679);function h(e){return a.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function p(e){const{values:n,children:t}=e;return(0,a.useMemo)(()=>{const e=n??function(e){return h(e).map(({props:{value:e,label:n,attributes:t,default:a}})=>({value:e,label:n,attributes:t,default:a}))}(t);return function(e){const n=(0,c.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}function m({value:e,tabValues:n}){return n.some(n=>n.value===e)}function b({queryString:e=!1,groupId:n}){const t=(0,i.W6)(),s=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,u.aZ)(s),(0,a.useCallback)(e=>{if(!s)return;const n=new URLSearchParams(t.location.search);n.set(s,e),t.replace({...t.location,search:n.toString()})},[s,t])]}function g(e){const{defaultValue:n,queryString:t=!1,groupId:s}=e,r=p(e),[o,i]=(0,a.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find(e=>e.default)??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:r})),[u,c]=b({queryString:t,groupId:s}),[h,g]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,s]=(0,d.Dv)(n);return[t,(0,a.useCallback)(e=>{n&&s.set(e)},[n,s])]}({groupId:s}),f=(()=>{const e=u??h;return m({value:e,tabValues:r})?e:null})();(0,l.A)(()=>{f&&i(f)},[f]);return{selectedValue:o,selectValue:(0,a.useCallback)(e=>{if(!m({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);i(e),c(e),g(e)},[c,g,r]),tabValues:r}}var f=t(92303);const k={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=t(74848);function w({className:e,block:n,selectedValue:t,selectValue:a,tabValues:r}){const i=[],{blockElementScrollPositionUntilNextRender:l}=(0,o.a_)(),u=e=>{const n=e.currentTarget,s=i.indexOf(n),o=r[s].value;o!==t&&(l(n),a(o))},c=e=>{let n=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const t=i.indexOf(e.currentTarget)+1;n=i[t]??i[0];break}case"ArrowLeft":{const t=i.indexOf(e.currentTarget)-1;n=i[t]??i[i.length-1];break}}n?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},e),children:r.map(({value:e,label:n,attributes:a})=>(0,x.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{i.push(e)},onKeyDown:c,onClick:u,...a,className:(0,s.A)("tabs__item",k.tabItem,a?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function v({lazy:e,children:n,selectedValue:t}){const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=r.find(e=>e.props.value===t);return e?(0,a.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:r.map((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function y(e){const n=g(e);return(0,x.jsxs)("div",{className:(0,s.A)(r.G.tabs.container,"tabs-container",k.tabList),children:[(0,x.jsx)(w,{...n,...e}),(0,x.jsx)(v,{...n,...e})]})}function j(e){const n=(0,f.A)();return(0,x.jsx)(y,{...e,children:h(e.children)},String(n))}},19365:(e,n,t)=>{t.d(n,{A:()=>o});t(96540);var a=t(34164);const s={tabItem:"tabItem_Ymn6"};var r=t(74848);function o({children:e,hidden:n,className:t}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,a.A)(s.tabItem,t),hidden:n,children:e})}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>i});var a=t(96540);const s={},r=a.createContext(s);function o(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),a.createElement(r.Provider,{value:n},e.children)}},94537:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>u,default:()=>p,frontMatter:()=>l,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"Examples/multi-node","title":"Manual Multi-Node Cluster","description":"This section describe examples on how to deploy Kairos as a multi-node cluster","source":"@site/versioned_docs/version-3.5.7/Examples/multi-node.md","sourceDirName":"Examples","slug":"/Examples/multi-node","permalink":"/docs/3.5.7/Examples/multi-node","draft":false,"unlisted":false,"editUrl":"https://github.com/kairos-io/kairos-docs/tree/main/versioned_docs/version-3.5.7/Examples/multi-node.md","tags":[],"version":"3.5.7","lastUpdatedBy":"Jasper De Keukelaere (imec)","lastUpdatedAt":1765142882000,"frontMatter":{"title":"Manual Multi-Node Cluster","sidebar_label":"Manual multi-node cluster","description":"This section describe examples on how to deploy Kairos as a multi-node cluster"},"sidebar":"tutorialSidebar","previous":{"title":"Self-coordinating P2P multi-node cluster","permalink":"/docs/3.5.7/Examples/multi-node-p2p"},"next":{"title":"Intel Open AMT Registration","permalink":"/docs/3.5.7/Examples/openamt"}}');var s=t(74848),r=t(28453),o=t(11470),i=t(19365);const l={title:"Manual Multi-Node Cluster",sidebar_label:"Manual multi-node cluster",description:"This section describe examples on how to deploy Kairos as a multi-node cluster"},u=void 0,c={},d=[{value:"Installation",id:"installation",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Master node",id:"master-node",level:3},{value:"Worker nodes",id:"worker-nodes",level:3}];function h(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"In the example below we will use a bare metal host to provision a Kairos cluster in the local network using one master node and one worker node."}),"\n",(0,s.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,s.jsxs)(n.p,{children:["For this example we will use a standard image which contains a Kubernetes distribution. You can choose between ",(0,s.jsx)(n.code,{children:"k0s"})," and ",(0,s.jsx)(n.code,{children:"k3s"})," as the distribution to use. Follow the ",(0,s.jsx)(n.a,{href:"../../installation",children:"Installation"})," documentation with the configurations provided on this page. Make sure to choose the one that matches the image you are using."]}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["On all nodes, we will deploy a ",(0,s.jsx)(n.code,{children:"kairos"})," user with the password ",(0,s.jsx)(n.code,{children:"kairos"})," and the ",(0,s.jsx)(n.code,{children:"admin"})," group. We will also add the public keys of the users that will be allowed to access the nodes."]}),"\n",(0,s.jsx)(n.h3,{id:"master-node",children:"Master node"}),"\n",(0,s.jsx)(n.p,{children:"On the master node configuration, we will enable the Kubernetes distribution and configure it. We will also include a manifest with a simple Nginx deployment that will be installed on the cluster once it's running. You can change the manifest to the one of your own application or remove it if you don't need it."}),"\n","\n",(0,s.jsxs)(o.A,{children:[(0,s.jsx)(i.A,{value:"k3s",label:"k3s",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'#cloud-config\n\nhostname: metal-{{ trunc 4 .MachineID }}\nusers:\n- name: kairos # Change to your own user\n  passwd: kairos # Change to your own password\n  groups:\n    - admin # This user needs to be part of the admin group\n  ssh_authorized_keys:\n    - github:<YOUR_GITHUB_USER> # replace with your github user\n\nk3s:\n  enabled: true\n  args:\n    - --disable=traefik,servicelb # will disable traefik and servicelb\n\nwrite_files:\n- path: /var/lib/rancher/k3s/server/manifests/nginx.yaml\n  permissions: "0644"\n  content: |\n    apiVersion: v1\n    kind: Namespace\n    metadata:\n      name: nginx\n    ---\n    apiVersion: apps/v1\n    kind: Deployment\n    metadata:\n      name: nginx-deployment\n      namespace: nginx\n    spec:\n      selector:\n        matchLabels:\n          app: nginx\n      replicas: 3\n      template:\n        metadata:\n          labels:\n            app: nginx\n        spec:\n          containers:\n          - name: nginx\n            image: nginx:latest\n            ports:\n            - containerPort: 80\n'})})}),(0,s.jsx)(i.A,{value:"k0s",label:"k0s",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'#cloud-config\n\nhostname: metal-{{ trunc 4 .MachineID }}\nusers:\n- name: kairos # Change to your own user\n  passwd: kairos # Change to your own password\n  groups:\n    - admin # This user needs to be part of the admin group\n  ssh_authorized_keys:\n    - github:<YOUR_GITHUB_USER> # replace with your github user\n\nk0s:\n  enabled: true\n\nwrite_files:\n- path: /var/lib/k0s/manifests/nginx/nginx.yaml\n  permissions: "0644"\n  content: |\n    apiVersion: v1\n    kind: Namespace\n    metadata:\n      name: nginx\n    ---\n    apiVersion: apps/v1\n    kind: Deployment\n    metadata:\n      name: nginx-deployment\n      namespace: nginx\n    spec:\n      selector:\n        matchLabels:\n          app: nginx\n      replicas: 3\n      template:\n        metadata:\n          labels:\n            app: nginx\n        spec:\n          containers:\n          - name: nginx\n            image: nginx:latest\n            ports:\n            - containerPort: 80\n'})})})]}),"\n",(0,s.jsx)(n.h3,{id:"worker-nodes",children:"Worker nodes"}),"\n",(0,s.jsx)(n.p,{children:"With the master node up and running, we can configure the worker nodes"}),"\n",(0,s.jsxs)(o.A,{children:[(0,s.jsx)(i.A,{value:"k3s",label:"k3s",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'#cloud-config\n\nhostname: metal-{{ trunc 4 .MachineID }}\nusers:\n- name: kairos # Change to your own user\n  passwd: kairos # Change to your own password\n  groups:\n    - admin # This user needs to be part of the admin group\n  ssh_authorized_keys:\n    - github:<YOUR_GITHUB_USER> # replace with your github user\n\nk3s-agent: # Warning: the key is different from the master node one\n  enabled: true\n  args:\n    - --with-node-id # will configure the agent to use the node ID to communicate with the master node\n  env:\n    K3S_TOKEN: "<MASTER_SERVER_TOKEN>" # /var/lib/rancher/k3s/server/node-token from the master node\n    K3S_URL: https://<MASTER_SERVER_IP>:6443 # Same IP that you use to log into your master node\n'})})}),(0,s.jsx)(i.A,{value:"k0s",label:"k0s",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"#cloud-config\n\nhostname: metal-{{ trunc 4 .MachineID }}\nusers:\n- name: kairos # Change to your own user\n  passwd: kairos # Change to your own password\n  groups:\n    - admin # This user needs to be part of the admin group\n  ssh_authorized_keys:\n    - github:<YOUR_GITHUB_USER> # replace with your github user\n\nk0s-worker:\n  enabled: true\n  args:\n    - --token-file /etc/k0s/token\n\nwrite_files:\n  - path: /etc/k0s/token\n    permissions: 0644\n    content: |\n      <TOKEN> # generate it on your master node by running `k0s token create --role=worker`\n"})})})]}),"\n",(0,s.jsxs)(o.A,{children:[(0,s.jsx)(i.A,{value:"k3s",label:"k3s",children:(0,s.jsxs)(n.p,{children:["To find out more about args configuration from k3s, follow their ",(0,s.jsx)(n.a,{href:"https://docs.k3s.io/cli/server",children:"server"})," and ",(0,s.jsx)(n.a,{href:"https://docs.k3s.io/cli/agent",children:"agent"})," documentation."]})}),(0,s.jsx)(i.A,{value:"k0s",label:"k0s",children:(0,s.jsxs)(n.p,{children:["To learn more about a multi-node setup with k0s, follow their ",(0,s.jsx)(n.a,{href:"https://docs.k0sproject.io/stable/k0s-multi-node/",children:"multi-node"})," documentation."]})})]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);