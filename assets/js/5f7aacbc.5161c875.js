"use strict";(globalThis.webpackChunkkairos_docs=globalThis.webpackChunkkairos_docs||[]).push([[5383],{28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var o=t(96540);const i={},s=o.createContext(i);function r(e){const n=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(s.Provider,{value:n},e.children)}},74051:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"Examples/single-node-p2p","title":"Self-configured P2P Single-Node Cluster","description":"This documentation page provides instructions on how to install Kairos with P2P support on a single-node cluster","source":"@site/versioned_docs/version-3.5.7/Examples/single-node-p2p.md","sourceDirName":"Examples","slug":"/Examples/single-node-p2p","permalink":"/kairos-docs/docs/3.5.7/Examples/single-node-p2p","draft":false,"unlisted":false,"editUrl":"https://github.com/kairos-io/kairos-docs/tree/main/versioned_docs/version-3.5.7/Examples/single-node-p2p.md","tags":[],"version":"3.5.7","lastUpdatedBy":"Jasper De Keukelaere (imec)","lastUpdatedAt":1765142882000,"frontMatter":{"title":"Self-configured P2P Single-Node Cluster","sidebar_label":"Self-configured P2P single-node cluster","description":"This documentation page provides instructions on how to install Kairos with P2P support on a single-node cluster"},"sidebar":"tutorialSidebar","previous":{"title":"P2P multi-node cluster netboot","permalink":"/kairos-docs/docs/3.5.7/Examples/p2p_e2e"},"next":{"title":"Manual single-node cluster","permalink":"/kairos-docs/docs/3.5.7/Examples/single-node"}}');var i=t(74848),s=t(28453);const r={title:"Self-configured P2P Single-Node Cluster",sidebar_label:"Self-configured P2P single-node cluster",description:"This documentation page provides instructions on how to install Kairos with P2P support on a single-node cluster"},a=void 0,l={},d=[];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.admonition,{title:"Network",type:"warning",children:(0,i.jsx)(n.p,{children:"This feature is experimental and has only been tested on local setups. Run in production servers at your own risk.\nFeedback and bug reports are welcome, as we are improving the p2p aspects of Kairos."})}),"\n",(0,i.jsx)(n.admonition,{title:"Join an EdgeVPN network",type:"warning",children:(0,i.jsx)(n.p,{children:"Make sure that you join an existing EdgeVPN network with other machines (not necessarily Kubernetes nodes) otherwise the single-node cluster will never get an EdgeVPN IP and therefore won't be configurable."})}),"\n",(0,i.jsxs)(n.p,{children:["Installing Kairos with P2P support on a single-node cluster requires a few specific steps. To begin, it's important to note that in a single-node scenario, the role must be enforced to a specific role. In a non-HA (high availability) setup, that role can be either ",(0,i.jsx)(n.code,{children:"master"})," or ",(0,i.jsx)(n.code,{children:"worker"}),". In a single-node cluster, there will be only one master node that needs to be configured explicitly."]}),"\n",(0,i.jsx)(n.p,{children:"To set up a single-node cluster over P2P, consider the following example, which uses cloud-config to automatically configure the cluster:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'#cloud-config\n\nhostname: kairoslab-{{ trunc 4 .MachineID }}\nusers:\n- name: kairos\n  passwd: kairos\n  groups:\n    - admin\n  ssh_authorized_keys:\n  # Add your github user here!\n  - github:mudler\n\np2p:\n role: "master"\n # Disabling DHT makes co-ordination to discover nodes only in the local network\n disable_dht: true #Enabled by default\n\n # network_token is the shared secret used by the nodes to co-ordinate with p2p.\n # Setting a network token implies auto.enable = true.\n # To disable, just set auto.enable = false\n network_token: ""\n\n'})}),"\n",(0,i.jsx)(n.admonition,{title:"Warning",type:"warning",children:(0,i.jsx)(n.p,{children:"One important note is that this example requires the YAML format when editing the configuration file, and that the indentation needs to be accurate, otherwise the configuration will fail."})}),"\n",(0,i.jsxs)(n.p,{children:["The above cloud-config configures the hostname, creates a new user ",(0,i.jsx)(n.code,{children:"kairos"}),", and sets the ",(0,i.jsx)(n.code,{children:"role"})," to ",(0,i.jsx)(n.code,{children:"master"}),". Additionally, it disables DHT (distributed hash table) to make the VPN functional only within the local network and use ",(0,i.jsx)(n.em,{children:"mDNS"})," for discovery. If you wish to make the VPN work across different networks, you can set ",(0,i.jsx)(n.code,{children:"disable_dht"})," to ",(0,i.jsx)(n.code,{children:"false"})," or unset it."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"network_token"})," field is a shared secret used by the nodes to coordinate with P2P. Setting a network token implies ",(0,i.jsx)(n.code,{children:"auto.enable"}),". If you wish to disable it, simply set ",(0,i.jsx)(n.code,{children:"auto.enable"})," to false. To generate a network token, see ",(0,i.jsx)(n.a,{href:"../../installation/p2p#network_token",children:"documentation"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Keep in mind that, this example is a minimal configuration, and you can add more options depending on your needs. The above configuration can be used as a starting point and can be customized further."})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);