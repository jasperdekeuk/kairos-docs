"use strict";(globalThis.webpackChunkkairos_docs=globalThis.webpackChunkkairos_docs||[]).push([[5994],{28453:(e,o,t)=>{t.d(o,{R:()=>a,x:()=>l});var s=t(96540);const i={},n=s.createContext(i);function a(e){const o=s.useContext(n);return s.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function l(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(n.Provider,{value:o},e.children)}},72671:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>r,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"Installation/cloud-servers/gce","title":"Installation on Google Cloud","description":"Install Kairos on Google Cloud","source":"@site/docs/Installation/cloud-servers/gce.md","sourceDirName":"Installation/cloud-servers","slug":"/Installation/cloud-servers/gce","permalink":"/kairos-docs/docs/next/Installation/cloud-servers/gce","draft":false,"unlisted":false,"editUrl":"https://github.com/kairos-io/kairos-docs/tree/main/docs/Installation/cloud-servers/gce.md","tags":[],"version":"current","lastUpdatedBy":"Jasper De Keukelaere (imec)","lastUpdatedAt":1765142882000,"sidebarPosition":3,"frontMatter":{"title":"Installation on Google Cloud","sidebar_label":"Installation on Google Cloud","sidebar_position":3,"date":"2025-02-28T00:00:00.000Z","description":"Install Kairos on Google Cloud"},"sidebar":"tutorialSidebar","previous":{"title":"Installation on Azure","permalink":"/kairos-docs/docs/next/Installation/cloud-servers/azure"},"next":{"title":"Edge devices","permalink":"/kairos-docs/docs/next/category/edge-devices"}}');var i=t(74848),n=t(28453);const a={title:"Installation on Google Cloud",sidebar_label:"Installation on Google Cloud",sidebar_position:3,date:new Date("2025-02-28T00:00:00.000Z"),description:"Install Kairos on Google Cloud"},l=void 0,r={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Deploy a VM",id:"deploy-a-vm",level:2},{value:"Verify the Image",id:"verify-the-image",level:2}];function d(e){const o={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,n.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(o.p,{children:["This page describes how to install Kairos on Google Cloud after you have created a disk image. Since release v3.3.1, Kairos pipeline is pushing a public OS image to Google Cloud which you can use.\nIf you want to build a custom image, you can follow the instructions in the ",(0,i.jsx)(o.a,{href:"./creating_custom_cloud_images",children:"Creating Custom Cloud Images"})," page."]}),"\n",(0,i.jsx)(o.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"A Google Cloud account with permissions to create VMs."}),"\n",(0,i.jsxs)(o.li,{children:["A Google Cloud compatible image of Kairos. You can use the public image provided by Kairos (see below) or ",(0,i.jsx)(o.a,{href:"./auroraboot",children:"build your own image"})," and upload it to your google project (",(0,i.jsx)(o.a,{href:"https://github.com/kairos-io/kairos/blob/48d5c2bc8fc5555263f799db8a3388d7d46cd559/.github/workflows/upload-cloud-images.yaml#L36-L89",children:"check how the Kairos CI does it"}),")."]}),"\n"]}),"\n",(0,i.jsx)(o.h2,{id:"deploy-a-vm",children:"Deploy a VM"}),"\n",(0,i.jsxs)(o.p,{children:["Unfortunately Google Cloud ",(0,i.jsx)(o.a,{href:"https://cloud.google.com/compute/docs/images/managing-access-custom-images#share-images-publicly",children:"doesn't allow users to search among public images in different projects"}),". One has to know the exact project and name of the image they intend to use, even if its publicly accessible to ",(0,i.jsx)(o.a,{href:"https://cloud.google.com/compute/docs/images/managing-access-custom-images#limitations",children:"all authenticated users"}),". Using the public image seems to only be possible through the command line because of the above."]}),"\n",(0,i.jsxs)(o.ol,{children:["\n",(0,i.jsxs)(o.li,{children:["Make sure you are authenticated with the cli: ",(0,i.jsx)(o.code,{children:"gcloud auth login"})]}),"\n",(0,i.jsx)(o.li,{children:"Create a VM using the latest Kairos image:"}),"\n"]}),"\n",(0,i.jsx)(o.admonition,{title:"Note",type:"warning",children:(0,i.jsx)(o.p,{children:"As described below, it is possible to reset to any desired image on first boot. That's the reason only one Kairos flavor is published in Google Cloud (Ubuntu 24.04). This allows us to save costs and time by not pushing unnecessary artifacts."})}),"\n",(0,i.jsx)(o.h2,{id:"verify-the-image",children:"Verify the Image"}),"\n",(0,i.jsxs)(o.p,{children:["To ensure you're using a genuine Kairos image in Google Cloud, make sure the image you are going to use is in the Kairos team's Google Cloud project (",(0,i.jsx)(o.code,{children:"palette-kairos"}),")."]}),"\n",(0,i.jsx)(o.p,{children:"You can verify the image using the Google Cloud CLI:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",children:'gcloud compute images describe <IMAGE_NAME> --project palette-kairos --format="table(name,description,status)"\n'})}),"\n",(0,i.jsxs)(o.p,{children:["Replace ",(0,i.jsx)(o.code,{children:"<IMAGE_NAME>"})," with the name of the image. The output will show you the name, description, and status of the image. If the image doesn't belong to the Kairos project, no image will be found."]}),"\n",(0,i.jsx)(o.admonition,{title:"Note",type:"warning",children:(0,i.jsx)(o.p,{children:"As described below, it is possible to reset to any desired image on first boot. That's the reason only one Kairos flavor is published in Google Cloud (Ubuntu 24.04). This allows us to save costs and time by not pushing unnecessary artifacts."})}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-bash",metastring:'title="Ubuntu+24.04"',children:"gcloud --project  <your_project_here> compute instances create kairos-vm-test \\\n  --image=projects/palette-kairos/global/images/kairos-ubuntu-24-04-core-amd64-generic-\x3c!-- Hugo shortcode: googleVersion  --\x3e \\\n  --image-project=palette-kairos \\\n  --zone=europe-central2-c \\\n  --metadata-from-file=user-data=<path_to_your_cloud_config> \\\n  --boot-disk-size=40G\n"})}),"\n",(0,i.jsx)(o.p,{children:"Connect to the instance:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{children:"gcloud compute connect-to-serial-port kairos-vm-test\n"})}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsxs)(o.a,{href:"https://cloud.google.com/compute/docs/troubleshooting/troubleshooting-using-serial-console#disconnecting_from_the_serial_console",children:["(disconnect with ",(0,i.jsx)(o.code,{children:"<Enter>~."}),")"]})}),"\n",(0,i.jsxs)(o.p,{children:["By passing a file to ",(0,i.jsx)(o.code,{children:"--metadata-from-file=user-data=<your_file_here>"})," you can pass a cloud config to Kairos. You should at least specify a user and a password (or SSH key) if you need to SSH to the instance (Check the ",(0,i.jsx)(o.a,{href:"/getting-started/",children:"Getting started"})," page for some examples)."]}),"\n",(0,i.jsx)(o.p,{children:'When the instance boots for the first time, it boots into "auto-reset mode" by default. This means, that Kairos will "install" itself on the first boot and then reboot.\nYou can specify a different image to be installed using a block like the following in the cloud config:'}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-yaml",children:'reset:\n  source: "oci:quay.io/kairos/opensuse:leap-15.6-standard-amd64-generic-latest-latest"\n'})}),"\n",(0,i.jsx)(o.p,{children:'This will reset to the specified image on the first boot instead of the image booted. Once the instance is running, you can access it via SSH. Make sure reset has completed and the system has rebooted into "active" mode. The following command should report "active_boot":'}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{children:"kairos-agent state get boot\n"})}),"\n",(0,i.jsxs)(o.p,{children:["(It it reports ",(0,i.jsx)(o.code,{children:"recovery_boot"}),", the system is still in the installation process. Wait a few minutes and try again.)"]})]})}function u(e={}){const{wrapper:o}={...(0,n.R)(),...e.components};return o?(0,i.jsx)(o,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);