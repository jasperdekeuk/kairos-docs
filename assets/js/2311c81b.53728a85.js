"use strict";(globalThis.webpackChunkkairos_docs=globalThis.webpackChunkkairos_docs||[]).push([[1468],{11470:(e,t,s)=>{s.d(t,{A:()=>w});var n=s(96540),o=s(34164),i=s(17559),r=s(23104),a=s(56347),l=s(205),c=s(57485),u=s(31682),d=s(70679);function h(e){return n.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function g(e){const{values:t,children:s}=e;return(0,n.useMemo)(()=>{const e=t??function(e){return h(e).map(({props:{value:e,label:t,attributes:s,default:n}})=>({value:e,label:t,attributes:s,default:n}))}(s);return function(e){const t=(0,u.XI)(e,(e,t)=>e.value===t.value);if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[t,s])}function m({value:e,tabValues:t}){return t.some(t=>t.value===e)}function b({queryString:e=!1,groupId:t}){const s=(0,a.W6)(),o=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,c.aZ)(o),(0,n.useCallback)(e=>{if(!o)return;const t=new URLSearchParams(s.location.search);t.set(o,e),s.replace({...s.location,search:t.toString()})},[o,s])]}function p(e){const{defaultValue:t,queryString:s=!1,groupId:o}=e,i=g(e),[r,a]=(0,n.useState)(()=>function({defaultValue:e,tabValues:t}){if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const s=t.find(e=>e.default)??t[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:t,tabValues:i})),[c,u]=b({queryString:s,groupId:o}),[h,p]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[s,o]=(0,d.Dv)(t);return[s,(0,n.useCallback)(e=>{t&&o.set(e)},[t,o])]}({groupId:o}),f=(()=>{const e=c??h;return m({value:e,tabValues:i})?e:null})();(0,l.A)(()=>{f&&a(f)},[f]);return{selectedValue:r,selectValue:(0,n.useCallback)(e=>{if(!m({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);a(e),u(e),p(e)},[u,p,i]),tabValues:i}}var f=s(92303);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=s(74848);function j({className:e,block:t,selectedValue:s,selectValue:n,tabValues:i}){const a=[],{blockElementScrollPositionUntilNextRender:l}=(0,r.a_)(),c=e=>{const t=e.currentTarget,o=a.indexOf(t),r=i[o].value;r!==s&&(l(t),n(r))},u=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const s=a.indexOf(e.currentTarget)+1;t=a[s]??a[0];break}case"ArrowLeft":{const s=a.indexOf(e.currentTarget)-1;t=a[s]??a[a.length-1];break}}t?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":t},e),children:i.map(({value:e,label:t,attributes:n})=>(0,x.jsx)("li",{role:"tab",tabIndex:s===e?0:-1,"aria-selected":s===e,ref:e=>{a.push(e)},onKeyDown:u,onClick:c,...n,className:(0,o.A)("tabs__item",v.tabItem,n?.className,{"tabs__item--active":s===e}),children:t??e},e))})}function y({lazy:e,children:t,selectedValue:s}){const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const e=i.find(e=>e.props.value===s);return e?(0,n.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:i.map((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==s}))})}function k(e){const t=p(e);return(0,x.jsxs)("div",{className:(0,o.A)(i.G.tabs.container,"tabs-container",v.tabList),children:[(0,x.jsx)(j,{...t,...e}),(0,x.jsx)(y,{...t,...e})]})}function w(e){const t=(0,f.A)();return(0,x.jsx)(k,{...e,children:h(e.children)},String(t))}},19365:(e,t,s)=>{s.d(t,{A:()=>r});s(96540);var n=s(34164);const o={tabItem:"tabItem_Ymn6"};var i=s(74848);function r({children:e,hidden:t,className:s}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,n.A)(o.tabItem,s),hidden:t,children:e})}},23671:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>u,contentTitle:()=>c,default:()=>g,frontMatter:()=>l,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"Reference/troubleshooting","title":"Troubleshooting","description":"Things can go wrong. This section tries to give guidelines in helping out identify potential issues.","source":"@site/docs/Reference/troubleshooting.md","sourceDirName":"Reference","slug":"/Reference/troubleshooting","permalink":"/docs/next/Reference/troubleshooting","draft":false,"unlisted":false,"editUrl":"https://github.com/kairos-io/kairos-docs/tree/main/docs/Reference/troubleshooting.md","tags":[],"version":"current","lastUpdatedBy":"Jasper De Keukelaere (imec)","lastUpdatedAt":1765043763000,"sidebarPosition":6,"frontMatter":{"title":"Troubleshooting","sidebar_label":"Troubleshooting","sidebar_position":6,"date":"2022-11-13T00:00:00.000Z"},"sidebar":"tutorialSidebar","previous":{"title":"Image support matrix","permalink":"/docs/next/Reference/image_matrix"},"next":{"title":"Recovery mode","permalink":"/docs/next/Reference/recovery_mode"}}');var o=s(74848),i=s(28453),r=s(11470),a=s(19365);const l={title:"Troubleshooting",sidebar_label:"Troubleshooting",sidebar_position:6,date:new Date("2022-11-13T00:00:00.000Z")},c=void 0,u={},d=[{value:"Gathering logs",id:"gathering-logs",level:2},{value:"Initramfs breakpoints",id:"initramfs-breakpoints",level:2},{value:"Disable immutability",id:"disable-immutability",level:2},{value:"See also",id:"see-also",level:2},{value:"Note",id:"note",level:3},{value:"Enable Immucore debug logs",id:"enable-immucore-debug-logs",level:2},{value:"Disabling SecureBoot",id:"disabling-secureboot",level:2},{value:"Root permission",id:"root-permission",level:2},{value:"Get back the kubeconfig",id:"get-back-the-kubeconfig",level:2},{value:"Reporting issues",id:"reporting-issues",level:2},{value:"Trusted boot",id:"trusted-boot",level:2},{value:"TPM Event Logs",id:"tpm-event-logs",level:3},{value:"Viewing TPM Event Logs",id:"viewing-tpm-event-logs",level:4},{value:"Key Management in Firmware",id:"key-management-in-firmware",level:4},{value:"Listing Enrolled Keys",id:"listing-enrolled-keys",level:4},{value:"Verifying EFI Signature",id:"verifying-efi-signature",level:5},{value:"Checking if Secure Boot is Enabled",id:"checking-if-secure-boot-is-enabled",level:5},{value:"Command to Check Secure Boot Status",id:"command-to-check-secure-boot-status",level:5}];function h(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"Things can go wrong. This section tries to give guidelines in helping out identify potential issues."}),"\n",(0,o.jsxs)(t.p,{children:["It is important first to check out if your issue was already submitted ",(0,o.jsx)(t.a,{href:"https://github.com/kairos-io/kairos/issues",children:"in the issue tracker"}),"."]}),"\n","\n",(0,o.jsxs)(r.A,{children:[(0,o.jsxs)(a.A,{value:"kairos",label:"Kairos",children:[(0,o.jsx)(t.h2,{id:"gathering-logs",children:"Gathering logs"}),(0,o.jsxs)(t.p,{children:["To gather useful logs and help developers spot right away issues, it's suggested to boot with ",(0,o.jsx)(t.code,{children:"console=tty0 rd.debug"})," enabled for example:"]}),(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{src:"https://user-images.githubusercontent.com/2420543/191934926-7d4ac908-9a4c-4ef4-9891-75820e6b8fe6.gif",alt:"debug"})}),(0,o.jsx)(t.p,{children:"To edit the boot commands, type 'e' in the boot menu. To boot with the changes press 'CTRL+X'."}),(0,o.jsx)(t.p,{children:"In case logs can't be acquired, taking screenshot or videos while opening up issues it's strongly recommended!"}),(0,o.jsxs)(t.p,{children:["Another option that can be enabled is immucore debug logs with ",(0,o.jsx)(t.code,{children:"rd.immucore.debug"})]}),(0,o.jsxs)(t.p,{children:["After booting, you can find the logs from immucore under ",(0,o.jsx)(t.code,{children:"/run/immucore/"})," (whether you enabled debug output or not).\nCheck the ",(0,o.jsx)(t.a,{href:"https://github.com/kairos-io/immucore/",children:"immucore README"})," for more configuration parameters."]}),(0,o.jsxs)(t.p,{children:["In order to gather the logs, you can use the ",(0,o.jsx)(t.code,{children:"kairos-agent logs"})," command:"]}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"localhost:~# kairos-agent logs\n2025-07-07T10:14:09Z INF Kairos Agent version=v0.0.1\n2025-07-07T10:14:09Z INF creating a runtime\n2025-07-07T10:14:09Z INF detecting boot state\n2025-07-07T10:14:09Z INF Boot Mode boot_mode=active_boot\n2025-07-07T10:14:09Z INF Boot in uki mode result=false\n2025-07-07T10:14:09Z INF Kairos Agent version=v0.0.1\n2025-07-07T10:14:09Z INF creating a runtime\n2025-07-07T10:14:09Z INF detecting boot state\n2025-07-07T10:14:09Z INF Boot Mode boot_mode=active_boot\n2025-07-07T10:14:09Z INF Boot in uki mode result=false\n2025-07-07T10:14:09Z INF [2814] systemd not available, skipping journal log collection\n2025-07-07T10:14:09Z INF [2814] Logs collected successfully to ./kairos-logs.tar.gz\n"})}),(0,o.jsxs)(t.p,{children:["This command will collect logs from various components of the system and package them into a tarball named ",(0,o.jsx)(t.code,{children:"kairos-logs.tar.gz"}),". You can then attach this file when reporting issues."]}),(0,o.jsx)(t.h2,{id:"initramfs-breakpoints",children:"Initramfs breakpoints"}),(0,o.jsx)(t.p,{children:"Initramfs can be instructed to drop a shell in various phases of the boot process. For instance:"}),(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"rd.break=pre-mount rd.shell"}),": Drops a shell before setting up mount points."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"rd.break=pre-pivot rd.shell"}),": Drops a shell before switch-root"]}),"\n"]}),(0,o.jsx)(t.h2,{id:"disable-immutability",children:"Disable immutability"}),(0,o.jsxs)(t.p,{children:["It is possible to disable immutability by adding ",(0,o.jsx)(t.code,{children:"rd.cos.debugrw"})," to the kernel boot commands."]}),(0,o.jsx)(t.h2,{id:"see-also",children:"See also"}),(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"https://fedoraproject.org/wiki/How_to_debug_Dracut_problems",children:"Dracut debug docs"})}),"\n"]})]}),(0,o.jsxs)(a.A,{value:"kairos-uki",label:"Kairos UKI",children:[(0,o.jsx)(t.h3,{id:"note",children:"Note"}),(0,o.jsx)(t.p,{children:"The workflow for building UKI images is not yet set in stone and might change in the future so currently we cannot advise how to proceed here to build the UKI images with debug options yet. This will be updated in the future."}),(0,o.jsx)(t.p,{children:"Currently on UKI mode we cannot easily change the cmdline to provide debug options easily as the cmdline is measured by the TPM and the system will not boot if the cmdline is changed."}),(0,o.jsx)(t.h2,{id:"enable-immucore-debug-logs",children:"Enable Immucore debug logs"}),(0,o.jsxs)(t.p,{children:["In case of boot issues, Immucore accepts the ",(0,o.jsx)(t.code,{children:"rd.immucore.debug"})," parameter in the cmdline to enable debug logs."]}),(0,o.jsxs)(t.p,{children:["After booting, you can find the logs from immucore under ",(0,o.jsx)(t.code,{children:"/run/immucore/"})," (whether you enabled debug output or not)."]}),(0,o.jsx)(t.h2,{id:"disabling-secureboot",children:"Disabling SecureBoot"}),(0,o.jsxs)(t.p,{children:["In case of issues with SecureBoot, it's possible to disable it from the UEFI settings and make Immucore boot without it by setting the ",(0,o.jsx)(t.code,{children:"rd.immucore.securebootdisabled"})," parameter in the cmdline. Note that this is not supported and its only provided for troubleshooting purposes as it defeats the purpose of the security features provided by SecureBoot."]})]})]}),"\n",(0,o.jsx)(t.h2,{id:"root-permission",children:"Root permission"}),"\n",(0,o.jsxs)(t.p,{children:["By default, there is no root user set. A default user (",(0,o.jsx)(t.code,{children:"kairos"}),") is created and can use ",(0,o.jsx)(t.code,{children:"sudo"})," without password authentication during LiveCD bootup."]}),"\n",(0,o.jsx)(t.h2,{id:"get-back-the-kubeconfig",children:"Get back the kubeconfig"}),"\n",(0,o.jsxs)(t.p,{children:["On all nodes, which are deployed with the P2P full-mesh feature of the cluster, it's possible to invoke ",(0,o.jsx)(t.code,{children:"kairos get-kubeconfig"})," to recover the kubeconfig file."]}),"\n",(0,o.jsx)(t.h2,{id:"reporting-issues",children:"Reporting issues"}),"\n",(0,o.jsxs)(t.p,{children:["If you are reporting a bug, please open an issue on the ",(0,o.jsx)(t.a,{href:"https://github.com/kairos-io/kairos",children:"Kairos GitHub repository"})]}),"\n",(0,o.jsx)(t.p,{children:"When reporting issues, please provide as much information as possible. This includes:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["The version of Kairos you are using (Attach the full ",(0,o.jsx)(t.code,{children:"/etc/os-release"})," file)"]}),"\n",(0,o.jsx)(t.li,{children:"The hardware you are running Kairos on (In case of suspecting hardware compatibility issues)"}),"\n",(0,o.jsx)(t.li,{children:"The steps to reproduce the issue"}),"\n",(0,o.jsx)(t.li,{children:"Any logs or screenshots you have"}),"\n",(0,o.jsx)(t.li,{children:"Any other relevant information"}),"\n",(0,o.jsx)(t.li,{children:"If you are using a custom configuration, please provide the configuration file"}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"Some small things you can do to provide us with the best information possible:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["When running kairos-agent commands, please add the ",(0,o.jsx)(t.code,{children:"--debug"})," flag and attach the output to the issue"]}),"\n",(0,o.jsxs)(t.li,{children:["You can also run ",(0,o.jsx)(t.code,{children:"kairos-agent state"})," and attach the output to the issue as that provides information about various components of the system"]}),"\n",(0,o.jsxs)(t.li,{children:["You can also run ",(0,o.jsx)(t.code,{children:"kairos-agent config"})," and attach the output to the issue as that provides the current cloud-config for the system (Be aware that any sensitive information should be redacted before attaching the output)"]}),"\n",(0,o.jsxs)(t.li,{children:["Immucore logs, available under ",(0,o.jsx)(t.code,{children:"/run/immucore/"})," can be useful to attach as well"]}),"\n",(0,o.jsxs)(t.li,{children:["Agent logs, available under ",(0,o.jsx)(t.code,{children:"/var/log/kairos/*.log"})," which are stored on each run of the agent"]}),"\n",(0,o.jsxs)(t.li,{children:["Journalctl logs for the following services (use ",(0,o.jsx)(t.code,{children:"journalctl -u <service>"})," to get the logs) can be useful:","\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"cos-setup-network"}),"\n",(0,o.jsx)(t.li,{children:"cos-setup-fs"}),"\n",(0,o.jsx)(t.li,{children:"cos-setup-boot"}),"\n",(0,o.jsx)(t.li,{children:"kairos"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"trusted-boot",children:"Trusted boot"}),"\n",(0,o.jsx)(t.h3,{id:"tpm-event-logs",children:"TPM Event Logs"}),"\n",(0,o.jsx)(t.p,{children:"The Trusted Platform Module (TPM) logs contain important security-related measurements that are taken during the boot process. These logs are instrumental in ensuring that the boot process is secure and has not been tampered with."}),"\n",(0,o.jsx)(t.h4,{id:"viewing-tpm-event-logs",children:"Viewing TPM Event Logs"}),"\n",(0,o.jsxs)(t.p,{children:["To view TPM event logs, you can use the ",(0,o.jsx)(t.code,{children:"tpm2_eventlog"})," command as follows:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"tpm2_eventlog /sys/kernel/security/tpm0/binary_bios_measurements\n"})}),"\n",(0,o.jsxs)(t.p,{children:["However, for a more detailed and structured view, especially when analyzing what contributes to a specific PCR (Platform Configuration Register) value like PCR 7, the ",(0,o.jsx)(t.code,{children:"systemd-pcrlock"})," tool provides enhanced visibility:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"/usr/lib/systemd/systemd-pcrlock\n"})}),"\n",(0,o.jsx)(t.p,{children:"This tool is particularly useful for understanding the sequence of events that influence each PCR value during the boot process."}),"\n",(0,o.jsx)(t.h4,{id:"key-management-in-firmware",children:"Key Management in Firmware"}),"\n",(0,o.jsx)(t.p,{children:"To ensure the integrity and security of your system, it is critical to manage and verify the keys used by the firmware, especially when dealing with upgrades and security patches."}),"\n",(0,o.jsx)(t.h4,{id:"listing-enrolled-keys",children:"Listing Enrolled Keys"}),"\n",(0,o.jsxs)(t.p,{children:["You can list keys that are currently enrolled in the firmware using ",(0,o.jsx)(t.code,{children:"sbctl"}),":"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"sbctl list-enrolled-keys\n"})}),"\n",(0,o.jsxs)(t.p,{children:["For further details and usage, refer to the ",(0,o.jsx)(t.code,{children:"sbctl"})," tool's GitHub repository:\n",(0,o.jsx)(t.a,{href:"https://github.com/Foxboron/sbctl",children:"https://github.com/Foxboron/sbctl"})]}),"\n",(0,o.jsx)(t.h5,{id:"verifying-efi-signature",children:"Verifying EFI Signature"}),"\n",(0,o.jsxs)(t.p,{children:["To verify if the EFI executables are signed with the correct keys, you can use tools like ",(0,o.jsx)(t.code,{children:"goverify"}),":"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"go get -u github.com/Foxboron/go-uefi/cmd/goverify\ngoverify\n"})}),"\n",(0,o.jsxs)(t.p,{children:["This step ensures that any upgrades or installations are performed using authorized and validated keys, thereby preserving the security of the system. More information and source code can be found on GitHub:\n",(0,o.jsx)(t.a,{href:"https://github.com/Foxboron/go-uefi/blob/master/cmd/goverify/main.go",children:"https://github.com/Foxboron/go-uefi/blob/master/cmd/goverify/main.go"})]}),"\n",(0,o.jsx)(t.h5,{id:"checking-if-secure-boot-is-enabled",children:"Checking if Secure Boot is Enabled"}),"\n",(0,o.jsx)(t.p,{children:"Secure Boot is a security standard that helps to ensure that a device boots using only software that is trusted by the Original Equipment Manufacturer (OEM). When Secure Boot is enabled, the firmware checks each piece of boot software for a valid digital signature."}),"\n",(0,o.jsx)(t.h5,{id:"command-to-check-secure-boot-status",children:"Command to Check Secure Boot Status"}),"\n",(0,o.jsx)(t.p,{children:"To check if Secure Boot is enabled on your system, use the following command:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"dmesg | grep -i secure\n"})}),"\n",(0,o.jsx)(t.p,{children:"The output will display entries related to Secure Boot, indicating whether it is enabled and showing details about the X.509 certificates loaded during the boot process, as seen in the example output provided in your notes."})]})}function g(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>r,x:()=>a});var n=s(96540);const o={},i=n.createContext(o);function r(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);