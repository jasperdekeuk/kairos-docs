"use strict";(globalThis.webpackChunkkairos_docs=globalThis.webpackChunkkairos_docs||[]).push([[4116],{28453:(e,n,o)=>{o.d(n,{R:()=>i,x:()=>s});var r=o(96540);const a={},t=r.createContext(a);function i(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(t.Provider,{value:n},e.children)}},49853:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"Upgrade/kairos-operator","title":"Installing Kairos Operator","description":"Install the Kairos operator for managing upgrades and operations","source":"@site/versioned_docs/version-3.5.7/Upgrade/kairos-operator.md","sourceDirName":"Upgrade","slug":"/Upgrade/kairos-operator","permalink":"/kairos-docs/docs/3.5.7/Upgrade/kairos-operator","draft":false,"unlisted":false,"editUrl":"https://github.com/kairos-io/kairos-docs/tree/main/versioned_docs/version-3.5.7/Upgrade/kairos-operator.md","tags":[],"version":"3.5.7","lastUpdatedBy":"Jasper De Keukelaere (imec)","lastUpdatedAt":1765142882000,"sidebarPosition":4,"frontMatter":{"title":"Installing Kairos Operator","sidebar_label":"Kairos Operator","sidebar_position":4,"date":"2025-07-25T00:00:00.000Z","description":"Install the Kairos operator for managing upgrades and operations"},"sidebar":"tutorialSidebar","previous":{"title":"From Kubernetes","permalink":"/kairos-docs/docs/3.5.7/Upgrade/kubernetes"},"next":{"title":"System Upgrade Controller (Deprecated)","permalink":"/kairos-docs/docs/3.5.7/Upgrade/system-upgrade-controller"}}');var a=o(74848),t=o(28453);const i={title:"Installing Kairos Operator",sidebar_label:"Kairos Operator",sidebar_position:4,date:new Date("2025-07-25T00:00:00.000Z"),description:"Install the Kairos operator for managing upgrades and operations"},s=void 0,l={},d=[{value:"Overview",id:"overview",level:2},{value:"Deploying the operator",id:"deploying-the-operator",level:2},{value:"Removing the operator",id:"removing-the-operator",level:3},{value:"Installing via Bundle",id:"installing-via-bundle",level:2},{value:"Removing the Bundle Installation",id:"removing-the-bundle-installation",level:3},{value:"Basic NodeOp example",id:"basic-nodeop-example",level:2},{value:"What&#39;s next?",id:"whats-next",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"The Kairos operator is the recommended way to manage upgrades and operations on Kairos nodes in a Kubernetes cluster. It provides a more integrated and Kairos-specific approach compared to the system-upgrade-controller which was used in the past."}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:"The Kairos operator provides two custom resources:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"NodeOp"}),": For generic operations on Kubernetes nodes (Kairos or not). It allows mounting the host's root filesystem to perform operations or run scripts."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"NodeOpUpgrade"}),": A Kairos-specific custom resource for upgrading Kairos nodes. It automatically creates a NodeOp with the appropriate upgrade script and configuration."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"deploying-the-operator",children:"Deploying the operator"}),"\n",(0,a.jsxs)(n.p,{children:["To deploy the operator, you can use kubectl (provided that the ",(0,a.jsx)(n.code,{children:"git"})," command is available):"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Using GitHub URL\nkubectl apply -k https://github.com/kairos-io/kairos-operator/config/default\n\n# Or using local directory (if you have the operator checked out)\nkubectl apply -k config/default\n"})}),"\n",(0,a.jsxs)(n.p,{children:["When the operator starts, it will automatically detect Kairos nodes and label them with ",(0,a.jsx)(n.code,{children:"kairos.io/managed: true"}),". This label can be used to target Kairos nodes specifically in hybrid clusters."]}),"\n",(0,a.jsx)(n.h3,{id:"removing-the-operator",children:"Removing the operator"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Using GitHub URL\nkubectl delete -k https://github.com/kairos-io/kairos-operator/config/default\n\n# Or using local directory\nkubectl delete -k config/default\n"})}),"\n",(0,a.jsx)(n.h2,{id:"installing-via-bundle",children:"Installing via Bundle"}),"\n",(0,a.jsx)(n.p,{children:"You can also install the Kairos Operator using a bundle by adding the following configuration to your cloud-config file:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"bundles:\n  - targets:\n      - run://quay.io/kairos/community-bundles:kairos-operator_latest\n"})}),"\n",(0,a.jsx)(n.p,{children:"This will automatically deploy the operator during the node initialization process."}),"\n",(0,a.jsx)(n.h3,{id:"removing-the-bundle-installation",children:"Removing the Bundle Installation"}),"\n",(0,a.jsxs)(n.p,{children:["To remove the operator installed via bundle, you need to delete the ",(0,a.jsx)(n.code,{children:"kairos-operator.yaml"})," file from the appropriate location:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"k0s"}),": ",(0,a.jsx)(n.code,{children:"/var/lib/k0s/manifests/kairos-operator/"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"k3s"}),": ",(0,a.jsx)(n.code,{children:"/var/lib/rancher/k3s/server/manifests/"})]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"basic-nodeop-example",children:"Basic NodeOp example"}),"\n",(0,a.jsx)(n.p,{children:"Here's a simple example of a NodeOp resource:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: operator.kairos.io/v1alpha1\nkind: NodeOp\nmetadata:\n  name: example-nodeop\n  namespace: default\nspec:\n  # NodeSelector to target specific nodes (optional)\n  nodeSelector:\n    matchLabels:\n      kairos.io/managed: "true"\n\n  # The container image to run on each node\n  image: busybox:latest\n\n  # The command to execute in the container\n  command:\n    - sh\n    - -c\n    - |\n      echo "Running on node $(hostname)"\n      ls -la /host/etc/kairos-release\n      cat /host/etc/kairos-release\n\n  # Path where the node\'s root filesystem will be mounted (defaults to /host)\n  hostMountPath: /host\n\n  # Whether to cordon the node before running the operation\n  cordon: true\n\n  # Drain options for pod eviction\n  drainOptions:\n    enabled: true\n    force: false\n    gracePeriodSeconds: 30\n    ignoreDaemonSets: true\n    deleteEmptyDirData: false\n    timeoutSeconds: 300\n\n  # Whether to reboot the node after successful operation\n  rebootOnSuccess: true\n\n  # Number of retries before marking the job failed\n  backoffLimit: 3\n\n  # Maximum number of nodes that can run the operation simultaneously\n  # 0 means run on all nodes at once\n  concurrency: 1\n\n  # Whether to stop creating new jobs when a job fails\n  # Useful for canary deployments\n  stopOnFailure: true\n'})}),"\n",(0,a.jsx)(n.h2,{id:"whats-next",children:"What's next?"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:".././kubernetes",children:"Upgrading Kairos with the operator"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:".././trustedboot",children:"Trusted Boot upgrades"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:".././manual",children:"Manual upgrades"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);