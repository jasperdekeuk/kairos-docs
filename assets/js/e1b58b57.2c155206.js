"use strict";(globalThis.webpackChunkkairos_docs=globalThis.webpackChunkkairos_docs||[]).push([[8932],{5037:e=>{e.exports=JSON.parse('{"permalink":"/blog/release-v2.4.2","editUrl":"https://github.com/kairos-io/kairos/tree/main/packages/create-kairos/templates/shared/blog/2023-11-14-release-v2.4.2.md","source":"@site/blog/2023-11-14-release-v2.4.2.md","title":"Kairos release v2.4.2","description":"A patch release that looks bigger than it is","date":"2023-11-14T00:00:00.000Z","tags":[{"inline":false,"label":"Kairos","permalink":"/blog/tags/kairos","description":"Posts about Kairos, an open-source, cloud-native, and immutable Linux distribution"}],"readingTime":4.78,"hasTruncateMarker":true,"authors":[{"name":"Dimitris Karakasilis","socials":{"github":"https://github.com/jimmykarily"},"url":"https://github.com/jimmykarily","imageURL":"https://github.com/jimmykarily.png","key":"dimitris-karakasilis","page":null}],"frontMatter":{"authors":["dimitris-karakasilis"],"description":"A patch release that looks bigger than it is","slug":"release-v2.4.2","tags":["kairos"],"title":"Kairos release v2.4.2"},"unlisted":false,"prevItem":{"title":"Kairos release v2.5","permalink":"/blog/release-v2.5"},"nextItem":{"title":"Hacktoberfest 2023","permalink":"/blog/hacktoberfest-2023"}}')},28453:(e,i,s)=>{s.d(i,{R:()=>r,x:()=>o});var a=s(96540);const t={},n=a.createContext(t);function r(e){const i=a.useContext(n);return a.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),a.createElement(n.Provider,{value:i},e.children)}},43271:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>a,toc:()=>h});var a=s(5037),t=s(74848),n=s(28453);const r={authors:["dimitris-karakasilis"],description:"A patch release that looks bigger than it is",slug:"release-v2.4.2",tags:["kairos"],title:"Kairos release v2.4.2"},o=void 0,l={authorsImageUrls:[void 0]},h=[{value:"New artifact names",id:"new-artifact-names",level:2},{value:"Less Earthly, more Dockerfiles",id:"less-earthly-more-dockerfiles",level:2},{value:"Alma linux removal from artifacts",id:"alma-linux-removal-from-artifacts",level:2},{value:"Transition to pure Alpine",id:"transition-to-pure-alpine",level:2},{value:"The Old System",id:"the-old-system",level:3},{value:"The New System",id:"the-new-system",level:3},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const i={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("h1",{align:"center",children:[(0,t.jsx)("br",{}),(0,t.jsx)("img",{width:"184",alt:"kairos-white-column 5bc2fe34",src:"https://user-images.githubusercontent.com/2420543/215073247-96988fd1-7fcf-4877-a28d-7c5802db43ab.png"}),(0,t.jsx)("br",{}),(0,t.jsx)("br",{})]}),"\n",(0,t.jsx)(i.p,{children:"Did you ever look at a release and couldn't decide if it should be a patch, a minor or a major version bump? It has happened to everybody (if not, let me know).\nThis Kairos release was a similar case. We didn't introduce any breaking changes and it was just bug fixes, which makes it a patch release.  At least that's the story for user facing changes. Because, behind the scenes, we made some heavy changes, in the way we produce the Kairos artifacts and how we name them."}),"\n",(0,t.jsxs)(i.p,{children:["The detailed list of changes can be found in the ",(0,t.jsx)(i.a,{href:"https://github.com/kairos-io/kairos/releases/tag/v2.4.2",children:"release notes"})," but the most important things to notice are listed below."]}),"\n",(0,t.jsx)(i.h2,{id:"new-artifact-names",children:"New artifact names"}),"\n",(0,t.jsx)(i.p,{children:'The artifacts (including container images) have consistent names which include all the information about the image. For example, the "standard" image (with k3s) for the Opensuse leap 15.5, targeting amd64 generic devices, in Kairos version 2.4.0, was called:'}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{children:"quay.io/kairos/kairos-opensuse-leap:v2.4.0-k3sv1.27.3-k3s1\n"})}),"\n",(0,t.jsx)(i.p,{children:"In version 2.4.2 it's called:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{children:"quay.io/kairos/opensuse:leap-15.5-standard-amd64-generic-v2.4.2-k3sv1.27.6-k3s1\n"})}),"\n",(0,t.jsx)(i.p,{children:"First of all the beginning of the image name reads naturally like the distro is usually named, including the version of the upstream distribution (15.5). Then, there is the information about:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"the variant (core or standard)"}),"\n",(0,t.jsx)(i.li,{children:"the architecture (amd64, arm64 etc)"}),"\n",(0,t.jsx)(i.li,{children:"the model (generic, rpi4 etc)"}),"\n",(0,t.jsx)(i.li,{children:"the Kairos version (v2.4.2) including the k3s version if it's a standard image"}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"And the same information is there in the bootable artifact name in the same order:"}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.a,{href:"https://github.com/kairos-io/kairos/releases/download/v2.4.2/kairos-opensuse-leap-15.5-standard-amd64-generic-v2.4.2-k3sv1.27.6+k3s1.iso",children:"kairos-opensuse-leap-15.5-standard-amd64-generic-v2.4.2-k3sv1.27.6+k3s1.iso"})}),"\n",(0,t.jsx)(i.h2,{id:"less-earthly-more-dockerfiles",children:"Less Earthly, more Dockerfiles"}),"\n",(0,t.jsxs)(i.p,{children:["Much of the logic from ",(0,t.jsx)(i.a,{href:"https://github.com/kairos-io/kairos/blob/a658a3fa5f294b14377631dedfa0031d3551f2b2/Earthfile#L317",children:"Earthly"})," has been moved to ",(0,t.jsx)(i.a,{href:"https://github.com/kairos-io/kairos/tree/master/imageshttps://github.com/kairos-io/kairos/tree/master/images",children:"the Dockerfiles"}),". And while this seems like an internal technical detail, it take us closer to a simpler build process, which everyone can replicate in their own CI to build custom Kairos images. The input to the dockerfiles is the information you see in the artifact names (see above) and comes directly from the ",(0,t.jsx)(i.a,{href:"https://github.com/kairos-io/kairos/blob/a658a3fa5f294b14377631dedfa0031d3551f2b2/.github/flavors.json#L1",children:"flavors.json file"}),". If all this sounds complicated, just keep this:"]}),"\n",(0,t.jsx)(i.p,{children:"In one of the next releases, is will be possible to build a full Kairos image (standard or core) using only one of the dockerfiles (no Earthly) and a block of information like:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{children:'"flavor": "opensuse",\n"flavorRelease": "leap-15.5",\n"variant": "standard",\n"model": "generic",\n"baseImage": "opensuse/leap:15.5",\n"arch": "amd64",\n'})}),"\n",(0,t.jsxs)(i.p,{children:["This allows one to change the base image above, to a derivative of ",(0,t.jsx)(i.code,{children:"opensuse/leap:15.5"})," (e.g. on with some additional packages installed). It also justifies the next item, please read on."]}),"\n",(0,t.jsx)(i.h2,{id:"alma-linux-removal-from-artifacts",children:"Alma linux removal from artifacts"}),"\n",(0,t.jsxs)(i.p,{children:["We identified that Rocky linux and Alma linux were completely similar in regards to building steps. Given the resource and time constraints we have, we decided to no longer build and release Alma linux artifacts.\nThe dockerfile for the ",(0,t.jsx)(i.a,{href:"https://github.com/kairos-io/kairos/blob/a658a3fa5f294b14377631dedfa0031d3551f2b2/img/Dockerfile.rhel#L1",children:"rhel family"})," supports the ",(0,t.jsx)(i.code,{children:"almalinux"})," flavor.\nBuilding an Alma linux Kairos image from the ",(0,t.jsx)(i.a,{href:"https://github.com/kairos-io/kairos/",children:"Kairos repository"})," root, is as simple as:"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{children:"earthly --platform=linux/amd64 +base-image \\\n    --VARIANT=core \\\n    --FLAVOR=almalinux \\\n    --FLAVOR_RELEASE=9.2 \\\n    --BASE_IMAGE=almalinux:9.2 \\\n    --MODEL=generic \\\n    --FAMILY=rhel\n"})}),"\n",(0,t.jsx)(i.h2,{id:"transition-to-pure-alpine",children:"Transition to pure Alpine"}),"\n",(0,t.jsx)(i.p,{children:"In our latest release of Kairos, we've made a significant shift in the architecture of our Alpine flavor. We've transitioned from using the initramfs and kernel from both openSUSE and Ubuntu to a full-fledged Alpine kernel and initramfs system. This change marks a significant milestone in our journey to provide a more robust and efficient system for our users."}),"\n",(0,t.jsx)(i.h3,{id:"the-old-system",children:"The Old System"}),"\n",(0,t.jsx)(i.p,{children:"Previously, our Alpine flavor of Kairos was built on two different systems. One used the initramfs and kernel from openSUSE, and the other used the initramfs and kernel from Ubuntu. Both systems used the Alpine root file system. While these setups served us well, they had their limitations. The most notable one was the use of systemd during the initramfs and openrc during system boot. This dual system added complexity and potential points of failure to our boot process."}),"\n",(0,t.jsx)(i.h3,{id:"the-new-system",children:"The New System"}),"\n",(0,t.jsx)(i.p,{children:"In our new release, we've written our own implementation of the initramfs script for our Alpine flavor. This script sets up the system, creating a more streamlined and efficient boot process."}),"\n",(0,t.jsx)(i.p,{children:"The switch to the Alpine kernel and initramfs system brings several benefits:"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Simplicity"}),": Alpine Linux is designed to be simple, which makes it easier to maintain and less prone to errors."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Security"}),": Alpine Linux uses musl libc and busybox to provide a small binary size with significant security benefits."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Efficiency"}),": The Alpine kernel and initramfs system are lightweight, which means Kairos now requires fewer resources to run."]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,t.jsx)(i.p,{children:"The transition to a full Alpine kernel and initramfs system is a significant step forward for our Alpine flavor of Kairos. It simplifies our architecture, improves security, and increases efficiency.\nThe changes in the build process make Kairos more friendly to customizations. The naming changes, make it easier to navigate among the numerous artifacts we generate with every release. Finally the various bug fixes and smaller improvements should make it a more stable release for everyone."}),"\n",(0,t.jsx)(i.p,{children:"We're excited about these changes and look forward to seeing how they benefit our users."}),"\n",(0,t.jsx)(i.p,{children:"Reach out to us with your comments!"})]})}function c(e={}){const{wrapper:i}={...(0,n.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);