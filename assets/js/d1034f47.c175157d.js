"use strict";(globalThis.webpackChunkkairos_docs=globalThis.webpackChunkkairos_docs||[]).push([[7251],{28453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>s});var i=o(96540);const t={},a=i.createContext(t);function r(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(a.Provider,{value:n},e.children)}},96091:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"Reference/kairosctl","title":"kairosctl","description":"Learn how to use kairosctl to register nodes, generate tokens, and manage VPN connections securely and efficiently.","source":"@site/versioned_docs/version-3.5.7/Reference/kairosctl.md","sourceDirName":"Reference","slug":"/Reference/kairosctl","permalink":"/docs/3.5.7/Reference/kairosctl","draft":false,"unlisted":false,"editUrl":"https://github.com/kairos-io/kairos-docs/tree/main/versioned_docs/version-3.5.7/Reference/kairosctl.md","tags":[],"version":"3.5.7","lastUpdatedBy":"Jasper De Keukelaere (imec)","lastUpdatedAt":1765142882000,"sidebarPosition":3,"frontMatter":{"title":"kairosctl","sidebar_label":"kairosctl","description":"Learn how to use kairosctl to register nodes, generate tokens, and manage VPN connections securely and efficiently.","sidebar_position":3,"date":"2022-11-13T00:00:00.000Z"},"sidebar":"tutorialSidebar","previous":{"title":"Configuration","permalink":"/docs/3.5.7/Reference/configuration"},"next":{"title":"Stage modules","permalink":"/docs/3.5.7/Reference/stage_modules"}}');var t=o(74848),a=o(28453);const r={title:"kairosctl",sidebar_label:"kairosctl",description:"Learn how to use kairosctl to register nodes, generate tokens, and manage VPN connections securely and efficiently.",sidebar_position:3,date:new Date("2022-11-13T00:00:00.000Z")},s=void 0,l={},c=[{value:"create-config",id:"create-config",level:2},{value:"generate-token",id:"generate-token",level:2},{value:"register",id:"register",level:2},{value:"Taking a screenshot",id:"taking-a-screenshot",level:3},{value:"Providing a QR code image/screenshot manually",id:"providing-a-qr-code-imagescreenshot-manually",level:3},{value:"bridge",id:"bridge",level:2},{value:"validate",id:"validate",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"kairosctl"})," binary is provided as part of releases associated to each Kairos version. It can be used from an external machine to generate network tokens and pair nodes on first-boot."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -L https://github.com/kairos-io/provider-kairos/releases/download/\x3c!-- Hugo shortcode: providerVersion --\x3e/kairosctl-.\x3c!-- Hugo shortcode: providerVersion --\x3e-.linux-.amd64.tar.gz -o - | tar -xvzf - -C .\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# optionally, install the CLI locally\nmv kairosctl /usr/local/bin/kairosctl\nchmod +x /usr/local/bin/kairosctl\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"./kairosctl --help\nNAME:\n   kairosctl - A new cli application\n\nUSAGE:\n   kairosctl [global options] command [command options] [arguments...]\n\nVERSION:\n   0.0.0\n\nAUTHOR:\n   Ettore Di Giacinto\n\nCOMMANDS:\n   register        Registers and bootstraps a node\n   bridge          Connect to a kairos VPN network\n   get-kubeconfig  Return a deployment kubeconfig\n   role            Set or list node roles\n   help, h         Shows a list of commands or help for one command\n\nGLOBAL OPTIONS:\n   --help, -h     show help\n   --version, -v  print the version\n\nCOPYRIGHT:\n   Ettore Di Giacinto\n"})}),"\n",(0,t.jsx)(n.h2,{id:"create-config",children:"create-config"}),"\n",(0,t.jsx)(n.p,{children:"Generates a new Kairos configuration file which can be used as cloud-init, with a new unique EdgeVPN network token:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'$ ./kairosctl create-config\nkairos:\n  network_token: b3RwOgogIGRodDoKICAgIGludGVydmFsOiA5MjIzMzcyMDM2ODU0Nzc1ODA3CiAgICBrZXk6IEVCMzJJMlNXTjJCNFBHNEtCWTNBUVBBS0FWRTY0Q0VLVUlDTktTUFVWVU5BWTM0QklEQ0EKICAgIGxlbmd0aDogMzIKICBjcnlwdG86CiAgICBpbnRlcnZhbDogOTIyMzM3MjAzNjg1NDc3NTgwNwogICAga2V5OiBDMk1RRk5DWEFVRElPWjVHM1pZUUIzVEVHTzVXVEdQR1pZSEVQQkY3SFEyVUROUlZCTkxRCiAgICBsZW5ndGg6IDMyCnJvb206IGp6Q29kQVVOWUZSUklQU3JISmx4d1BVUnVxTGJQQnh4CnJlbmRlenZvdXM6IG5NckRCbllyVVBMdnFPV0Z2dWZvTktXek1adEJIRmpzCm1kbnM6IGpQUUhIbVZza2x6V29xbWNkeVlnbVhMSVFjTE1HUFN6Cm1heF9tZXNzYWdlX3NpemU6IDIwOTcxNTIwCg==\n  offline: false\n  reboot: false\n  device: ""\n  poweroff: false\n'})}),"\n",(0,t.jsx)(n.p,{children:"Now you can use this in your configuration file to create new Kairos nodes:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'kairos:\n  network_token: b3RwOgogIGRodDoKICAgIGludGVydmFsOiA5MjIzMzcyMDM2ODU0Nzc1ODA3CiAgICBrZXk6IEVCMzJJMlNXTjJCNFBHNEtCWTNBUVBBS0FWRTY0Q0VLVUlDTktTUFVWVU5BWTM0QklEQ0EKICAgIGxlbmd0aDogMzIKICBjcnlwdG86CiAgICBpbnRlcnZhbDogOTIyMzM3MjAzNjg1NDc3NTgwNwogICAga2V5OiBDMk1RRk5DWEFVRElPWjVHM1pZUUIzVEVHTzVXVEdQR1pZSEVQQkY3SFEyVUROUlZCTkxRCiAgICBsZW5ndGg6IDMyCnJvb206IGp6Q29kQVVOWUZSUklQU3JISmx4d1BVUnVxTGJQQnh4CnJlbmRlenZvdXM6IG5NckRCbllyVVBMdnFPV0Z2dWZvTktXek1adEJIRmpzCm1kbnM6IGpQUUhIbVZza2x6V29xbWNkeVlnbVhMSVFjTE1HUFN6Cm1heF9tZXNzYWdlX3NpemU6IDIwOTcxNTIwCg==\n  offline: false\n  reboot: false\n  device: ""\n  poweroff: false\n\nstages:\n  network:\n    - name: "Setup users"\n      authorized_keys:\n        kairos:\n          - github:yourhandle!\n'})}),"\n",(0,t.jsx)(n.h2,{id:"generate-token",children:"generate-token"}),"\n",(0,t.jsx)(n.p,{children:"Generates a new EdgeVPN network token which can be used in a configuration file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"$ ./kairosctl generate-token\nb3RwOgogIGRodDoKICAgIGludGVydmFsOiA5MjIzMzcyMDM2ODU0Nzc1ODA3CiAgICBrZXk6IFhMMjRYUk1MTlFOQ1pJQTU0SVFLQ1laMk83SENQWEFBU1ZKN0tZSTQ3MzVaUkpKSktRSEEKICAgIGxlbmd0aDogMzIKICBjcnlwdG86CiAgICBpbnRlcnZhbDogOTIyMzM3MjAzNjg1NDc3NTgwNwogICAga2V5OiBMR1dMWFBTUllaU0ZERDdOT0pBNzdKV0ZWQjRHVkZBMjJIWlZPWU1VT0lNSFVYNFZXUURRCiAgICBsZW5ndGg6IDMyCnJvb206IFRtcUt5VnFHQ1ZZam9TRm9CTEVNRGVEdmJzelBkVEdoCnJlbmRlenZvdXM6IGttb3J4Q21sY2NjVVppWmdkSW5xTERvTGJtS3ZGdm9mCm1kbnM6IEZkWVdQc2R4aHdvWHZlb0VzSXNnVHRXbEJUbE9IVHJmCm1heF9tZXNzYWdlX3NpemU6IDIwOTcxNTIwCg==\n"})}),"\n",(0,t.jsx)(n.p,{children:"And now:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'kairos:\n  network_token: b3RwOgogIGRodDoKICAgIGludGVydmFsOiA5MjIzMzcyMDM2ODU0Nzc1ODA3CiAgICBrZXk6IFhMMjRYUk1MTlFOQ1pJQTU0SVFLQ1laMk83SENQWEFBU1ZKN0tZSTQ3MzVaUkpKSktRSEEKICAgIGxlbmd0aDogMzIKICBjcnlwdG86CiAgICBpbnRlcnZhbDogOTIyMzM3MjAzNjg1NDc3NTgwNwogICAga2V5OiBMR1dMWFBTUllaU0ZERDdOT0pBNzdKV0ZWQjRHVkZBMjJIWlZPWU1VT0lNSFVYNFZXUURRCiAgICBsZW5ndGg6IDMyCnJvb206IFRtcUt5VnFHQ1ZZam9TRm9CTEVNRGVEdmJzelBkVEdoCnJlbmRlenZvdXM6IGttb3J4Q21sY2NjVVppWmdkSW5xTERvTGJtS3ZGdm9mCm1kbnM6IEZkWVdQc2R4aHdvWHZlb0VzSXNnVHRXbEJUbE9IVHJmCm1heF9tZXNzYWdlX3NpemU6IDIwOTcxNTIwCg==\n  offline: false\n  reboot: false\n  device: ""\n  poweroff: false\n\nstages:\n  network:\n    - name: "Setup users"\n      authorized_keys:\n        kairos:\n          - github:yourhandle!\n'})}),"\n",(0,t.jsx)(n.h2,{id:"register",children:"register"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"register"})," command can be used to register and drive installation of nodes via QR code with a ",(0,t.jsx)(n.code,{children:"cloud-init"})," config file (with ",(0,t.jsx)(n.code,{children:"--config"}),")."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"NAME:\n    register -\n\nUSAGE:\n    register [command options] [arguments...]\n\nOPTIONS:\n   --config value\n   --device value\n   --reboot\n   --poweroff\n"})}),"\n",(0,t.jsxs)(n.p,{children:["When booting Kairos via ISO, the boot process ends up in displaying a QR code which can be parsed by ",(0,t.jsx)(n.code,{children:"kairosctl register"})," from another machine."]}),"\n",(0,t.jsx)(n.h3,{id:"taking-a-screenshot",children:"Taking a screenshot"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"register"})," by default takes a screenshot and tries to find a QR code in it:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"kairosctl register\n"})}),"\n",(0,t.jsx)(n.h3,{id:"providing-a-qr-code-imagescreenshot-manually",children:"Providing a QR code image/screenshot manually"}),"\n",(0,t.jsx)(n.p,{children:"It can be also be specified an image:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"kairosctl register <file.png>\n"})}),"\n",(0,t.jsx)(n.p,{children:"After the pairing is done, the node will start installation with the provided options."}),"\n",(0,t.jsxs)(n.p,{children:["A ",(0,t.jsx)(n.code,{children:"--device"})," and a ",(0,t.jsx)(n.code,{children:"--config"})," file are required in order to have a functional installation."]}),"\n",(0,t.jsx)(n.h2,{id:"bridge",children:"bridge"}),"\n",(0,t.jsx)(n.p,{children:"Connect to the nodes in the VPN P2P network by creating a tun device on the host."}),"\n",(0,t.jsxs)(n.p,{children:["It needs a ",(0,t.jsx)(n.code,{children:"--network-token"}),"(",(0,t.jsx)(n.code,{children:"$NETWORK_TOKEN"}),") argument and exposes an API endpoint available at ",(0,t.jsx)(n.a,{href:"http://localhost:8080",children:"localhost:8080"})," to monitor the network status."]}),"\n",(0,t.jsx)(n.h2,{id:"validate",children:"validate"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"validate"})," command can be used to validate a cloud config file."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"NAME:\n   kairosctl validate - Validates a cloud config file\n\nUSAGE:\n   kairosctl validate [command options] [arguments...]\n\nDESCRIPTION:\n   \n   The validate command expects a configuration file as its only argument. Local files and URLs are accepted.\n       \n\nOPTIONS:\n   --help, -h  show help\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);