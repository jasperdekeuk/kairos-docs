"use strict";(globalThis.webpackChunkkairos_docs=globalThis.webpackChunkkairos_docs||[]).push([[3332],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>r});var t=i(96540);const s={},a=t.createContext(s);function o(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(a.Provider,{value:n},e.children)}},43448:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"Advanced/configuring_partitions","title":"Configuring partitions","description":"Kairos configuration mechanism for partitions is based on the cloud-config file","source":"@site/versioned_docs/version-3.6.0/Advanced/configuring_partitions.md","sourceDirName":"Advanced","slug":"/Advanced/configuring_partitions","permalink":"/docs/3.6.0/Advanced/configuring_partitions","draft":false,"unlisted":false,"editUrl":"https://github.com/kairos-io/kairos-docs/tree/main/versioned_docs/version-3.6.0/Advanced/configuring_partitions.md","tags":[],"version":"3.6.0","lastUpdatedBy":"Jasper De Keukelaere (imec)","lastUpdatedAt":1765142882000,"sidebarPosition":1,"frontMatter":{"title":"Configuring partitions","sidebar_label":"Configuring partitions","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"After install","permalink":"/docs/3.6.0/Advanced/after-install"},"next":{"title":"Creating Custom Cloud Images","permalink":"/docs/3.6.0/Advanced/creating_custom_cloud_images"}}');var s=i(74848),a=i(28453);const o={title:"Configuring partitions",sidebar_label:"Configuring partitions",sidebar_position:1},r=void 0,l={},d=[{value:"Manual partitioning",id:"manual-partitioning",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["Kairos configuration mechanism for partitions is based on the ",(0,s.jsx)(n.a,{href:"../../Reference/configuration",children:"cloud-config"})," file\ngiven during installation to override the default values set by the installer."]}),"\n",(0,s.jsx)(n.p,{children:"We allow certain flexibility in the sizes and filesystems used for the default install and allow to create extra partitions as well."}),"\n",(0,s.jsxs)(n.p,{children:["For example, the following cloud-config will make the ",(0,s.jsx)(n.code,{children:"oem"})," partition have a size of 512Mb and an ",(0,s.jsx)(n.code,{children:"ext4"})," filesystem,\nrecovery with a size of 10000Mb and a ",(0,s.jsx)(n.code,{children:"ext4"})," filesystem, while leaving the rest of the partitions to their default sizes and filesystems."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'#cloud-config\n\ninstall:\n  device: "/dev/sda"\n  auto: true\n  partitions:\n    oem:\n      size: 512\n      fs: ext4\n    recovery:\n      size: 10000\n      fs: ext4\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The partitions that can be configured are: ",(0,s.jsx)(n.code,{children:"oem"}),", ",(0,s.jsx)(n.code,{children:"recovery"}),", ",(0,s.jsx)(n.code,{children:"state"})," and ",(0,s.jsx)(n.code,{children:"persistent"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"And the following config will leave the default partitions as is, but create 2 new extra partitions with the given sizes, filesystems and labels:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'#cloud-config\n\ninstall:\n  device: "/dev/sda"\n  auto: true\n  extra-partitions:\n    - name: first_partition\n      size: 512\n      fs: ext3\n    - name: second_partition\n      size: 100\n      fs: ext2\n      label: PARTITION_TWO\n'})}),"\n",(0,s.jsx)(n.p,{children:"Only one partition can expand to the rest of the disk.\nEither persistent or one of the extra-partitions.\nIn case you want the latter, you need to specify the size of persistent to a fixed value."}),"\n",(0,s.jsx)(n.p,{children:"An example of this would be as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'#cloud-config\n\ninstall:\n  device: "/dev/sda"\n  auto: true\n  partitions:\n    persistent:\n      size: 500\n  extra-partitions:\n    - name: big_partition\n      size: 0\n      fs: ext3\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Note that there are some caveats in the ",(0,s.jsx)(n.code,{children:"extra partitions"})," setup:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Only ",(0,s.jsx)(n.code,{children:"size"}),", ",(0,s.jsx)(n.code,{children:"fs"}),", ",(0,s.jsx)(n.code,{children:"name"})," and ",(0,s.jsx)(n.code,{children:"label"})," are used for the partition creation, the name is currently used for the partition label."]}),"\n",(0,s.jsx)(n.li,{children:"If a partition has no fs set, the partition will be created, but it will not be formatted."}),"\n",(0,s.jsx)(n.li,{children:"No mounting of any type is done during installation to the extra partitions. That part should be done on the stages of the cloud-config manually, with something like the following step:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'  initramfs:\n    - name: "Mount PARTITION_TWO under /opt/extra"\n      commands:\n        - mkdir -p /opt/extra\n        - mount -o rw /dev/disk/by-label/PARTITION_TWO /opt/extra\n'})}),"\n",(0,s.jsx)(n.h2,{id:"manual-partitioning",children:"Manual partitioning"}),"\n",(0,s.jsxs)(n.p,{children:["In some cases, it's desired that the user has full control over the partitioning of the disk.\nThis can be achieved by setting the ",(0,s.jsx)(n.code,{children:"no-format"})," option to ",(0,s.jsx)(n.code,{children:"true"})," and making sure the disk\nis prepared with the desired partitions before running the installer."]}),"\n",(0,s.jsx)(n.p,{children:'Here is an example config that instructs the installer to use the "second" disk (/dev/vdb)\nand makes sure the disk is prepared with the desired partitions:'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'#cloud-config\n\ninstall:\n  no-format: true\n  auto: false\n  poweroff: false\n  reboot: false\n\nusers:\n  - name: "kairos"\n    passwd: "kairos"\n\nstages:\n  kairos-install.pre.before:\n  - if:  \'[ -e "/dev/vdb" ]\'\n    name: "Create partitions"\n    commands:\n      - |\n        parted --script --machine -- "/dev/vdb" mklabel gpt\n        # Legacy bios\n        sgdisk --new=1:2048:+1M --change-name=1:\'bios\' --typecode=1:EF02 /dev/vdb\n    layout:\n      device:\n        path: "/dev/vdb"\n      add_partitions:\n        # For efi (comment out the legacy bios partition above)\n        #- fsLabel: COS_GRUB\n        #  size: 64\n        #  pLabel: efi\n        #  filesystem: "fat"\n        - fsLabel: COS_OEM\n          size: 64\n          pLabel: oem\n        - fsLabel: COS_RECOVERY\n          size: 8500\n          pLabel: recovery\n        - fsLabel: COS_STATE\n          size: 18000\n          pLabel: state\n        - fsLabel: COS_PERSISTENT\n          pLabel: persistent\n          size: 0\n          filesystem: "ext4"\n'})}),"\n",(0,s.jsxs)(n.p,{children:["For more information about the full config available for partitions and extra partitions see the full ",(0,s.jsx)(n.a,{href:"../../Reference/configuration",children:"cloud-config page"})]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);