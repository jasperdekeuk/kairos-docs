<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Advanced/sys-extensions" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Extending the system with systemd extensions | Kairos</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kairos.io/kairos-docs/img/Kairos_800x419.png"><meta data-rh="true" name="twitter:image" content="https://kairos.io/kairos-docs/img/Kairos_800x419.png"><meta data-rh="true" property="og:url" content="https://kairos.io/kairos-docs/docs/next/Advanced/sys-extensions"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Extending the system with systemd extensions | Kairos"><meta data-rh="true" name="description" content="This feature is in preview state and only available in Kairos v3.4.x releases and alphas."><meta data-rh="true" property="og:description" content="This feature is in preview state and only available in Kairos v3.4.x releases and alphas."><link data-rh="true" rel="icon" href="/kairos-docs/img/logo.svg"><link data-rh="true" rel="canonical" href="https://kairos.io/kairos-docs/docs/next/Advanced/sys-extensions"><link data-rh="true" rel="alternate" href="https://kairos.io/kairos-docs/docs/next/Advanced/sys-extensions" hreflang="en"><link data-rh="true" rel="alternate" href="https://kairos.io/kairos-docs/docs/next/Advanced/sys-extensions" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Advanced","item":"https://kairos.io/kairos-docs/docs/next/category/advanced"},{"@type":"ListItem","position":2,"name":"Extending the system with systemd extensions","item":"https://kairos.io/kairos-docs/docs/next/Advanced/sys-extensions"}]}</script><link rel="alternate" type="application/rss+xml" href="/kairos-docs/blog/rss.xml" title="Kairos RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/kairos-docs/blog/atom.xml" title="Kairos Atom Feed">




<script src="https://buttons.github.io/buttons.js" async defer="defer"></script><link rel="stylesheet" href="/kairos-docs/assets/css/styles.c9791132.css">
<script src="/kairos-docs/assets/js/runtime~main.32d1f2f4.js" defer="defer"></script>
<script src="/kairos-docs/assets/js/main.a6b903dc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/kairos-docs/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/kairos-docs/"><div class="navbar__logo"><img src="/kairos-docs/img/logo.svg" alt="Kairos Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/kairos-docs/img/logo.svg" alt="Kairos Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Kairos</b></a><a class="navbar__item navbar__link" href="/kairos-docs/docs/getting-started">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/kairos-docs/docs/next/getting-started/">Documentation</a><a class="navbar__item navbar__link" href="/kairos-docs/blog">Blog</a><a href="https://kairos.io/community/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/kairos-docs/docs/next/Advanced/sys-extensions">Next ğŸš§</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/kairos-docs/docs/next/Advanced/sys-extensions">Next ğŸš§</a></li><li><a class="dropdown__link" href="/kairos-docs/docs/3.6.0/Advanced/sys-extensions">3.6.0 (Latest)</a></li><li><a class="dropdown__link" href="/kairos-docs/docs/3.5.7/Advanced/sys-extensions">3.5.7</a></li></ul></div><div class="navbar__item"><a class="github-button" href="https://github.com/kairos-io/kairos" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star kairos-io/kairos on GitHub">Star</a></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/kairos-docs/docs/next/getting-started/"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/kairos-docs/docs/next/category/installation"><span title="Installation" class="categoryLinkLabel_W154">Installation</span></a><button aria-label="Expand sidebar category &#x27;Installation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/kairos-docs/docs/next/category/architecture"><span title="Architecture" class="categoryLinkLabel_W154">Architecture</span></a><button aria-label="Expand sidebar category &#x27;Architecture&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/kairos-docs/docs/next/category/advanced"><span title="Advanced" class="categoryLinkLabel_W154">Advanced</span></a><button aria-label="Collapse sidebar category &#x27;Advanced&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kairos-docs/docs/next/Advanced/after-install"><span title="After install" class="linkLabel_WmDU">After install</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kairos-docs/docs/next/Advanced/configuring_partitions"><span title="Configuring partitions" class="linkLabel_WmDU">Configuring partitions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kairos-docs/docs/next/Advanced/creating_custom_cloud_images"><span title="Creating Custom Cloud Images" class="linkLabel_WmDU">Creating Custom Cloud Images</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kairos-docs/docs/next/Advanced/customizing"><span title="Customization" class="linkLabel_WmDU">Customization</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kairos-docs/docs/next/Advanced/private_registry_auth"><span title="Private registries authentication" class="linkLabel_WmDU">Private registries authentication</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kairos-docs/docs/next/Advanced/adding_opt_to_system_extensions"><span title="Using /opt with System Extensions" class="linkLabel_WmDU">Using /opt with System Extensions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kairos-docs/docs/next/Advanced/build"><span title="Build" class="linkLabel_WmDU">Build</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kairos-docs/docs/next/Advanced/networking"><span title="Networking" class="linkLabel_WmDU">Networking</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/kairos-docs/docs/next/Advanced/sys-extensions"><span title="Extending the system with systemd extensions" class="linkLabel_WmDU">Extending the system with systemd extensions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kairos-docs/docs/next/Advanced/bundles"><span title="Bundles" class="linkLabel_WmDU">Bundles</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kairos-docs/docs/next/Advanced/partition_encryption"><span title="Encrypting User Data with Kairos" class="linkLabel_WmDU">Encrypting User Data with Kairos</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kairos-docs/docs/next/Advanced/coco"><span title="Confidential Computing" class="linkLabel_WmDU">Confidential Computing</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/kairos-docs/docs/next/Advanced/revoking-secureboot-access"><span title="Revoking secure boot access" class="linkLabel_WmDU">Revoking secure boot access</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/kairos-docs/docs/next/Upgrade/manual"><span title="Upgrade" class="categoryLinkLabel_W154">Upgrade</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/kairos-docs/docs/next/category/reference"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a><button aria-label="Expand sidebar category &#x27;Reference&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/kairos-docs/docs/next/category/development"><span title="Development" class="categoryLinkLabel_W154">Development</span></a><button aria-label="Expand sidebar category &#x27;Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/kairos-docs/docs/next/Examples/boot_assessment_trusted_boot"><span title="Examples" class="categoryLinkLabel_W154">Examples</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Kairos<!-- --> <b>Next ğŸš§</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/kairos-docs/docs/3.6.0/Advanced/sys-extensions">latest version</a></b> (<!-- -->3.6.0 (Latest)<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/kairos-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/kairos-docs/docs/next/category/advanced"><span>Advanced</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Extending the system with systemd extensions</span></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next ğŸš§</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Extending the system with systemd extensions</h1></header><div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Warning</div><div class="admonitionContent_BuS1"><p>This feature is in preview state and only available in Kairos v3.4.x releases and alphas.
Please check the section &quot;Known issues&quot; at the bottom for more information.</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Signing keys for system extensions under Trusted Boot</div><div class="admonitionContent_BuS1"><p>Sysexts need to be signed with the same key/cert as the ones used to sign the EFI files. As those are part of the system and available in the EFI firmware, we can extract the public part and verify the sysexts locally. Any of the PK, KEK or DB keys can be used to sign sysexts. This only affects Trusted Boot.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction" translate="no">â€‹</a></h3>
<p>System extensions are a way to extend the system with additional files and directories that are mounted at boot time. System extension images may â€“ dynamically at runtime â€” extend the /usr/ directory hierarchies with additional files. This is particularly useful on immutable system images where a /usr/ hierarchy residing on a read-only file system shall be extended temporarily at runtime without making any persistent modifications.
Or on a Trusted Boot system where the system is booted from a read-only EFI and cannot be extended easily without breaking the signature.</p>
<p>This feature works on both Trusted Boot and normal Kairos installations, the only difference is the signature verification of the system extension images. On Trusted Boot, the system extension images are verified against the public keys stored in the firmware. This is done to ensure that only trusted extensions are loaded into the system.</p>
<p>For more information on system extensions, please refer to the <a href="https://www.freedesktop.org/software/systemd/man/latest/systemd-sysext.html" target="_blank" rel="noopener noreferrer" class="">System extensions documentation</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="building-system-extensions-manually">Building system extensions manually<a href="#building-system-extensions-manually" class="hash-link" aria-label="Direct link to Building system extensions manually" title="Direct link to Building system extensions manually" translate="no">â€‹</a></h3>
<p>To build a system extension, you need to create a directory with the files you want to add to the system. Then you can use the <code>systemd-repart</code> tool to create a system extension image which is signed and verity protected.</p>
<p>The directory with the sources needs to be structured in a way that the files are placed in the same path as they would be in the final system. For example, this is the dir tree for k3s:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ v1.29.2+k3s1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    â””â”€â”€ usr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        â”œâ”€â”€ lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        â”‚Â Â  â””â”€â”€ extension-release.d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        â”‚Â Â      â””â”€â”€ extension-release.k3s-v1.29.2+k3s1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        â””â”€â”€ local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            â”œâ”€â”€ bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            â”‚Â Â  â”œâ”€â”€ crictl -&gt; ./k3s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            â”‚Â Â  â”œâ”€â”€ ctr -&gt; ./k3s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            â”‚Â Â  â”œâ”€â”€ k3s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            â”‚Â Â  â””â”€â”€ kubectl -&gt; ./k3s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            â””â”€â”€ lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                â””â”€â”€ systemd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    â””â”€â”€ system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        â”œâ”€â”€ k3s-agent.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        â””â”€â”€ k3s.service</span><br></span></code></pre></div></div>
<p>Then you can use the <code>systemd-repart</code> tool to create the sysext image:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ systemd-repart -S -s SOURCE_DIR NAME.sysext.raw --private-key=PRIVATE_KEY --certificate=CERTIFICATE</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Warning</div><div class="admonitionContent_BuS1"><p>Note that the extensions MUST have a <code>/usr/lib/extension-release.d/extension-release.NAME</code> file in which the NAME needs to match the sysext NAME (extension is ignored). This is an enforcement by systemd to ensure the sysext is correctly identified and some sanity checks are done with the info in that file.</p></div></div>
<p>This will generate a signed+verity sysextension that can then be used by sysext to extend the system.</p>
<p>Some extension examples are available under <a href="https://github.com/Itxaka/sysext-examples" target="_blank" rel="noopener noreferrer" class="">https://github.com/Itxaka/sysext-examples</a> for k3s and sbctl.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="building-system-extensions-from-a-docker-image-with-auroraboot">Building system extensions from a docker image with auroraboot<a href="#building-system-extensions-from-a-docker-image-with-auroraboot" class="hash-link" aria-label="Direct link to Building system extensions from a docker image with auroraboot" title="Direct link to Building system extensions from a docker image with auroraboot" translate="no">â€‹</a></h3>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Warning</div><div class="admonitionContent_BuS1"><p>This feature is in preview state and only available in Auroraboot from version v0.3.0</p></div></div>
<p>You can also build a system extension from a docker image directly by using <a href="https://github.com/kairos-io/AuroraBoot" target="_blank" rel="noopener noreferrer" class="">auroraboot</a> and using a dockerfile to isolate the artifacts you want converted into a system extension.</p>
<p>Notice that when converting a docker image into a system extension, the last layer is the only one converted (The last command in a given Dockerfile) so have that in mind. This is useful for packages that ONLY install things in /usr or manual installation under /usr.</p>
<p>The <code>/usr/lib/extension-release.d/extension-release.NAME</code> file necessary for identifying the system extension is automatically created by the command so in this case you should not worry about that file.</p>
<p>For example for a given Dockerfiles as such:</p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM anchore/grype:latest AS grype</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM scratch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY --from=grype /grype /usr/local/bin/grype</span><br></span></code></pre></div></div>
<p>Only the files added in the last step will be converted to a sysext, so the contents of the sysext would be the <code>/usr/local/bin/grype</code> binary only.</p>
<p>Or for a even more manual one:</p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM alpine:3.19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN apk add curl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN curl -L https://github.com/Foxboron/sbctl/releases/download/0.15.4/sbctl-0.15.4-linux-amd64.tar.gz | tar xvzf - --strip-components=1 -C /usr/local/bin/</span><br></span></code></pre></div></div>
<p>Again, only the files in the last step would be converted into a system extension, so we would get the contents of the extracted tar archive at the <code>/usr/local/bin/</code> path.</p>
<p>After building the chosen Dockerfile, we would just need to run osbuilder with the <code>sysext</code> command and the key and certificate, like we would do with <code>systemd-repart</code>. Notice that we are binding the local <code>keys/</code> dir into the container <code>/keys</code> dir for ease of access to the given keys and the current dir under <code>/build</code> on the container so we set the <code>--output=/build</code> flag when calling auroraboot:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ docker run \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-v &quot;$PWD&quot;/keys:/keys \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-v &quot;$PWD&quot;:/build/ \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-v /var/run/docker.sock:/var/run/docker.sock \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--rm \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quay.io/kairos/auroraboot:latest sysext --private-key=/keys/PRIVATE_KEY --certificate=/keys/CERTIFICATE --output=/build NAME CONTAINER_IMAGE</span><br></span></code></pre></div></div>
<p>The explanation of the docker command flags is as follows:</p>
<ul>
<li class=""><code>-v &quot;$PWD&quot;/keys:/keys</code>: We mount the current dir + keys dir into the container <code>/keys</code> path. So auroraboot has access to the keys to sign the sysext.</li>
<li class=""><code>-v &quot;$PWD&quot;:/build/</code>: Mount the current dir into the container <code>/build</code> path. So the generated sysext is available after the container is gone.</li>
<li class=""><code>-v /var/run/docker.sock:/var/run/docker.sock</code>: We pass the docker sock into the container so it can access our locally built container images. So we avoid pushing them and pulling them from a remote registry.</li>
<li class=""><code>--rm</code>: Once the container exit, remove it so we dont leave stuff lying around.</li>
</ul>
<p>The explanation of the auroraboot command flags is as follows:</p>
<ul>
<li class=""><code>sysext</code>: Subcommand to call, in this case we want to build a sysext</li>
<li class=""><code>--private-key</code>: Private key to sign the system extension.</li>
<li class=""><code>--certificate</code>: Certificate to sign the system extension.</li>
<li class=""><code>--output</code>: Dir where we will output the system extension. Make sure that this matches the directory that passed to the docker command to be able to keep the generated system extension once the container exists and its removed.</li>
<li class=""><code>NAME</code>: Output and internal name of the sysext.</li>
<li class=""><code>CONTAINER_IMAGE</code>: Image from which we will extract the last layer and covert it to a system extension.</li>
</ul>
<p>Example of a successful run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ docker run -v &quot;$PWD&quot;:/build/ -v /tmp/keys/:/keys -v /var/run/docker.sock:/var/run/docker.sock --rm -ti quay.io/kairos/auroraboot:latest sysext --private-key=/keys/db.key --certificate=/keys/db.pem --output /build grype sysext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-09-16T14:59:36Z INF Starting auroraboot version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-09-16T14:59:36Z INF ğŸš€ Start sysext creation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-09-16T14:59:36Z INF ğŸ’¿ Getting image info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-09-16T14:59:36Z INF ğŸ“¤ Extracting archives from image layer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-09-16T14:59:37Z INF ğŸ“¦ Packing sysext into raw image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2024-09-16T14:59:37Z INF ğŸ‰ Done sysext creation output=/build/grype.sysext.raw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ls -ltra *.raw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r-- 1 root root 64729088 sep 16 17:24 grype.sysext.raw</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="verifying-the-system-extensions">Verifying the system extensions<a href="#verifying-the-system-extensions" class="hash-link" aria-label="Direct link to Verifying the system extensions" title="Direct link to Verifying the system extensions" translate="no">â€‹</a></h3>
<p>You can use <code>systemd-dissect</code> to verify the system extension, the ID, ARCHITECTURE and the partitions that are included in the system extension.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo systemd-dissect sbctl-0.14.sysext.raw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Name: sbctl-0.14.sysext.raw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Size: 21.0M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Sec. Size: 512</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Arch.: x86-64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Image UUID: 351f0e17-35e5-42ff-bf09-8db65c756f7b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> sysext R.: ID=_any</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ARCHITECTURE=x86-64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Use As: âœ— bootable system for UEFI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            âœ— bootable system for container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            âœ— portable service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            âœ— initrd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            âœ“ sysext for system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            âœ“ sysext for portable service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            âœ— sysext for initrd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            âœ— confext for system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            âœ— confext for portable service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            âœ— confext for initrd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RW DESIGNATOR      PARTITION UUID                       PARTITION LABEL        FSTYPE                AR&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ro root            4afae1e5-c73c-2f5a-acdc-3655ed91d4e0 root-x86-64            erofs                 x8&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ro root-verity     abea5f2f-214d-4d9f-83f8-ee69ca7614ba root-x86-64-verity     DM_verity_hash        x8&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ro root-verity-sig bdb3ee65-ed86-480c-a750-93015254f1a7 root-x86-64-verity-sig verity_hash_signature x8&gt;</span><br></span></code></pre></div></div>
<h1>Managing System Extensions in Kairos</h1>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="-where-extensions-live">ğŸ“‚ Where Extensions Live<a href="#-where-extensions-live" class="hash-link" aria-label="Direct link to ğŸ“‚ Where Extensions Live" title="Direct link to ğŸ“‚ Where Extensions Live" translate="no">â€‹</a></h2>
<p>All system extensions are stored in:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/var/lib/kairos/extensions/</span><br></span></code></pre></div></div>
<p>From there, theyâ€™re symlinked into directories based on the systemâ€™s boot profile:</p>
<table><thead><tr><th>Directory</th><th>Behavior</th></tr></thead><tbody><tr><td><code>active/</code></td><td>Loaded when booting into the <em>active</em> profile</td></tr><tr><td><code>passive/</code></td><td>Loaded during <em>passive</em> boot</td></tr><tr><td><code>recovery/</code></td><td>Loaded in <em>recovery mode</em></td></tr><tr><td><code>common/</code></td><td><strong>Always loaded</strong>, regardless of boot mode</td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ These directories contain only <strong>symlinks</strong>â€”the actual disk image is stored once. This ensures thereâ€™s no duplication or leftover state between boots.</p>
</blockquote>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="ï¸-cli-usage">ğŸ› ï¸ CLI Usage<a href="#ï¸-cli-usage" class="hash-link" aria-label="Direct link to ğŸ› ï¸ CLI Usage" title="Direct link to ğŸ› ï¸ CLI Usage" translate="no">â€‹</a></h2>
<p>Manage extensions using <code>kairos-agent sysext</code> commands.</p>
<blockquote>
<p>ğŸ“ <strong>Tip:</strong> For enable, disable and remove commands, the extension name supports <strong>regex matching</strong>. You donâ€™t need to type the full filename.
For example, to match <code>k3sv1.32.1.k3s0.sysext.raw</code>, you can simply use <code>k3s</code>.</p>
</blockquote>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="subcommands">Subcommands<a href="#subcommands" class="hash-link" aria-label="Direct link to Subcommands" title="Direct link to Subcommands" translate="no">â€‹</a></h2>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-download">ğŸ“¥ <code>download</code><a href="#-download" class="hash-link" aria-label="Direct link to -download" title="Direct link to -download" translate="no">â€‹</a></h3>
<p>Downloads a system extension and stores it on the node.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kairos-agent sysext download &lt;URI&gt;</span><br></span></code></pre></div></div>
<p><strong>Supported URI formats:</strong></p>
<ul>
<li class=""><code>https://</code> â€“ Download a raw disk image from a remote server</li>
<li class=""><code>http://</code> â€“ Same as above, unencrypted</li>
<li class=""><code>file://</code> â€“ Load a local disk image file</li>
<li class=""><code>oci://</code> â€“ Download from an OCI-compatible container registry</li>
</ul>
<blockquote>
<p>âš ï¸ <strong>Important Notes:</strong></p>
<ul>
<li class=""><code>http(s)</code> and <code>file://</code> URIs must point directly to a raw disk image file.</li>
<li class=""><code>oci://</code> support is <strong>alpha-stage</strong> and may change.</li>
<li class="">When using <code>oci://</code>, the disk image must be <strong>embedded inside the OCI image layer</strong>.</li>
</ul>
</blockquote>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-enable">âœ… <code>enable</code><a href="#-enable" class="hash-link" aria-label="Direct link to -enable" title="Direct link to -enable" translate="no">â€‹</a></h3>
<p>Enable an extension for a specific boot profile:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kairos-agent sysext enable --active my-extension</span><br></span></code></pre></div></div>
<p><strong>Supported profile flags:</strong></p>
<ul>
<li class=""><code>--active</code></li>
<li class=""><code>--passive</code></li>
<li class=""><code>--recovery</code></li>
<li class=""><code>--common</code></li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="-use---now-for-immediate-activation">ğŸ”„ Use <code>--now</code> for Immediate Activation<a href="#-use---now-for-immediate-activation" class="hash-link" aria-label="Direct link to -use---now-for-immediate-activation" title="Direct link to -use---now-for-immediate-activation" translate="no">â€‹</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kairos-agent sysext enable --active --now my-extension</span><br></span></code></pre></div></div>
<p>If the current boot mode matches, this also:</p>
<ul>
<li class="">Creates a link in <code>/run/extensions/</code></li>
<li class="">Reloads <code>systemd-sysext</code> so the extension is active <em>immediately</em></li>
</ul>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-disable">ğŸš« <code>disable</code><a href="#-disable" class="hash-link" aria-label="Direct link to -disable" title="Direct link to -disable" translate="no">â€‹</a></h3>
<p>Remove the symlink from the specified profile:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kairos-agent sysext disable --common my-extension</span><br></span></code></pre></div></div>
<p>Add <code>--now</code> to also unload the extension if it&#x27;s currently live:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kairos-agent sysext disable --common --now my-extension</span><br></span></code></pre></div></div>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-remove">ğŸ§¹ <code>remove</code><a href="#-remove" class="hash-link" aria-label="Direct link to -remove" title="Direct link to -remove" translate="no">â€‹</a></h3>
<p>Deletes the extension completelyâ€”including <strong>all symlinks</strong> from any profile.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kairos-agent sysext remove my-extension</span><br></span></code></pre></div></div>
<p>Use <code>--now</code> to deactivate it immediately as well:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kairos-agent sysext remove --now my-extension</span><br></span></code></pre></div></div>
<blockquote>
<p>âš ï¸ This is a <strong>permanent wipe</strong>. The extension will no longer be available for any boot profile.</p>
</blockquote>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="-list">ğŸ“‹ <code>list</code><a href="#-list" class="hash-link" aria-label="Direct link to -list" title="Direct link to -list" translate="no">â€‹</a></h3>
<ul>
<li class="">Without flags: lists all installed extensions</li>
<li class="">With a profile flag: lists extensions enabled for that boot profile</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kairos-agent sysext list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kairos-agent sysext list --recovery</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="-example-workflow">ğŸ§ª Example Workflow<a href="#-example-workflow" class="hash-link" aria-label="Direct link to ğŸ§ª Example Workflow" title="Direct link to ğŸ§ª Example Workflow" translate="no">â€‹</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Download a disk image over HTTPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kairos-agent sysext download https://example.org/extensions/k3sv1.32.1.raw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Enable for the active profile and activate it live</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kairos-agent sysext enable --active --now k3s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># See whatâ€™s currently enabled for active</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kairos-agent sysext list --active</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Fully remove it and clean up live state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kairos-agent sysext remove --now k3s</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="-designed-for-clean-state-management">ğŸ§¼ Designed for Clean State Management<a href="#-designed-for-clean-state-management" class="hash-link" aria-label="Direct link to ğŸ§¼ Designed for Clean State Management" title="Direct link to ğŸ§¼ Designed for Clean State Management" translate="no">â€‹</a></h2>
<ul>
<li class="">No duplication: all symlinks point to a single image</li>
<li class="">Reversible: simply unlink or remove to disable</li>
<li class=""><code>--now</code> lets you test and roll out changes live</li>
<li class="">All state reset at boot via ephemeral <code>/run/extensions</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="boot-workflow">Boot workflow<a href="#boot-workflow" class="hash-link" aria-label="Direct link to Boot workflow" title="Direct link to Boot workflow" translate="no">â€‹</a></h3>
<p>During boot, Immucore will identify under which boot state is running (active, passive, recovery) and will link the found extensions to the /run/extensions dir during initramfs. Then it will enable the systemd-sysext service so they are loaded correctly.</p>
<p>Under Trusted Boot, the extensions signature will be verified and if they dont match they will be ignored and a warning emitted under the logs at /run/immucore/.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="known-issues">Known issues<a href="#known-issues" class="hash-link" aria-label="Direct link to Known issues" title="Direct link to Known issues" translate="no">â€‹</a></h3>
<ul>
<li class="">Sysext images need to be named with the extension <code>.sysext.raw</code> to be identified correctly. This is a design choice to avoid conflicts with other files that could be present in the EFI partition and we don&#x27;t expect this to change in the future.</li>
<li class="">Any folder that is mounted as a system extension will be mounted as read-only. So if your sysext is mounting <code>/usr/local/bin</code> to add binaries, it will be mounted as read-only. Other sysexts can be added and they will be merged correctly, but the final dir will be read-only. This is a limitation of the current systemd version (lower than 256) and will be addressed in future releases.</li>
<li class="">Only <code>/usr</code> can be extended. This is a design choice and might change in the future to allow other directories to be extended.</li>
<li class="">System extensions provided binaries are only available after the <code>initramfs</code> stage.</li>
<li class="">Currently only signed+verity sysexts are supported under Trusted Boot (UKI). For non-uki Kairos, the signature is not enforced yet.</li>
<li class="">Sysexts need to be signed with the same key/cert as the ones used to sign the EFI files. As those are part of the system and available in the EFI firmware, we can extract the public part and verify the sysexts locally. Any of the PK, KEK or DB keys can be used to sign sysexts. This is planned to be expanded in the future to allow signing them with a different key/cert and provide the public keys as part of the install configuration so they can be verified.</li>
<li class="">Sysexts are mounted by the name order by trying to parse the name as a version and comparing it to others. This is done directly by systemd so be aware of the naming of your extensions and try to keep them in a versioned format. And example from systemd source code is provided as a guide:</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">*  (older) 122.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         *     ^    123~rc1-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         *     |    123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         *     |    123-a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         *     |    123-a.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         *     |    123-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         *     |    123-1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         *     |    123^post1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         *     |    123.a-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         *     |    123.1-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         *     v    123a-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         *  (newer) 124-1</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/kairos-io/kairos-docs/tree/main/docs/Advanced/sys-extensions.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-12-06T17:56:03.000Z" itemprop="dateModified">Dec 6, 2025</time></b> by <b>Jasper De Keukelaere (imec)</b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/kairos-docs/docs/next/Advanced/networking"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Networking</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/kairos-docs/docs/next/Advanced/bundles"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Bundles</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#building-system-extensions-manually" class="table-of-contents__link toc-highlight">Building system extensions manually</a></li><li><a href="#building-system-extensions-from-a-docker-image-with-auroraboot" class="table-of-contents__link toc-highlight">Building system extensions from a docker image with auroraboot</a></li><li><a href="#verifying-the-system-extensions" class="table-of-contents__link toc-highlight">Verifying the system extensions</a></li><li><a href="#-where-extensions-live" class="table-of-contents__link toc-highlight">ğŸ“‚ Where Extensions Live</a></li><li><a href="#ï¸-cli-usage" class="table-of-contents__link toc-highlight">ğŸ› ï¸ CLI Usage</a></li><li><a href="#subcommands" class="table-of-contents__link toc-highlight">Subcommands</a><ul><li><a href="#-download" class="table-of-contents__link toc-highlight">ğŸ“¥ <code>download</code></a></li><li><a href="#-enable" class="table-of-contents__link toc-highlight">âœ… <code>enable</code></a></li><li><a href="#-disable" class="table-of-contents__link toc-highlight">ğŸš« <code>disable</code></a></li><li><a href="#-remove" class="table-of-contents__link toc-highlight">ğŸ§¹ <code>remove</code></a></li><li><a href="#-list" class="table-of-contents__link toc-highlight">ğŸ“‹ <code>list</code></a></li></ul></li><li><a href="#-example-workflow" class="table-of-contents__link toc-highlight">ğŸ§ª Example Workflow</a></li><li><a href="#-designed-for-clean-state-management" class="table-of-contents__link toc-highlight">ğŸ§¼ Designed for Clean State Management</a><ul><li><a href="#boot-workflow" class="table-of-contents__link toc-highlight">Boot workflow</a></li><li><a href="#known-issues" class="table-of-contents__link toc-highlight">Known issues</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/kairos-docs/docs/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/kairos-docs/docs/installation">Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/kairos-docs/docs/architecture">Architecture</a></li><li class="footer__item"><a class="footer__link-item" href="/kairos-docs/docs/examples">Examples</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://slack.cncf.io/#kairos" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/kairos-io/kairos/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/kairos-oss/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/Kairos_OSS" target="_blank" rel="noopener noreferrer" class="footer__link-item">X (Twitter)<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/kairos-docs/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/kairos-io/kairos" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.spectrocloud.com/solutions/kairos-support" target="_blank" rel="noopener noreferrer" class="footer__link-item">Commercial Support<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2025 Kairos authors</div></div></div></footer></div>
</body>
</html>